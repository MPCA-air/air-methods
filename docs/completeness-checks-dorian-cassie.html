<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title></title>
  <meta name="description" content="">
  <meta name="generator" content="bookdown 0.5.2 and GitBook 2.6.7">

  <meta property="og:title" content="" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/MPCA-air/air-methods" />
  <meta property="og:image" content="https://github.com/MPCA-air/air-methodsimages/cover.jpeg" />
  
  <meta name="github-repo" content="MPCA-air/air-methods" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="" />
  
  
  <meta name="twitter:image" content="https://github.com/MPCA-air/air-methodsimages/cover.jpeg" />




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="detection-limits-kristie-cassie.html">
<link rel="next" href="summary-statistics.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-0.9/htmlwidgets.js"></script>
<script src="libs/datatables-binding-0.2/datatables.js"></script>
<link href="libs/dt-core-1.10.12/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.12/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.12/js/jquery.dataTables.min.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://mpca-air.github.io/air-methods">Methods for air data analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="get-data-dorian-cassie.html"><a href="get-data-dorian-cassie.html"><i class="fa fa-check"></i><b>1</b> Get data (Dorian &amp; Cassie)</a><ul>
<li class="chapter" data-level="1.1" data-path="get-data-dorian-cassie.html"><a href="get-data-dorian-cassie.html#rqamd"><i class="fa fa-check"></i><b>1.1</b> Retrieving data from AQS DataMart using RQAMD</a></li>
<li class="chapter" data-level="1.2" data-path="get-data-dorian-cassie.html"><a href="get-data-dorian-cassie.html#wair"><i class="fa fa-check"></i><b>1.2</b> Retrieving data from MPCA WAIR database</a></li>
<li class="chapter" data-level="1.3" data-path="get-data-dorian-cassie.html"><a href="get-data-dorian-cassie.html#aqi-now"><i class="fa fa-check"></i><b>1.3</b> Current AQI obs</a></li>
<li class="chapter" data-level="1.4" data-path="get-data-dorian-cassie.html"><a href="get-data-dorian-cassie.html#monitors"><i class="fa fa-check"></i><b>1.4</b> Current AQI observations</a></li>
<li class="chapter" data-level="1.5" data-path="get-data-dorian-cassie.html"><a href="get-data-dorian-cassie.html#tableau"><i class="fa fa-check"></i><b>1.5</b> Retrieving data from Tableau</a><ul>
<li class="chapter" data-level="1.5.1" data-path="get-data-dorian-cassie.html"><a href="get-data-dorian-cassie.html#a-happy-note"><i class="fa fa-check"></i><b>1.5.1</b> A Happy note!</a></li>
<li class="chapter" data-level="1.5.2" data-path="get-data-dorian-cassie.html"><a href="get-data-dorian-cassie.html#sad-note-1"><i class="fa fa-check"></i><b>1.5.2</b> Sad note /#1</a></li>
<li class="chapter" data-level="1.5.3" data-path="get-data-dorian-cassie.html"><a href="get-data-dorian-cassie.html#sad-note-2"><i class="fa fa-check"></i><b>1.5.3</b> Sad note /#2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-cleaning-dorian-cassie.html"><a href="data-cleaning-dorian-cassie.html"><i class="fa fa-check"></i><b>2</b> Data cleaning (Dorian &amp; Cassie)</a><ul>
<li class="chapter" data-level="2.1" data-path="data-cleaning-dorian-cassie.html"><a href="data-cleaning-dorian-cassie.html#missing"><i class="fa fa-check"></i><b>2.1</b> Remove blank, NULL, and missing values</a></li>
<li class="chapter" data-level="2.2" data-path="data-cleaning-dorian-cassie.html"><a href="data-cleaning-dorian-cassie.html#quals"><i class="fa fa-check"></i><b>2.2</b> Remove <em>Qualified</em> data</a></li>
<li class="chapter" data-level="2.3" data-path="data-cleaning-dorian-cassie.html"><a href="data-cleaning-dorian-cassie.html#dups"><i class="fa fa-check"></i><b>2.3</b> Duplicate observations</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-validation-kristie.html"><a href="data-validation-kristie.html"><i class="fa fa-check"></i><b>3</b> Data validation (Kristie)</a><ul>
<li class="chapter" data-level="3.1" data-path="data-validation-kristie.html"><a href="data-validation-kristie.html#leaks"><i class="fa fa-check"></i><b>3.1</b> Identifying Instrument drift or leaks in a system.</a></li>
<li class="chapter" data-level="3.2" data-path="data-validation-kristie.html"><a href="data-validation-kristie.html#outs"><i class="fa fa-check"></i><b>3.2</b> Identify exceptional and extreme values aka outliers.</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="collocated-monitors-derek.html"><a href="collocated-monitors-derek.html"><i class="fa fa-check"></i><b>4</b> Collocated monitors (Derek)</a><ul>
<li class="chapter" data-level="4.1" data-path="collocated-monitors-derek.html"><a href="collocated-monitors-derek.html#evalpocs"><i class="fa fa-check"></i><b>4.1</b> Evaluate collocated air monitors (POCs)</a></li>
<li class="chapter" data-level="4.2" data-path="collocated-monitors-derek.html"><a href="collocated-monitors-derek.html#pripocs"><i class="fa fa-check"></i><b>4.2</b> Prioritize multiple air monitors (POCs)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="detection-limits-kristie-cassie.html"><a href="detection-limits-kristie-cassie.html"><i class="fa fa-check"></i><b>5</b> Detection limits (Kristie &amp; Cassie)</a><ul>
<li class="chapter" data-level="5.1" data-path="detection-limits-kristie-cassie.html"><a href="detection-limits-kristie-cassie.html#method-detection-limit---definition"><i class="fa fa-check"></i><b>5.1</b> Method Detection Limit - Definition</a></li>
<li class="chapter" data-level="5.2" data-path="detection-limits-kristie-cassie.html"><a href="detection-limits-kristie-cassie.html#procedure-for-calculating-method-detection-limits"><i class="fa fa-check"></i><b>5.2</b> Procedure for calculating method detection limits</a></li>
<li class="chapter" data-level="5.3" data-path="detection-limits-kristie-cassie.html"><a href="detection-limits-kristie-cassie.html#finding-detection-limits-cassie"><i class="fa fa-check"></i><b>5.3</b> Finding detection limits (Cassie)</a></li>
<li class="chapter" data-level="5.4" data-path="detection-limits-kristie-cassie.html"><a href="detection-limits-kristie-cassie.html#qualifier-codes-for-detection-limits"><i class="fa fa-check"></i><b>5.4</b> Qualifier Codes for Detection Limits</a></li>
<li class="chapter" data-level="5.5" data-path="detection-limits-kristie-cassie.html"><a href="detection-limits-kristie-cassie.html#below-detection-values-kristie"><i class="fa fa-check"></i><b>5.5</b> Below detection values (Kristie)</a><ul>
<li class="chapter" data-level="" data-path="detection-limits-kristie-cassie.html"><a href="detection-limits-kristie-cassie.html#example-charts-for-visualizing-data-below-detection-limits"><i class="fa fa-check"></i>Example charts for visualizing data below detection limits</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="detection-limits-kristie-cassie.html"><a href="detection-limits-kristie-cassie.html#multiple-detection-limits"><i class="fa fa-check"></i><b>5.6</b> Multiple detection limits</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="completeness-checks-dorian-cassie.html"><a href="completeness-checks-dorian-cassie.html"><i class="fa fa-check"></i><b>6</b> Completeness checks (Dorian &amp; Cassie)</a><ul>
<li class="chapter" data-level="6.1" data-path="completeness-checks-dorian-cassie.html"><a href="completeness-checks-dorian-cassie.html#complete"><i class="fa fa-check"></i><b>6.1</b> Completeness checks</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="summary-statistics.html"><a href="summary-statistics.html"><i class="fa fa-check"></i><b>7</b> Summary statistics</a><ul>
<li class="chapter" data-level="7.1" data-path="summary-statistics.html"><a href="summary-statistics.html#boots"><i class="fa fa-check"></i><b>7.1</b> Bootstrapping (Dorian)</a></li>
<li class="chapter" data-level="7.2" data-path="summary-statistics.html"><a href="summary-statistics.html#below"><i class="fa fa-check"></i><b>7.2</b> Below the detection limit</a></li>
<li class="chapter" data-level="7.3" data-path="summary-statistics.html"><a href="summary-statistics.html#confidence"><i class="fa fa-check"></i><b>7.3</b> Upper confidence limits (UCLs)</a></li>
<li class="chapter" data-level="7.4" data-path="summary-statistics.html"><a href="summary-statistics.html#incomplete"><i class="fa fa-check"></i><b>7.4</b> Annual summaries for incomplete data</a></li>
<li class="chapter" data-level="7.5" data-path="summary-statistics.html"><a href="summary-statistics.html#health"><i class="fa fa-check"></i><b>7.5</b> Comparison of data to inhalation health benchmarks (Kristie)</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="site-comparisons-derek-cassie.html"><a href="site-comparisons-derek-cassie.html"><i class="fa fa-check"></i><b>8</b> Site comparisons (Derek &amp; Cassie)</a><ul>
<li class="chapter" data-level="8.1" data-path="site-comparisons-derek-cassie.html"><a href="site-comparisons-derek-cassie.html#confidence-intervals"><i class="fa fa-check"></i><b>8.1</b> Confidence intervals</a></li>
<li class="chapter" data-level="8.2" data-path="site-comparisons-derek-cassie.html"><a href="site-comparisons-derek-cassie.html#tools-to-visualize-data"><i class="fa fa-check"></i><b>8.2</b> Tools to visualize data</a></li>
<li class="chapter" data-level="8.3" data-path="site-comparisons-derek-cassie.html"><a href="site-comparisons-derek-cassie.html#beeswarm-plots"><i class="fa fa-check"></i><b>8.3</b> Beeswarm Plots</a></li>
<li class="chapter" data-level="8.4" data-path="site-comparisons-derek-cassie.html"><a href="site-comparisons-derek-cassie.html#correlation-matrices-cassie"><i class="fa fa-check"></i><b>8.4</b> Correlation matrices (Cassie)</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="start-finish.html"><a href="start-finish.html"><i class="fa fa-check"></i><b>9</b> Start to finish (all hands on deck)</a></li>
<li class="chapter" data-level="10" data-path="charts.html"><a href="charts.html"><i class="fa fa-check"></i><b>10</b> Charts</a><ul>
<li class="chapter" data-level="10.1" data-path="charts.html"><a href="charts.html#boxplots-kristie"><i class="fa fa-check"></i><b>10.1</b> Boxplots (Kristie)</a><ul>
<li class="chapter" data-level="10.1.1" data-path="charts.html"><a href="charts.html#log-boxplot"><i class="fa fa-check"></i><b>10.1.1</b> Log boxplot</a></li>
<li class="chapter" data-level="10.1.2" data-path="charts.html"><a href="charts.html#outliers"><i class="fa fa-check"></i><b>10.1.2</b> Outliers</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="charts.html"><a href="charts.html#calendar-plots-cassie"><i class="fa fa-check"></i><b>10.2</b> Calendar plots (Cassie)</a></li>
<li class="chapter" data-level="10.3" data-path="charts.html"><a href="charts.html#colors-dorian"><i class="fa fa-check"></i><b>10.3</b> Colors (Dorian)</a></li>
<li class="chapter" data-level="10.4" data-path="charts.html"><a href="charts.html#pollution-roses-and-love-poems-derek"><i class="fa fa-check"></i><b>10.4</b> Pollution roses and love poems (Derek)</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="time-series.html"><a href="time-series.html"><i class="fa fa-check"></i><b>11</b> Time series</a><ul>
<li class="chapter" data-level="11.1" data-path="time-series.html"><a href="time-series.html#seasonality"><i class="fa fa-check"></i><b>11.1</b> Seasonality</a></li>
<li class="chapter" data-level="11.2" data-path="time-series.html"><a href="time-series.html#changepoints-before-after-tests"><i class="fa fa-check"></i><b>11.2</b> Changepoints (before &amp; after tests)</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="maps-kristie.html"><a href="maps-kristie.html"><i class="fa fa-check"></i><b>12</b> Maps (Kristie)</a><ul>
<li class="chapter" data-level="12.1" data-path="maps-kristie.html"><a href="maps-kristie.html#kriging"><i class="fa fa-check"></i><b>12.1</b> Kriging</a></li>
<li class="chapter" data-level="12.2" data-path="maps-kristie.html"><a href="maps-kristie.html#spatial-averaging-and-aggregation"><i class="fa fa-check"></i><b>12.2</b> Spatial averaging and aggregation</a></li>
<li class="chapter" data-level="12.3" data-path="maps-kristie.html"><a href="maps-kristie.html#creating-shapefiles-in-r-adn-joining-to-ej-areas"><i class="fa fa-check"></i><b>12.3</b> Creating shapefiles in R adn joining to EJ areas</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="additional-resources-kristie.html"><a href="additional-resources-kristie.html"><i class="fa fa-check"></i><b>13</b> Additional resources (Kristie)</a></li>
<li><a href="mpca-data-tools.html#mpca-data-tools"><strong>MPCA data tools</strong></a></li>
<li class="chapter" data-level="14" data-path="aqi-explorer.html"><a href="aqi-explorer.html"><i class="fa fa-check"></i><b>14</b> AQI explorer</a></li>
<li class="chapter" data-level="15" data-path="criteria-pollutant-explorer.html"><a href="criteria-pollutant-explorer.html"><i class="fa fa-check"></i><b>15</b> Criteria pollutant explorer</a></li>
<li class="chapter" data-level="16" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html"><i class="fa fa-check"></i><b>16</b> Air toxics explorer</a><ul>
<li class="chapter" data-level="16.1" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#mpca-air-toxics-methods"><i class="fa fa-check"></i><b>16.1</b> MPCA Air Toxics Methods</a><ul>
<li class="chapter" data-level="16.1.1" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#data-cleaning"><i class="fa fa-check"></i><b>16.1.1</b> Data Cleaning</a></li>
<li class="chapter" data-level="16.1.2" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#data-validation"><i class="fa fa-check"></i><b>16.1.2</b> Data Validation</a></li>
<li class="chapter" data-level="16.1.3" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#parameter-occurrence-codes-pocs"><i class="fa fa-check"></i><b>16.1.3</b> Parameter Occurrence Codes (POCs)</a></li>
<li class="chapter" data-level="16.1.4" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#producing-annual-summaries"><i class="fa fa-check"></i><b>16.1.4</b> Producing Annual Summaries</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="edit-this-book.html"><a href="edit-this-book.html"><i class="fa fa-check"></i>Edit this book</a></li>
<li class="divider"></li>
<li><a href="https://github.com/MPCA-air" target="blank">Created by MPCA-air</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="completeness-checks-dorian-cassie" class="section level1">
<h1><span class="header-section-number"></span> Completeness checks (Dorian &amp; Cassie)</h1>
<p>Checking for data completeness before generating summaries ensures that results will be comparable from one year to the next. Without completeness checks, changes in the seasonal coverage from year to year may create the illusion of increasing or decreasing trends.</p>
<p>Completeness checks inlcude tests for:</p>
<p><code>Calendar quarter completeness</code> Number of samples required for a season or quarter.</p>
<p><code>Annual completeness</code> Number of samples required for a year.</p>
<p><code>Unique values</code> Number of unique values required.</p>
<div id="complete" class="section level2">
<h2><span class="header-section-number">6.1</span> Completeness checks</h2>
<p><strong>Description</strong></p>
<p>This section describes completeness guidelines and methods for performing completeness checks.</p>
<p><strong><i>Air toxic</i> reporting guidelines based on MPCA and EPA guidelines</strong></p>
<p>Annual results are considered <em>incomplete</em> if any of the following conditions are not met:</p>
<ul>
<li><code>Annual completeness</code> 75% or more of expected samples collected (rounded up)</li>
<li><code>Calendar quarter completeness</code> 75% or more of expected samples collected (rounded up)</li>
<li><code>Unique values</code> 2 or more unique values</li>
</ul>
<p><br></p>
<p><strong><i>Criteria pollutant</i> reporting guidelines</strong></p>
<p>Completeness rules for criteria pollutant design values are defined in the <a href="https://www.ecfr.gov/cgi-bin/text-idx?tpl=/ecfrbrowse/Title40/40cfr50_main_02.tpl">Appendices of 40 CFR 50</a>.</p>
<p>In general, these rules apply:</p>
<ul>
<li><code>Annual completeness</code> 75% or more of samples collected</li>
<li><code>Calendar quarter completeness</code> 75% or more of samples collected</li>
</ul>
<p><br> <strong>Recommended steps</strong></p>
<ol style="list-style-type: decimal">
<li>Based on the monitoring schedule, record the total <em>expected samples</em> for each year and quarter.
<ul>
<li>Air toxics monitors follow a fixed sampling schedule provided by EPA’s <a href="https://www3.epa.gov/ttn/amtic/calendar.html">Air Toxics Calendar</a>.</li>
</ul></li>
<li>Count the number of <em>valid samples</em> for each year and quarter.</li>
<li>Divide the number of <em>valid samples</em> by the number of <em>expected samples</em>.</li>
<li>Count the number of unique values for each year.</li>
<li>Mark annual results as <em>incomplete</em> if they do not fulfill one of the completeness checks.</li>
</ol>
<p><br> <strong>Example <code>R</code> script</strong></p>
<p>Click the button below to view a step by step example of the methods above.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<p><br> Packages</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)</code></pre></div>
<p>Our example data is organized by monitoring site and date.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/MPCA-air/air-methods/master/airtoxics_data_2009_2013.csv&#39;</span>)</code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-55"></span>
<div id="htmlwidget-040f5b97fc3ef69b744a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-040f5b97fc3ef69b744a">{"x":{"filter":"none","data":[[270535501,270535501,270535501,270535501,270535501],[1,1,1,1,1],[12102,12102,12102,12102,12102],["2009-07-30","2009-08-05","2009-08-11","2009-09-16","2009-09-22"],[0.00127,0.00223,0.0037,0.0018,0.0027],[null,null,null,null,null],[0.0028236,0.0028236,0.0028236,0.0028236,0.0028236],["Antimony","Antimony","Antimony","Antimony","Antimony"],[2009,2009,2009,2009,2009],["7440-36-0","7440-36-0","7440-36-0","7440-36-0","7440-36-0"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>AQSID<\/th>\n      <th>POC<\/th>\n      <th>Param_Code<\/th>\n      <th>Date<\/th>\n      <th>Concentration<\/th>\n      <th>Null_Code<\/th>\n      <th>Dlimit<\/th>\n      <th>Pollutant<\/th>\n      <th>Year<\/th>\n      <th>CAS<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"autoWidth":true,"searching":false,"ordering":false,"lengthChange":false,"paginate":false,"info":false,"columnDefs":[{"className":"dt-right","targets":[0,1,2,4,6,8]}],"order":[],"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row"}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 6.1: Sample data table.
</p>
</div>
<p><br></p>
<p><strong>Step 1:</strong> Find the expected number of samples.</p>
<p>Monitors in EPA’s Air Quality System are required to follow the <a href="https://www3.epa.gov/ttn/amtic/calendar.html">Air Toxics Monitoring Calendar</a>. The sampling schedule for air toxics is generally 1 sample per every 6 days. Depending on the sampling start date and whether it is a leap year or not, the expected number of samples for the year will range from 60 to 61. If you are uncertain about the sampling schedule for your data consult the lab to confirm the expected number of samples.</p>
<p>Entering the start and end date into the <code>sample_calendar()</code> function below will create a list of the expected sampling dates based on EPA’s air toxics monitoring schedule.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create a sampling calendar based on EPA&#39;s air toxics monitoring schedule</span>
sample_calendar &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">start         =</span> <span class="st">&quot;2012-01-01&quot;</span>, 
                            <span class="dt">end           =</span> <span class="st">&quot;2016-12-31&quot;</span>, 
                            <span class="dt">day_interval  =</span> <span class="dv">6</span>,
                            <span class="dt">type          =</span> <span class="st">&quot;air_toxics&quot;</span>) {
  
  <span class="kw">library</span>(lubridate)
  
  <span class="co"># Convert &#39;start&#39; and &#39;end&#39; to class date</span>
  start &lt;-<span class="st"> </span><span class="kw">ymd</span>(start)
  end   &lt;-<span class="st"> </span><span class="kw">ymd</span>(end)
  
  <span class="co"># Set official start date to selected EPA calendar</span>
  <span class="cf">if</span>(type <span class="op">==</span><span class="st"> &quot;air_toxics&quot;</span>) {
      epa_start &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">&quot;1990-01-09&quot;</span>)
  } <span class="cf">else</span> {
      epa_start &lt;-<span class="st"> </span>start
  }
  
  <span class="co"># Create full table of sampling dates</span>
  calendar &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> epa_start, 
                  <span class="dt">to   =</span> end, 
                  <span class="dt">by   =</span> <span class="kw">paste</span>(day_interval, <span class="st">&quot;days&quot;</span>))
  
  
  <span class="co"># Subset to user&#39;s date range</span>
  calendar &lt;-<span class="st"> </span>calendar[calendar <span class="op">&gt;=</span><span class="st"> </span>start <span class="op">&amp;</span><span class="st"> </span>calendar <span class="op">&lt;=</span><span class="st"> </span>end]
  
  <span class="co"># Print total sampling days and date range</span>
  <span class="kw">cat</span>(<span class="kw">length</span>(calendar), <span class="st">&quot;sampling days from&quot;</span>, <span class="kw">as.character</span>(<span class="kw">min</span>(calendar)), <span class="st">&quot;to&quot;</span>, <span class="kw">as.character</span>(<span class="kw">max</span>(calendar)))
  
  <span class="kw">return</span>(calendar)
  
}</code></pre></div>
<p>Find the date range of the data and create the expected sampling schedule with the function above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Find the year range of your data</span>
date_range &lt;-<span class="st"> </span><span class="kw">range</span>(data<span class="op">$</span>Date)

<span class="co"># Create expected sample calendar</span>
epa_schedule &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">Date =</span> <span class="kw">sample_calendar</span>(<span class="dt">start =</span> <span class="kw">format</span>(date_range[<span class="dv">1</span>], <span class="st">&quot;%Y-01-01&quot;</span>), <span class="co">#Extend range to first day of the year</span>
                                                  <span class="dt">end   =</span> <span class="kw">format</span>(date_range[<span class="dv">2</span>], <span class="st">&quot;%Y-12-31&quot;</span>), <span class="co">#Extend range to last day of the year</span>
                                                  <span class="dt">day_interval =</span> <span class="dv">6</span>))</code></pre></div>
<pre><code>## 304 sampling days from 2009-01-05 to 2013-12-28</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Add year and calendar quarter columns</span>
epa_schedule &lt;-<span class="st"> </span>epa_schedule <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Year        =</span> <span class="kw">year</span>(Date),
                                        <span class="dt">cal_quarter =</span> <span class="kw">quarter</span>(Date))


<span class="co"># Count the expected number of samples per quarter and year.</span>
epa_schedule &lt;-<span class="st"> </span>epa_schedule <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                </span><span class="kw">group_by</span>(Year, cal_quarter) <span class="op">%&gt;%</span>
<span class="st">                </span><span class="kw">summarize</span>(<span class="dt">expected_quarter_samples =</span> <span class="kw">length</span>(<span class="kw">unique</span>(Date))) <span class="op">%&gt;%</span>
<span class="st">                </span><span class="kw">group_by</span>(Year) <span class="op">%&gt;%</span>
<span class="st">                </span><span class="kw">mutate</span>(<span class="dt">expected_annual_samples =</span> <span class="kw">sum</span>(expected_quarter_samples))</code></pre></div>
<br> <strong>Expected number of samples.</strong>
<div class="figure"><span id="fig:unnamed-chunk-58"></span>
<div id="htmlwidget-1e05ff7397f5b8b3f2c2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1e05ff7397f5b8b3f2c2">{"x":{"filter":"none","data":[[2009,2009,2009,2009,2010,2010,2010,2010,2011,2011,2011,2011,2012,2012,2012,2012,2013,2013,2013,2013],[1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4,1,2,3,4],[15,15,15,16,15,15,15,15,15,16,15,15,15,16,15,15,15,15,16,15],[61,61,61,61,60,60,60,60,61,61,61,61,61,61,61,61,61,61,61,61]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>Year<\/th>\n      <th>cal_quarter<\/th>\n      <th>expected_quarter_samples<\/th>\n      <th>expected_annual_samples<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"autoWidth":true,"searching":false,"ordering":false,"lengthChange":false,"paginate":false,"info":false,"columnDefs":[{"className":"dt-right","targets":[0,1,2,3]}],"order":[],"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row"}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 6.2: Expected number of samples.
</p>
</div>
<p><br></p>
<p><strong>Step 2:</strong> Count number of valid samples.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Assign each date to a calendar quarter</span>
data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">cal_quarter =</span> <span class="kw">quarter</span>(Date))

<span class="co"># Count the number of sampling dates for each quarter and year.</span>
data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">        </span><span class="kw">group_by</span>(AQSID, POC, Param_Code, CAS, Year, cal_quarter) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">valid_quarter_samples =</span> <span class="kw">length</span>(<span class="kw">unique</span>(Date[<span class="op">!</span><span class="kw">is.na</span>(Concentration)]))) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">group_by</span>(AQSID, POC, Param_Code, CAS, Year) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">valid_annual_samples =</span> <span class="kw">length</span>(<span class="kw">unique</span>(Date[<span class="op">!</span><span class="kw">is.na</span>(Concentration)]))) </code></pre></div>
<p><br></p>
<p><strong>Step 3:</strong> Divide the number of valid samples by the number of expected samples.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Join expected sample table to data by quarter and year columns</span>
data &lt;-<span class="st"> </span><span class="kw">left_join</span>(data, epa_schedule, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;cal_quarter&quot;</span>))


<span class="co"># Divide valid samples by expected samples</span>
data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">        </span><span class="kw">group_by</span>(AQSID, POC, CAS, Year, cal_quarter) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">pct_quarter_samples =</span> <span class="kw">round</span>(valid_quarter_samples <span class="op">/</span><span class="st"> </span>expected_quarter_samples, <span class="dv">2</span>)) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">group_by</span>(AQSID, POC, CAS, Year) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">pct_annual_samples =</span> <span class="kw">round</span>(valid_annual_samples <span class="op">/</span><span class="st"> </span>expected_annual_samples, <span class="dv">2</span>)) </code></pre></div>
<p><br></p>
<p><strong>Step 4:</strong> Count the number of unique values for each year.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">        </span><span class="kw">group_by</span>(AQSID, POC, Param_Code, CAS, Year) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">only_detects =</span> <span class="kw">ifelse</span>(Concentration <span class="op">&lt;</span><span class="st"> </span>Dlimit, <span class="ot">NA</span>, Concentration), <span class="dt">unique_values =</span> 
                 <span class="kw">n_distinct</span>(only_detects, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre></div>
<p><br></p>
<p><strong>Step 5:</strong> Mark results as incomplete if they fail one of the completeness checks.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Set incomplete to zero if any completeness checks fail</span>
data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">        </span><span class="kw">rowwise</span>() <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">complete =</span> <span class="kw">sum</span>(<span class="kw">c</span>(pct_quarter_samples <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.75</span>, 
                                pct_annual_samples  <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.75</span>,
                                unique_values       <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">3</span>)

<span class="co">#names(data)      </span></code></pre></div>
<br> <strong>Final table with added <code>complete</code> column.</strong>
<div class="figure"><span id="fig:unnamed-chunk-63"></span>
<div id="htmlwidget-8fbe20e3b996377fa85b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-8fbe20e3b996377fa85b">{"x":{"filter":"none","data":[[270530962,270531007,270530963,271630438,270370020,270370442,271630438,270531007,270531007,270370470],[1,1,1,1,1,1,1,1,1,1],["2013-10-07","2009-02-18","2012-01-10","2013-03-05","2012-01-28","2009-07-12","2009-05-31","2012-06-08","2010-04-02","2011-12-23"],["Toluene","Vinyl Chloride","Formaldehyde","Ethylbenzene","O-Xylene","N-Hexane","Ethylene Dibromide","Nickel","Lead","Beryllium"],[2013,2009,2012,2013,2012,2009,2009,2012,2010,2011],[4,1,1,1,1,3,2,2,2,4],[16,14,15,8,15,15,16,15,15,15],[16,55,52,52,52,59,60,52,43,54],[15,15,15,15,15,15,15,16,15,15],[61,61,61,61,61,61,61,61,60,61],[1.07,0.93,1,0.53,1,1,1.07,0.94,1,1],[0.26,0.9,0.85,0.85,0.85,0.97,0.98,0.85,0.72,0.89],[2.99973,null,2.3111,null,null,0.49699,null,null,0.00988,null],[15,0,52,13,1,43,0,4,28,0],[false,false,true,false,false,true,false,true,false,false]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>AQSID<\/th>\n      <th>POC<\/th>\n      <th>Date<\/th>\n      <th>Pollutant<\/th>\n      <th>Year<\/th>\n      <th>cal_quarter<\/th>\n      <th>valid_quarter_samples<\/th>\n      <th>valid_annual_samples<\/th>\n      <th>expected_quarter_samples<\/th>\n      <th>expected_annual_samples<\/th>\n      <th>pct_quarter_samples<\/th>\n      <th>pct_annual_samples<\/th>\n      <th>only_detects<\/th>\n      <th>unique_values<\/th>\n      <th>complete<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"autoWidth":true,"searching":false,"ordering":false,"lengthChange":false,"paginate":false,"info":false,"columnDefs":[{"className":"dt-right","targets":[0,1,4,5,6,7,8,9,10,11,12,13]}],"order":[],"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row"}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 6.3: Final table with added <code>complete</code> column.
</p>
</div>
<p><br></p>
<p><strong>Step 6 (Optional):</strong> By collapsing the <code>complete</code> status to 1 row per site-pollutant-quarter combination, you can save the table and attach a site’s <em>completeness</em> status to future data analysis as needed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Collapse table to 1 row per unique site-pollutant-quarter</span>
 data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">         </span><span class="kw">group_by</span>(AQSID, POC, Pollutant, Year, cal_quarter) <span class="op">%&gt;%</span><span class="st">  </span><span class="co">#Check completeness for every quarter</span>
<span class="st">         </span><span class="kw">summarize</span>(<span class="dt">complete              =</span> complete[<span class="dv">1</span>], 
                   <span class="dt">valid_annual_samples  =</span> valid_annual_samples[<span class="dv">1</span>],
                   <span class="dt">valid_quarter_samples =</span> valid_quarter_samples[<span class="dv">1</span>])

<span class="co"># Collapse table to 1 row per unique site-pollutant-year</span>
 data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st">          </span>
<span class="st">         </span><span class="kw">group_by</span>(AQSID, POC, Pollutant, Year) <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">         </span><span class="kw">summarize</span>(<span class="dt">complete            =</span> <span class="kw">sum</span>(complete, <span class="dt">na.rm =</span> T) <span class="op">==</span><span class="st"> </span><span class="dv">4</span>,
                   <span class="dt">annual_samples      =</span> valid_annual_samples[<span class="dv">1</span>],
                   <span class="dt">min_quarter_samples =</span> <span class="kw">min</span>(valid_quarter_samples, <span class="dt">na.rm =</span> T))</code></pre></div>
<div class="figure"><span id="fig:unnamed-chunk-65"></span>
<div id="htmlwidget-69a950ce34f670ff604e" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-69a950ce34f670ff604e">{"x":{"filter":"none","data":[[270031002,270031002,270031002,270031002,270031002,270031002,270031002,270031002,270031002,270031002],[1,1,1,1,1,1,1,1,1,1],["1,3-Butadiene","1,3-Butadiene","Acetaldehyde","Acetaldehyde","Antimony","Antimony","Antimony","Arsenic","Arsenic","Arsenic"],[2012,2013,2012,2013,2011,2012,2013,2011,2012,2013],[false,false,false,false,false,false,true,false,false,true],[50,51,51,54,1,59,60,1,59,60],[7,8,7,8,1,14,15,1,14,15]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>AQSID<\/th>\n      <th>POC<\/th>\n      <th>Pollutant<\/th>\n      <th>Year<\/th>\n      <th>complete<\/th>\n      <th>annual_samples<\/th>\n      <th>min_quarter_samples<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"autoWidth":true,"searching":false,"ordering":false,"lengthChange":false,"paginate":false,"info":false,"columnDefs":[{"className":"dt-right","targets":[0,1,3,5,6]}],"order":[],"orderClasses":false},"selection":{"mode":"multiple","selected":null,"target":"row"}},"evals":[],"jsHooks":[]}</script>
<p class="caption">
Figure 6.4: Collapsed table showing <code>completeness</code> status.
</p>
</div>
</div>
<p><br> <strong>Contributors</strong></p>
<blockquote>
<p>Dorian Kvale, Cassie McMahon</p>
</blockquote>
<p><br> <strong>References</strong></p>
<p><a href="https://www.ecfr.gov/cgi-bin/text-idx?tpl=/ecfrbrowse/Title40/40cfr50_main_02.tpl">Appendices of 40 CFR 50</a></p>

</div>
</div>
<script>
  $(".btn_code").click(function() {
    $(this.parentNode).toggleClass("open");
  });
</script>
            </section>

          </div>
        </div>
      </div>
<a href="detection-limits-kristie-cassie.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="summary-statistics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/MPCA-air/air-methods/edit/master/06-completeness_checks.Rmd",
"text": "Edit"
},
"download": ["air-methods.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
