[
["index.html", "Introduction Edit this document", " Introduction Updated Jul 12, 2017 This guide describes the methods used at the MPCA to analyze air monitoring and modeling data. The charts and code found in this guide were produced using the freely available R statistical software. To follow along with the examples, you can download a copy of R to your computer from the r-project or by using R-Fiddle in your browser. Edit this document This guide lives on GitHub. To make changes go to github.com/MPCA-air/air-methods and click [ Fork ]. To suggest edits go to github.com/MPCA-air/air-methods/issues and click [ New issue ]. "],
["data-cleaning.html", " Data cleaning 1.1 Duplicate obersvations 1.2 Multiple monitors (POCs)", " Data cleaning Start 1.1 Duplicate obersvations You can label chapter and section titles using {#label} after them, e.g., we can reference 1.1. If you do not manually label them, there will be automatic labels anyway, e.g., ??. Figures and tables with captions will be placed in figure and table environments, respectively. You can write citations, too. For example, we are using the bookdown package (Xie 2017) in this sample book, which was built on top of R Markdown and knitr (Xie 2015). ddd aaa 1.2 Multiple monitors (POCs) References "],
["detection-limits.html", " Detection limits 2.1 Below detection 2.2 Multiple detection limits", " Detection limits Here is a review of existing methods. 2.1 Below detection 2.2 Multiple detection limits "],
["summary-statistics.html", " Summary statistics", " Summary statistics We describe our methods in this chapter. "],
["bootstrapping.html", " Bootstrapping", " Bootstrapping body, td {font-size: 18px;} code.r{font-size: 18px;} pre {font-size: 18px} 4.0.1 Packages library(dplyr) library(readr) 4.0.2 Data Table Our data is organized by monitoring site and date. Here’s a sample. AQS_ID Date Conc 270535501 2009-07-30 0.00148 270535501 2009-09-30 0.00064 270535501 2009-11-30 0.34256 270535501 2009-12-30 0.00064 270535502 2009-03-30 0.26219 270535502 2009-07-30 0.01113 270535502 2009-09-30 0.00044 270535502 2009-11-30 0.00127 270535502 2009-12-30 0.00113 4.0.3 Bootstrapping We currently use the EnvStats package to generate our summary values. It has built in functions to accunt for non-detect data and allows for different distributions. However, if you’re not dealing with non-detects it’s probably simple enough to boot things yourself. Before you start you’ll want to set the random number generator to ensure you’ll be able to reproduce your results. I’ll use #27 below. set.seed(27) The general idea is to take a random sample from the data set, generate the statistic that you’re interested in, record it, then rinse and repeat. Below is the code for how to resample a single site. # Filter data to a single site df_site1 &lt;- filter(df, AQS_ID == AQS_ID[1]) # Pull random sample # `replace=T` allows for the same value to be pulled multiple times # `size=nrow(df)` ensures the number of observations in the new table to match the original random_df &lt;- sample(df_site1$Conc, replace=T) # Generate summary statistic quantile(random_df, 0.1) ## 10% ## 0.00064 To repeat this 3,000 times we can wrap these steps into a resample function, and then use sapply to collect the results. # Create resample function resample_Conc &lt;- function(data= df_site1$Conc, Conc_pct= 0.10){ random_df &lt;- sample(data, replace=T) quantile(random_df, Conc_pct, na.rm=T)[[1]] } # Repeat using `sapply` repeats &lt;- 3000 booted_10pct &lt;- sapply(1:repeats, FUN=function(x) resample_Conc(df_site1$Conc)) # The 50th percentile or median Conc median(booted_10pct, na.rm=T) ## [1] 0.00064 # Return the 95th percentile of the booted concentrations quantile(booted_10pct, 0.95, na.rm=T)[[1]] ## [1] 0.00148 # Force the 95th percentile to be a recorded value sort(booted_10pct)[repeats*.95 +1] ## [1] 0.00148 # Upper and lower confidence interval around the median quantile(booted_10pct, c(0.025, 0.5, 0.975), na.rm=T) ## 2.5% 50% 97.5% ## 0.000640 0.000640 0.103216 4.0.4 Automate To finish up, throw these steps into your personal boot function, and then run it on each site using group_by. # Create boot function boot_low_Conc &lt;- function(data=df$Conc, Conc_pct=0.10, conf_int=0.95, repeats=3000){ alpha &lt;- (1 - conf_int)/2 booted_10pct &lt;- sapply(1:repeats, FUN=function(x) resample_Conc(data, Conc_pct)) # Upper and lower confidence interval around the median list(quantile(booted_10pct, c(alpha, 0.5, 1-alpha), na.rm=T)) } # Use `group_by` to send data for each site to your boot function conc_summary &lt;- group_by(df, AQS_ID) %&gt;% mutate(boot_results = boot_low_Conc(Conc, Conc_pct=0.10, conf_int=0.95)) %&gt;% summarize(Conc_10pct = quantile(Conc, 0.10, na.rm=T)[[1]], Low_CL95_conc = unlist(boot_results[1])[[1]], Boot_conc = unlist(boot_results[1])[[2]], Upper_CL95_conc = unlist(boot_results[1])[[3]]) 4.0.5 Results The booted confidence limits AQS_ID Conc_10pct Low_CL95_conc Boot_conc Upper_CL95_conc 270535501 0.000640 0.00064 0.000640 0.103216 270535502 0.000716 0.00044 0.000716 0.005214 "],
["site-comparisons.html", " Site comparisons 5.1 Example one", " Site comparisons Some significant applications are demonstrated in this chapter. 5.1 Example one "],
["boxplots.html", " Boxplots 6.1 Log boxplot 6.2 Outliers", " Boxplots Dividing by zero is a super power. 6.1 Log boxplot 6.2 Outliers "],
["calendar-plots.html", " Calendar plots 7.1 Tableau 7.2 R", " Calendar plots We have finished a nice book. 7.1 Tableau 7.2 R "],
["wind-pollution-roses.html", " Wind &amp; pollution roses 8.1 openair package", " Wind &amp; pollution roses We have finished a nice book. 8.1 openair package "],
["time-series.html", " Time series 9.1 Seasonality 9.2 Change points (before &amp; after)", " Time series The trend is up. 9.1 Seasonality 9.2 Change points (before &amp; after) "],
["maps.html", " Maps 10.1 Kriging 10.2 Spatial averaging or aggregation", " Maps 10.1 Kriging 10.2 Spatial averaging or aggregation "],
["references.html", " References", " References "]
]
