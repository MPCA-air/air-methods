<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title> Get data | air-methods.utf8</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.18 and GitBook 2.6.7" />

  <meta property="og:title" content=" Get data | air-methods.utf8" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/MPCA-air/air-methods" />
  <meta property="og:image" content="https://github.com/MPCA-air/air-methodsimages/cover.jpeg" />
  
  <meta name="github-repo" content="MPCA-air/air-methods" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content=" Get data | air-methods.utf8" />
  
  
  <meta name="twitter:image" content="https://github.com/MPCA-air/air-methodsimages/cover.jpeg" />

<meta name="author" content="" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="best-practices.html"/>
<link rel="next" href="quality-assurance-methods.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://mpca-air.github.io/air-methods">Methods for air data analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="best-practices.html"><a href="best-practices.html"><i class="fa fa-check"></i><b>1</b> Best practices</a><ul>
<li class="chapter" data-level="1.1" data-path="best-practices.html"><a href="best-practices.html#welcome-to-the-tidyverse"><i class="fa fa-check"></i><b>1.1</b> Welcome to the Tidyverse</a></li>
<li class="chapter" data-level="1.2" data-path="best-practices.html"><a href="best-practices.html#keep-r-updated"><i class="fa fa-check"></i><b>1.2</b> Keep R updated</a></li>
<li class="chapter" data-level="1.3" data-path="best-practices.html"><a href="best-practices.html#script-organization"><i class="fa fa-check"></i><b>1.3</b> Script organization</a></li>
<li class="chapter" data-level="1.4" data-path="best-practices.html"><a href="best-practices.html#divide-and-conquer"><i class="fa fa-check"></i><b>1.4</b> Divide and conquer</a></li>
<li class="chapter" data-level="1.5" data-path="best-practices.html"><a href="best-practices.html#codebooks-metadata-and-data-dictionaries"><i class="fa fa-check"></i><b>1.5</b> Codebooks, metadata, and data dictionaries</a></li>
<li class="chapter" data-level="1.6" data-path="best-practices.html"><a href="best-practices.html#data-formatting"><i class="fa fa-check"></i><b>1.6</b> Data formatting</a></li>
<li class="chapter" data-level="1.7" data-path="best-practices.html"><a href="best-practices.html#pollutant-names"><i class="fa fa-check"></i><b>1.7</b> Pollutant names</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="get-data.html"><a href="get-data.html"><i class="fa fa-check"></i><b>2</b> Get data</a><ul>
<li class="chapter" data-level="2.1" data-path="get-data.html"><a href="get-data.html#air-monitoring"><i class="fa fa-check"></i><b>2.1</b> Air monitoring</a><ul>
<li class="chapter" data-level="2.1.1" data-path="get-data.html"><a href="get-data.html#AQS"><i class="fa fa-check"></i><b>2.1.1</b> Retrieving data from AQS</a></li>
<li class="chapter" data-level="2.1.2" data-path="get-data.html"><a href="get-data.html#rqamd"><i class="fa fa-check"></i><b>2.1.2</b> Retrieving data from AQS DataMart</a></li>
<li class="chapter" data-level="2.1.3" data-path="get-data.html"><a href="get-data.html#aqi-now"><i class="fa fa-check"></i><b>2.1.3</b> Current AQI observations</a></li>
<li class="chapter" data-level="2.1.4" data-path="get-data.html"><a href="get-data.html#wairsites"><i class="fa fa-check"></i><b>2.1.4</b> WAIR Site information table</a></li>
<li class="chapter" data-level="2.1.5" data-path="get-data.html"><a href="get-data.html#monitors"><i class="fa fa-check"></i><b>2.1.5</b> AirNow:Active AQI monitors</a></li>
<li class="chapter" data-level="2.1.6" data-path="get-data.html"><a href="get-data.html#EPAsites"><i class="fa fa-check"></i><b>2.1.6</b> EPA Google Earth Site Maps</a></li>
<li class="chapter" data-level="2.1.7" data-path="get-data.html"><a href="get-data.html#lims"><i class="fa fa-check"></i><b>2.1.7</b> Retrieving data from LIMS via Tableau</a></li>
<li class="chapter" data-level="2.1.8" data-path="get-data.html"><a href="get-data.html#AirVision"><i class="fa fa-check"></i><b>2.1.8</b> Retrieving continuous data from AirVision</a></li>
<li class="chapter" data-level="2.1.9" data-path="get-data.html"><a href="get-data.html#wair"><i class="fa fa-check"></i><b>2.1.9</b> Retrieving data from MPCA WAIR database</a></li>
<li class="chapter" data-level="2.1.10" data-path="get-data.html"><a href="get-data.html#toxics"><i class="fa fa-check"></i><b>2.1.10</b> Air toxics Data Explorer</a></li>
<li class="chapter" data-level="2.1.11" data-path="get-data.html"><a href="get-data.html#criteria"><i class="fa fa-check"></i><b>2.1.11</b> Criteria Pollutant Data Explorer</a></li>
<li class="chapter" data-level="2.1.12" data-path="get-data.html"><a href="get-data.html#AQI"><i class="fa fa-check"></i><b>2.1.12</b> Air Quality Index Summary Reports</a></li>
<li class="chapter" data-level="2.1.13" data-path="get-data.html"><a href="get-data.html#PAHs"><i class="fa fa-check"></i><b>2.1.13</b> Air Monitoring for PAHs</a></li>
<li class="chapter" data-level="2.1.14" data-path="get-data.html"><a href="get-data.html#tableau"><i class="fa fa-check"></i><b>2.1.14</b> Internal Data Explorers</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="get-data.html"><a href="get-data.html#health-and-standards"><i class="fa fa-check"></i><b>2.2</b> Health and standards</a><ul>
<li class="chapter" data-level="2.2.1" data-path="get-data.html"><a href="get-data.html#IHBs"><i class="fa fa-check"></i><b>2.2.1</b> Inhalation health benchmarks (IHBs)</a></li>
<li class="chapter" data-level="2.2.2" data-path="get-data.html"><a href="get-data.html#NAAQS"><i class="fa fa-check"></i><b>2.2.2</b> Air Quality Standards (NAAQS and MAAQS)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="get-data.html"><a href="get-data.html#air-modeling"><i class="fa fa-check"></i><b>2.3</b> Air modeling</a><ul>
<li class="chapter" data-level="2.3.1" data-path="get-data.html"><a href="get-data.html#nata"><i class="fa fa-check"></i><b>2.3.1</b> NATA modeling</a></li>
<li class="chapter" data-level="2.3.2" data-path="get-data.html"><a href="get-data.html#mnrisks"><i class="fa fa-check"></i><b>2.3.2</b> MNRISKS statewide risk modeling</a></li>
<li class="chapter" data-level="2.3.3" data-path="get-data.html"><a href="get-data.html#downscale"><i class="fa fa-check"></i><b>2.3.3</b> Downscaler modeling results for Ozone and PM2.5</a></li>
<li class="chapter" data-level="2.3.4" data-path="get-data.html"><a href="get-data.html#cmaq"><i class="fa fa-check"></i><b>2.3.4</b> CMAQ Ozone modeling</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="get-data.html"><a href="get-data.html#context"><i class="fa fa-check"></i><b>2.4</b> Context</a><ul>
<li class="chapter" data-level="2.4.1" data-path="get-data.html"><a href="get-data.html#mn-ei"><i class="fa fa-check"></i><b>2.4.1</b> MN Emissions Inventory</a></li>
<li class="chapter" data-level="2.4.2" data-path="get-data.html"><a href="get-data.html#nei"><i class="fa fa-check"></i><b>2.4.2</b> EPA’s NEI</a></li>
<li class="chapter" data-level="2.4.3" data-path="get-data.html"><a href="get-data.html#fac-coords"><i class="fa fa-check"></i><b>2.4.3</b> Facility locations</a></li>
<li class="chapter" data-level="2.4.4" data-path="get-data.html"><a href="get-data.html#wx-obs"><i class="fa fa-check"></i><b>2.4.4</b> Weather observations</a></li>
<li class="chapter" data-level="2.4.5" data-path="get-data.html"><a href="get-data.html#hysplit"><i class="fa fa-check"></i><b>2.4.5</b> HYSPLIT wind trajectories</a></li>
<li class="chapter" data-level="2.4.6" data-path="get-data.html"><a href="get-data.html#landuse"><i class="fa fa-check"></i><b>2.4.6</b> Land use maps</a></li>
<li class="chapter" data-level="2.4.7" data-path="get-data.html"><a href="get-data.html#census"><i class="fa fa-check"></i><b>2.4.7</b> United States Census boundaries</a></li>
<li class="chapter" data-level="2.4.8" data-path="get-data.html"><a href="get-data.html#acs"><i class="fa fa-check"></i><b>2.4.8</b> American Community Survey (ACS)</a></li>
</ul></li>
</ul></li>
<li><a href="quality-assurance-methods.html#quality-assurance-methods"><strong>Quality assurance methods</strong></a></li>
<li class="chapter" data-level="3" data-path="data-cleaning.html"><a href="data-cleaning.html"><i class="fa fa-check"></i><b>3</b> Data cleaning</a><ul>
<li class="chapter" data-level="3.1" data-path="data-cleaning.html"><a href="data-cleaning.html#missing"><i class="fa fa-check"></i><b>3.1</b> Blank, NULL, and missing values</a></li>
<li class="chapter" data-level="3.2" data-path="data-cleaning.html"><a href="data-cleaning.html#quals"><i class="fa fa-check"></i><b>3.2</b> Qualified data</a></li>
<li class="chapter" data-level="3.3" data-path="data-cleaning.html"><a href="data-cleaning.html#dups"><i class="fa fa-check"></i><b>3.3</b> Duplicate observations</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-validation.html"><a href="data-validation.html"><i class="fa fa-check"></i><b>4</b> Data validation</a><ul>
<li class="chapter" data-level="4.1" data-path="data-validation.html"><a href="data-validation.html#leaks"><i class="fa fa-check"></i><b>4.1</b> Instrument drift or leaks in a system.</a></li>
<li class="chapter" data-level="4.2" data-path="data-validation.html"><a href="data-validation.html#outs"><i class="fa fa-check"></i><b>4.2</b> Extreme values and outliers</a></li>
<li class="chapter" data-level="4.3" data-path="data-validation.html"><a href="data-validation.html#sticky2"><i class="fa fa-check"></i><b>4.3</b> Sequential repeats and “sticky” numbers</a></li>
<li class="chapter" data-level="4.4" data-path="data-validation.html"><a href="data-validation.html#unique"><i class="fa fa-check"></i><b>4.4</b> Unique detected values</a></li>
<li class="chapter" data-level="4.5" data-path="data-validation.html"><a href="data-validation.html#valid_ref"><i class="fa fa-check"></i><b>4.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="collocated-monitors.html"><a href="collocated-monitors.html"><i class="fa fa-check"></i><b>5</b> Collocated monitors</a><ul>
<li class="chapter" data-level="5.1" data-path="collocated-monitors.html"><a href="collocated-monitors.html#evalpocs"><i class="fa fa-check"></i><b>5.1</b> Evaluate collocated air monitors</a></li>
<li class="chapter" data-level="5.2" data-path="collocated-monitors.html"><a href="collocated-monitors.html#pripocs"><i class="fa fa-check"></i><b>5.2</b> Prioritize multiple air monitors (POCs)</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="detection-limits.html"><a href="detection-limits.html"><i class="fa fa-check"></i><b>6</b> Detection limits</a><ul>
<li class="chapter" data-level="6.1" data-path="detection-limits.html"><a href="detection-limits.html#method-detection-limit"><i class="fa fa-check"></i><b>6.1</b> Method Detection Limit</a></li>
<li class="chapter" data-level="6.2" data-path="detection-limits.html"><a href="detection-limits.html#calculating-mdls"><i class="fa fa-check"></i><b>6.2</b> Calculating MDLs</a></li>
<li class="chapter" data-level="6.3" data-path="detection-limits.html"><a href="detection-limits.html#finding-mpca-detection-limits"><i class="fa fa-check"></i><b>6.3</b> Finding MPCA detection limits</a></li>
<li class="chapter" data-level="6.4" data-path="detection-limits.html"><a href="detection-limits.html#qualifier-codes-for-detection-limits"><i class="fa fa-check"></i><b>6.4</b> Qualifier Codes for Detection Limits</a></li>
<li class="chapter" data-level="6.5" data-path="detection-limits.html"><a href="detection-limits.html#estimating-below-detection-values-what-not-to-do"><i class="fa fa-check"></i><b>6.5</b> Estimating below detection values <em>(what not to do)</em></a></li>
<li class="chapter" data-level="6.6" data-path="detection-limits.html"><a href="detection-limits.html#below-detection-values"><i class="fa fa-check"></i><b>6.6</b> Below detection values</a></li>
<li class="chapter" data-level="6.7" data-path="detection-limits.html"><a href="detection-limits.html#multiple-detection-limits"><i class="fa fa-check"></i><b>6.7</b> Multiple detection limits</a></li>
<li class="chapter" data-level="6.8" data-path="detection-limits.html"><a href="detection-limits.html#reporting-limits"><i class="fa fa-check"></i><b>6.8</b> Reporting limits</a></li>
<li class="chapter" data-level="6.9" data-path="detection-limits.html"><a href="detection-limits.html#references"><i class="fa fa-check"></i><b>6.9</b> References</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="completeness-checks.html"><a href="completeness-checks.html"><i class="fa fa-check"></i><b>7</b> Completeness checks</a><ul>
<li class="chapter" data-level="7.1" data-path="completeness-checks.html"><a href="completeness-checks.html#complete"><i class="fa fa-check"></i><b>7.1</b> Completeness checks</a></li>
</ul></li>
<li><a href="summary-methods.html#summary-methods"><strong>Summary methods</strong></a></li>
<li class="chapter" data-level="8" data-path="summary-statistics.html"><a href="summary-statistics.html"><i class="fa fa-check"></i><b>8</b> Summary statistics</a><ul>
<li class="chapter" data-level="8.1" data-path="summary-statistics.html"><a href="summary-statistics.html#normal"><i class="fa fa-check"></i><b>8.1</b> Test for normality</a></li>
<li class="chapter" data-level="8.2" data-path="summary-statistics.html"><a href="summary-statistics.html#boots"><i class="fa fa-check"></i><b>8.2</b> Bootstrapping</a></li>
<li class="chapter" data-level="8.3" data-path="summary-statistics.html"><a href="summary-statistics.html#below"><i class="fa fa-check"></i><b>8.3</b> Below the detection limit</a></li>
<li class="chapter" data-level="8.4" data-path="summary-statistics.html"><a href="summary-statistics.html#confidence"><i class="fa fa-check"></i><b>8.4</b> Upper confidence limits (UCLs)</a></li>
<li class="chapter" data-level="8.5" data-path="summary-statistics.html"><a href="summary-statistics.html#incomplete"><i class="fa fa-check"></i><b>8.5</b> Annual summaries for incomplete data</a></li>
<li class="chapter" data-level="8.6" data-path="summary-statistics.html"><a href="summary-statistics.html#health"><i class="fa fa-check"></i><b>8.6</b> Comparison of data to inhalation health benchmarks</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="site-comparisons.html"><a href="site-comparisons.html"><i class="fa fa-check"></i><b>9</b> Site comparisons</a><ul>
<li class="chapter" data-level="9.1" data-path="site-comparisons.html"><a href="site-comparisons.html#confidence-intervals"><i class="fa fa-check"></i><b>9.1</b> Confidence intervals</a></li>
<li class="chapter" data-level="9.2" data-path="site-comparisons.html"><a href="site-comparisons.html#tools-to-visualize-data"><i class="fa fa-check"></i><b>9.2</b> Tools to visualize data</a><ul>
<li class="chapter" data-level="9.2.1" data-path="site-comparisons.html"><a href="site-comparisons.html#beeswarm-plots"><i class="fa fa-check"></i><b>9.2.1</b> Beeswarm Plots</a></li>
<li class="chapter" data-level="9.2.2" data-path="site-comparisons.html"><a href="site-comparisons.html#correlation-matrices"><i class="fa fa-check"></i><b>9.2.2</b> Correlation matrices</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="start-finish.html"><a href="start-finish.html"><i class="fa fa-check"></i><b>10</b> From start to finish</a><ul>
<li class="chapter" data-level="10.1" data-path="start-finish.html"><a href="start-finish.html#functions"><i class="fa fa-check"></i><b>10.1</b> Functions</a></li>
<li class="chapter" data-level="10.2" data-path="start-finish.html"><a href="start-finish.html#analysis-steps"><i class="fa fa-check"></i><b>10.2</b> Analysis steps</a></li>
</ul></li>
<li><a href="visuals.html#visuals"><strong>Visuals</strong></a></li>
<li class="chapter" data-level="11" data-path="charts.html"><a href="charts.html"><i class="fa fa-check"></i><b>11</b> Charts</a><ul>
<li class="chapter" data-level="11.1" data-path="charts.html"><a href="charts.html#calendar-plots"><i class="fa fa-check"></i><b>11.1</b> Calendar plots</a></li>
<li class="chapter" data-level="11.2" data-path="charts.html"><a href="charts.html#colors-and-themes"><i class="fa fa-check"></i><b>11.2</b> Colors and themes</a></li>
<li class="chapter" data-level="11.3" data-path="charts.html"><a href="charts.html#pollution-roses"><i class="fa fa-check"></i><b>11.3</b> Pollution roses</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="time-series.html"><a href="time-series.html"><i class="fa fa-check"></i><b>12</b> Time series</a><ul>
<li class="chapter" data-level="" data-path="time-series.html"><a href="time-series.html#hour-of-the-day"><i class="fa fa-check"></i>Hour of the day</a></li>
<li class="chapter" data-level="" data-path="time-series.html"><a href="time-series.html#day-of-the-week"><i class="fa fa-check"></i>Day of the week</a></li>
<li class="chapter" data-level="" data-path="time-series.html"><a href="time-series.html#seasonality"><i class="fa fa-check"></i>Seasonality</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i><b>13</b> Maps</a><ul>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#interactive-map-of-air-monitors"><i class="fa fa-check"></i>Interactive map of air monitors</a></li>
<li class="chapter" data-level="" data-path="maps.html"><a href="maps.html#creating-shapefiles-in-r"><i class="fa fa-check"></i>Creating shapefiles in R</a></li>
</ul></li>
<li><a href="mpca-data-tools.html#mpca-data-tools"><strong>MPCA data tools</strong></a></li>
<li class="chapter" data-level="14" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html"><i class="fa fa-check"></i><b>14</b> Air toxics explorer</a><ul>
<li class="chapter" data-level="14.1" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#mpca-air-toxics-methods"><i class="fa fa-check"></i><b>14.1</b> MPCA Air Toxics Methods</a><ul>
<li class="chapter" data-level="14.1.1" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#data-cleaning-1"><i class="fa fa-check"></i><b>14.1.1</b> Data Cleaning</a></li>
<li class="chapter" data-level="14.1.2" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#data-validation-1"><i class="fa fa-check"></i><b>14.1.2</b> Data Validation</a></li>
<li class="chapter" data-level="14.1.3" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#parameter-occurrence-codes-pocs"><i class="fa fa-check"></i><b>14.1.3</b> Parameter Occurrence Codes (POCs)</a></li>
<li class="chapter" data-level="14.1.4" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#producing-annual-summaries"><i class="fa fa-check"></i><b>14.1.4</b> Producing Annual Summaries</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="criteria-pollutant-explorer.html"><a href="criteria-pollutant-explorer.html"><i class="fa fa-check"></i><b>15</b> Criteria pollutant explorer</a></li>
<li class="chapter" data-level="16" data-path="aqi-explorer.html"><a href="aqi-explorer.html"><i class="fa fa-check"></i><b>16</b> AQI explorer</a></li>
<li class="chapter" data-level="" data-path="edit-this-book.html"><a href="edit-this-book.html"><i class="fa fa-check"></i>Edit this book</a><ul>
<li class="chapter" data-level="16.1" data-path="edit-this-book.html"><a href="edit-this-book.html#references-1"><i class="fa fa-check"></i><b>16.1</b> References</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/MPCA-air" target="blank">Created by MPCA-air</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="get-data" class="section level1">
<h1><span class="header-section-number"></span> Get data</h1>
<p><br></p>
<p><img src="images/cover1.jpg" align="right" style="margin-top: -4px; margin-left: 20px; width: 36%;" /></p>
<p>This section describes how to download air monitoring and modeling data.</p>
<p><strong>Air monitoring data</strong></p>
<ul>
<li>Final data <br>
<ul>
<li><a href="get-data.html#AQS">2.1.1</a> EPA AQS Database</li>
<li><a href="get-data.html#rqamd">2.1.2</a> EPA AQS Datamart (RQAMD Package)</li>
<li><a href="get-data.html#lims">2.1.7</a> MPCA LIMS data via Tableau</li>
<li><a href="get-data.html#wair">2.1.9</a> MPCA WAIR Database</li>
</ul></li>
<li>Preliminary data
<ul>
<li><a href="get-data.html#aqi-now">2.1.3</a> AirNow: Current AQI observations</li>
<li><a href="get-data.html#AirVision">2.1.8</a> AirVision: Continuous data</li>
</ul></li>
<li>Air Monitoring Site Information
<ul>
<li><a href="get-data.html#wairsites">2.1.4</a> WAIR Site Table</li>
<li><a href="get-data.html#monitors">2.1.5</a> AirNow: Active AQI monitors</li>
<li><a href="get-data.html#EPAsites">2.1.6</a> EPA Google Earth Site Explorer</li>
</ul></li>
</ul>
<p><strong>Summarized air monitoring results</strong></p>
<ul>
<li>External Data Explorers
<ul>
<li><a href="get-data.html#toxics">2.1.10</a> Air Toxics Data Explorer</li>
<li><a href="get-data.html#criteria">2.1.11</a> Criteria Pollutant Data Explorer</li>
<li><a href="get-data.html#AQI">2.1.12</a> Air Quality Index Summary Reports</li>
<li><a href="get-data.html#PAHs">2.1.13</a> Air Monitoring for PAHs</li>
</ul></li>
<li>Internal Data Explorers
<ul>
<li><a href="get-data.html#tableau">2.1.14</a> MPCA Tableau Server</li>
</ul></li>
</ul>
<p><strong>Health benchmarks and air quality standards</strong></p>
<ul>
<li>Air toxics
<ul>
<li><a href="get-data.html#IHBs">2.2.1</a> Inhalation health benchmarks</li>
</ul></li>
<li>Criteria pollutants
<ul>
<li><a href="get-data.html#NAAQS">2.2.2</a> Air Quality Standards (NAAQs and MAAQS)</li>
</ul></li>
</ul>
<p><strong>Air modeling</strong></p>
<ul>
<li>Modeling results
<ul>
<li><a href="get-data.html#nata">2.3.1</a> NATA</li>
<li><a href="get-data.html#mnrisks">2.3.2</a> MNRISKS</li>
<li><a href="get-data.html#downscale">2.3.3</a> Downscaler for Ozone and PM2.5</li>
<li><a href="get-data.html#cmaq">2.3.4</a> CMAQ</li>
</ul></li>
</ul>
<p><strong>Context</strong></p>
<ul>
<li>Emissions
<ul>
<li><a href="get-data.html#mn-ei">2.4.1</a> MN Emissions Inventory</li>
<li><a href="get-data.html#nei">2.4.2</a> EPA’s NEI</li>
<li><a href="get-data.html#fac-coords">2.4.3</a> Facility locations</li>
</ul></li>
<li>Meteorology and Climate
<ul>
<li><a href="get-data.html#wx-obs">2.4.4</a> Weather observations</li>
<li><a href="get-data.html#hysplit">2.4.5</a> HYSPLIT wind trajectories</li>
</ul></li>
<li>Geography and Census data
<ul>
<li><a href="get-data.html#landuse">2.4.6</a> Land use maps</li>
<li><a href="get-data.html#census">2.4.7</a> U.S. Census boundaries</li>
<li><a href="get-data.html#acs">2.4.8</a> Demographics from American Community Survey (ACS)</li>
</ul></li>
</ul>
<p><br></p>
<div id="air-monitoring" class="section level2">
<h2><span class="header-section-number">2.1</span> Air monitoring</h2>
<div id="AQS" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Retrieving data from AQS</h3>
<p>The Air Quality System (AQS) contains ambient air pollution data collected by EPA, state, local, and tribal air pollution control agencies from over thousands of monitors. AQS also contains meteorological data, descriptive information about each monitoring station (including its geographic location and its operator), and data quality assurance/quality control information.</p>
<p>Registered users can access the AQS database via a web application at <a href="https://www.epa.gov/aqs" class="uri">https://www.epa.gov/aqs</a>. Raw data extracts can be run using the AMP501 report. The AMP501 provides data in the pipe delimited RD transaction format.</p>
</div>
<div id="rqamd" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Retrieving data from AQS DataMart</h3>
<p>The AQS Data Mart provides a convenient API to access air quality data stored in the EPA’s AQS database, [AQS Data Mart] (<a href="https://aqs.epa.gov/aqsweb/documents/data_mart_welcome.html" class="uri">https://aqs.epa.gov/aqsweb/documents/data_mart_welcome.html</a>)</p>
<p>Note: The AQS Data Mart requires a user name and password. The username and password is not the same as your AQS User Account. To request a Data Mart account, follow the instructions on the Data Mart page.</p>
<p>The <code>RQAMD</code> package allows users to query the AQS Data Mart in R, see <a href="https://github.com/ebailey78/raqdm">RQAMD</a> on Github.</p>
<p>Warning: Data from AQS Data Mart does not include null results.</p>
<p><br> <strong>Sample <code>R</code> script</strong></p>
<p>Click the button below to view a step by step example.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="get-data.html#cb1-1"></a><span class="co">##install raqdm package</span></span>
<span id="cb1-2"><a href="get-data.html#cb1-2"></a><span class="kw">library</span>(devtools)</span>
<span id="cb1-3"><a href="get-data.html#cb1-3"></a>devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;ebailey78/raqdm&quot;</span>)</span>
<span id="cb1-4"><a href="get-data.html#cb1-4"></a><span class="kw">library</span>(raqdm)</span>
<span id="cb1-5"><a href="get-data.html#cb1-5"></a></span>
<span id="cb1-6"><a href="get-data.html#cb1-6"></a><span class="co">##set Data Mart username and password.</span></span>
<span id="cb1-7"><a href="get-data.html#cb1-7"></a></span>
<span id="cb1-8"><a href="get-data.html#cb1-8"></a><span class="kw">setAQDMuser</span>(<span class="st">&quot;User Name&quot;</span>,<span class="st">&quot;PW&quot;</span>,<span class="dt">save=</span><span class="ot">TRUE</span>) <span class="co">#Note save=TRUE creates a file that stores username and password locally, you will not need to run setuser info each time you load raqdm. </span></span>
<span id="cb1-9"><a href="get-data.html#cb1-9"></a></span>
<span id="cb1-10"><a href="get-data.html#cb1-10"></a><span class="kw">setAQDMdefaults</span>(<span class="dt">pc=</span><span class="st">&quot;CRITERIA&quot;</span>, <span class="dt">state=</span><span class="st">&quot;27&quot;</span>, <span class="dt">save=</span><span class="ot">TRUE</span>) <span class="co">#Set defaults that are locally stored for queries. This eliminates need to define the data type and state code. </span></span>
<span id="cb1-11"><a href="get-data.html#cb1-11"></a></span>
<span id="cb1-12"><a href="get-data.html#cb1-12"></a></span>
<span id="cb1-13"><a href="get-data.html#cb1-13"></a><span class="co">## Single parameter query</span></span>
<span id="cb1-14"><a href="get-data.html#cb1-14"></a></span>
<span id="cb1-15"><a href="get-data.html#cb1-15"></a>x &lt;-<span class="st"> </span><span class="kw">getAQDMdata</span>(<span class="dt">state=</span><span class="st">&quot;27&quot;</span>,<span class="dt">pc=</span><span class="st">&quot;CRITERIA&quot;</span>,<span class="dt">param=</span><span class="st">&quot;42602&quot;</span>,<span class="dt">format=</span><span class="st">&quot;AQCSV&quot;</span>,<span class="dt">bdate=</span><span class="st">&quot;20140101&quot;</span>,<span class="dt">edate=</span><span class="st">&quot;20141231&quot;</span>,<span class="dt">synchronous =</span> <span class="ot">FALSE</span>) <span class="co"># Queries Data Mart DataBase</span></span>
<span id="cb1-16"><a href="get-data.html#cb1-16"></a></span>
<span id="cb1-17"><a href="get-data.html#cb1-17"></a>aqcsv &lt;-<span class="st"> </span><span class="kw">getAQDMrequest</span>(x) <span class="co"># Wait for email confirming file is ready. </span></span>
<span id="cb1-18"><a href="get-data.html#cb1-18"></a></span>
<span id="cb1-19"><a href="get-data.html#cb1-19"></a></span>
<span id="cb1-20"><a href="get-data.html#cb1-20"></a><span class="co">## Multiple parameter loops</span></span>
<span id="cb1-21"><a href="get-data.html#cb1-21"></a></span>
<span id="cb1-22"><a href="get-data.html#cb1-22"></a></span>
<span id="cb1-23"><a href="get-data.html#cb1-23"></a>params &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;45201&quot;</span>, <span class="st">&quot;42602&quot;</span>, <span class="st">&quot;44201&quot;</span>) <span class="co">#Create a vector with the parameters you are interested in</span></span>
<span id="cb1-24"><a href="get-data.html#cb1-24"></a></span>
<span id="cb1-25"><a href="get-data.html#cb1-25"></a><span class="co"># Use lapply to loop through the params vector, requesting each one from AQDM. A list of requests will be returned to the x variable</span></span>
<span id="cb1-26"><a href="get-data.html#cb1-26"></a>x &lt;-<span class="st"> </span><span class="kw">lapply</span>(params, <span class="cf">function</span>(p) {</span>
<span id="cb1-27"><a href="get-data.html#cb1-27"></a>  <span class="kw">return</span>(<span class="kw">getAQDMdata</span>(<span class="dt">param=</span>p))</span>
<span id="cb1-28"><a href="get-data.html#cb1-28"></a>})</span>
<span id="cb1-29"><a href="get-data.html#cb1-29"></a></span>
<span id="cb1-30"><a href="get-data.html#cb1-30"></a><span class="co"># Now loop through the requests to retrieve the data</span></span>
<span id="cb1-31"><a href="get-data.html#cb1-31"></a>y &lt;-<span class="st"> </span><span class="kw">lapply</span>(x, <span class="cf">function</span>(r) {</span>
<span id="cb1-32"><a href="get-data.html#cb1-32"></a>  <span class="kw">return</span>(<span class="kw">getAQDMrequest</span>(r))</span>
<span id="cb1-33"><a href="get-data.html#cb1-33"></a>})</span>
<span id="cb1-34"><a href="get-data.html#cb1-34"></a></span>
<span id="cb1-35"><a href="get-data.html#cb1-35"></a><span class="co"># Use do.call and rbind to combine them into one data.frame</span></span>
<span id="cb1-36"><a href="get-data.html#cb1-36"></a>d &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, y)</span></code></pre></div>
</div>
<p><br></p>
</div>
<div id="aqi-now" class="section level3">
<h3><span class="header-section-number">2.1.3</span> Current AQI observations</h3>
<p>Real-time air data for the entire United States is at your finger tips. <em>EPA’s AirNow</em> maintains a publicly accessible folder of current air monitoring data at <a href="https://files.airnowtech.org/" class="uri">https://files.airnowtech.org/</a>. Data retrieved from AirNow is preliminary and may change following quality assurance.</p>
<p><br> <strong>Sample <code>R</code> script</strong></p>
<p>Use the following R code to grab the most recent AQI results for the entire country.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="get-data.html#cb2-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb2-2"><a href="get-data.html#cb2-2"></a><span class="kw">library</span>(readr)</span>
<span id="cb2-3"><a href="get-data.html#cb2-3"></a></span>
<span id="cb2-4"><a href="get-data.html#cb2-4"></a><span class="co"># Connect to AirNow data site</span></span>
<span id="cb2-5"><a href="get-data.html#cb2-5"></a><span class="co">#https://files.airnowtech.org/</span></span>
<span id="cb2-6"><a href="get-data.html#cb2-6"></a></span>
<span id="cb2-7"><a href="get-data.html#cb2-7"></a>airnow_link &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;https://s3-us-west-1.amazonaws.com//files.airnowtech.org/airnow/today/&quot;</span>,</span>
<span id="cb2-8"><a href="get-data.html#cb2-8"></a>                      <span class="st">&quot;HourlyData_&quot;</span>,</span>
<span id="cb2-9"><a href="get-data.html#cb2-9"></a>                      <span class="kw">format</span>(<span class="kw">Sys.time</span>() <span class="op">-</span><span class="st"> </span><span class="dv">60</span><span class="op">*</span><span class="dv">75</span>, <span class="st">&quot;%Y%m%d%H&quot;</span>, <span class="dt">tz =</span> <span class="st">&quot;GMT&quot;</span>),</span>
<span id="cb2-10"><a href="get-data.html#cb2-10"></a>                      <span class="st">&quot;.dat&quot;</span>)</span>
<span id="cb2-11"><a href="get-data.html#cb2-11"></a>  </span>
<span id="cb2-12"><a href="get-data.html#cb2-12"></a>aqi_now   &lt;-<span class="st"> </span><span class="kw">read_delim</span>(airnow_link, <span class="st">&quot;|&quot;</span>, </span>
<span id="cb2-13"><a href="get-data.html#cb2-13"></a>                        <span class="dt">col_names =</span> F)</span>
<span id="cb2-14"><a href="get-data.html#cb2-14"></a>                        <span class="co">#col_types = c(&#39;cccciccdc&#39;))</span></span>
<span id="cb2-15"><a href="get-data.html#cb2-15"></a> </span>
<span id="cb2-16"><a href="get-data.html#cb2-16"></a><span class="co"># Add column names</span></span>
<span id="cb2-17"><a href="get-data.html#cb2-17"></a><span class="kw">names</span>(aqi_now) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;aqsid&quot;</span>, <span class="st">&quot;city&quot;</span>, <span class="st">&quot;local_time&quot;</span>, <span class="st">&quot;parameter&quot;</span>, <span class="st">&quot;units&quot;</span>, <span class="st">&quot;concentration&quot;</span>, <span class="st">&quot;agency&quot;</span>)</span>
<span id="cb2-18"><a href="get-data.html#cb2-18"></a></span>
<span id="cb2-19"><a href="get-data.html#cb2-19"></a></span>
<span id="cb2-20"><a href="get-data.html#cb2-20"></a><span class="co"># Filter to Ozone and PM2.5 results</span></span>
<span id="cb2-21"><a href="get-data.html#cb2-21"></a>aqi_now &lt;-<span class="st"> </span><span class="kw">filter</span>(aqi_now, parameter <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;OZONE&quot;</span>, <span class="st">&quot;PM2.5&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="wairsites" class="section level3">
<h3><span class="header-section-number">2.1.4</span> WAIR Site information table</h3>
<p>The WAIR database includes a copy of the EPA site information table, which includes site names and location information.</p>
<p><strong>Sample <code>R</code> script</strong></p>
<p>Click the button below to view a step by step example.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="get-data.html#cb3-1"></a><span class="kw">library</span>(RPostgreSQL)</span>
<span id="cb3-2"><a href="get-data.html#cb3-2"></a>username &lt;-<span class="st"> </span><span class="co">#Add WAIR UserName</span></span>
<span id="cb3-3"><a href="get-data.html#cb3-3"></a>pass &lt;-<span class="st"> </span><span class="co">#Add WAIR password</span></span>
<span id="cb3-4"><a href="get-data.html#cb3-4"></a></span>
<span id="cb3-5"><a href="get-data.html#cb3-5"></a><span class="co">## Load the PostgreSQL driver</span></span>
<span id="cb3-6"><a href="get-data.html#cb3-6"></a>drv &lt;-<span class="st"> </span><span class="kw">dbDriver</span>(<span class="st">&quot;PostgreSQL&quot;</span>) </span>
<span id="cb3-7"><a href="get-data.html#cb3-7"></a></span>
<span id="cb3-8"><a href="get-data.html#cb3-8"></a><span class="co">## Open a connection </span></span>
<span id="cb3-9"><a href="get-data.html#cb3-9"></a>con &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(drv, <span class="dt">dbname=</span><span class="st">&quot;wair&quot;</span>,<span class="dt">host=</span><span class="st">&#39;eiger&#39;</span>,<span class="dt">user=</span>username,<span class="dt">password=</span>pass) </span>
<span id="cb3-10"><a href="get-data.html#cb3-10"></a></span>
<span id="cb3-11"><a href="get-data.html#cb3-11"></a>sites &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con, </span>
<span id="cb3-12"><a href="get-data.html#cb3-12"></a>                    <span class="dt">statement =</span> <span class="kw">paste</span>(</span>
<span id="cb3-13"><a href="get-data.html#cb3-13"></a>                      <span class="st">&quot;SELECT *</span></span>
<span id="cb3-14"><a href="get-data.html#cb3-14"></a><span class="st">                      FROM wair.aqs.site  \</span></span>
<span id="cb3-15"><a href="get-data.html#cb3-15"></a><span class="st">                      &quot;</span></span>
<span id="cb3-16"><a href="get-data.html#cb3-16"></a>                    )); </span>
<span id="cb3-17"><a href="get-data.html#cb3-17"></a></span>
<span id="cb3-18"><a href="get-data.html#cb3-18"></a><span class="kw">dbDisconnect</span>(con)   <span class="co">## Closes the connection</span></span>
<span id="cb3-19"><a href="get-data.html#cb3-19"></a><span class="kw">dbUnloadDriver</span>(drv) <span class="co">## Frees all the resources on the driver</span></span></code></pre></div>
</div>
</div>
<div id="monitors" class="section level3">
<h3><span class="header-section-number">2.1.5</span> AirNow:Active AQI monitors</h3>
<p>A map of MPCA’s air monitoring network is available online at <a href="https://www.pca.state.mn.us/air/minnesota-air-monitoring-sites">Minnesota air monitoring sites</a>.</p>
<p>A list of all active AQI monitoring locations around the United States are published to <a href="https://files.airnowtech.org/?prefix=airnow/today/"><em>AirNow</em></a> in the <code>monitoring_site_locations.dat</code> file.</p>
<p><br> <strong>Sample <code>R</code> script</strong></p>
<p>Click the button below to view a step by step example.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="get-data.html#cb4-1"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb4-2"><a href="get-data.html#cb4-2"></a><span class="kw">library</span>(readr)</span>
<span id="cb4-3"><a href="get-data.html#cb4-3"></a></span>
<span id="cb4-4"><a href="get-data.html#cb4-4"></a><span class="co"># Connect to AirNow data site</span></span>
<span id="cb4-5"><a href="get-data.html#cb4-5"></a><span class="co">#https://files.airnowtech.org/</span></span>
<span id="cb4-6"><a href="get-data.html#cb4-6"></a></span>
<span id="cb4-7"><a href="get-data.html#cb4-7"></a>airnow_link &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;https://s3-us-west-1.amazonaws.com//files.airnowtech.org/airnow/today/&quot;</span>,</span>
<span id="cb4-8"><a href="get-data.html#cb4-8"></a>                      <span class="st">&quot;monitoring_site_locations.dat&quot;</span>)</span>
<span id="cb4-9"><a href="get-data.html#cb4-9"></a>  </span>
<span id="cb4-10"><a href="get-data.html#cb4-10"></a>aqi_sites   &lt;-<span class="st"> </span><span class="kw">read_delim</span>(airnow_link, <span class="st">&quot;|&quot;</span>, <span class="dt">col_names =</span> F)</span>
<span id="cb4-11"><a href="get-data.html#cb4-11"></a> </span>
<span id="cb4-12"><a href="get-data.html#cb4-12"></a><span class="co"># Drop empty columns</span></span>
<span id="cb4-13"><a href="get-data.html#cb4-13"></a>aqi_sites &lt;-<span class="st"> </span>aqi_sites[ , <span class="op">-</span><span class="kw">c</span>(<span class="dv">14</span><span class="op">:</span><span class="dv">16</span>,<span class="dv">22</span><span class="op">:</span><span class="dv">23</span>)]</span>
<span id="cb4-14"><a href="get-data.html#cb4-14"></a></span>
<span id="cb4-15"><a href="get-data.html#cb4-15"></a><span class="co"># Add column names</span></span>
<span id="cb4-16"><a href="get-data.html#cb4-16"></a><span class="kw">names</span>(aqi_sites) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;aqsid&quot;</span>, </span>
<span id="cb4-17"><a href="get-data.html#cb4-17"></a>                      <span class="st">&quot;parameter&quot;</span>, </span>
<span id="cb4-18"><a href="get-data.html#cb4-18"></a>                      <span class="st">&quot;local_id&quot;</span>, </span>
<span id="cb4-19"><a href="get-data.html#cb4-19"></a>                      <span class="st">&quot;name&quot;</span>, </span>
<span id="cb4-20"><a href="get-data.html#cb4-20"></a>                      <span class="st">&quot;status&quot;</span>, </span>
<span id="cb4-21"><a href="get-data.html#cb4-21"></a>                      <span class="st">&quot;state_region&quot;</span>, </span>
<span id="cb4-22"><a href="get-data.html#cb4-22"></a>                      <span class="st">&quot;agency&quot;</span>, </span>
<span id="cb4-23"><a href="get-data.html#cb4-23"></a>                      <span class="st">&quot;epa_region&quot;</span>, </span>
<span id="cb4-24"><a href="get-data.html#cb4-24"></a>                      <span class="st">&quot;lat&quot;</span>, </span>
<span id="cb4-25"><a href="get-data.html#cb4-25"></a>                      <span class="st">&quot;long&quot;</span>, </span>
<span id="cb4-26"><a href="get-data.html#cb4-26"></a>                      <span class="st">&quot;elevation&quot;</span>,</span>
<span id="cb4-27"><a href="get-data.html#cb4-27"></a>                      <span class="st">&quot;local_time&quot;</span>,</span>
<span id="cb4-28"><a href="get-data.html#cb4-28"></a>                      <span class="st">&quot;country&quot;</span>,</span>
<span id="cb4-29"><a href="get-data.html#cb4-29"></a>                      <span class="st">&quot;city&quot;</span>,</span>
<span id="cb4-30"><a href="get-data.html#cb4-30"></a>                      <span class="st">&quot;state_fips&quot;</span>,</span>
<span id="cb4-31"><a href="get-data.html#cb4-31"></a>                      <span class="st">&quot;state&quot;</span>,</span>
<span id="cb4-32"><a href="get-data.html#cb4-32"></a>                      <span class="st">&quot;county_fips&quot;</span>,</span>
<span id="cb4-33"><a href="get-data.html#cb4-33"></a>                      <span class="st">&quot;county&quot;</span>)</span>
<span id="cb4-34"><a href="get-data.html#cb4-34"></a>                    </span>
<span id="cb4-35"><a href="get-data.html#cb4-35"></a></span>
<span id="cb4-36"><a href="get-data.html#cb4-36"></a><span class="co"># Filter to Minnesota sites</span></span>
<span id="cb4-37"><a href="get-data.html#cb4-37"></a>aqi_sites  &lt;-<span class="st"> </span><span class="kw">filter</span>(aqi_sites, state_fips <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">27</span>))</span></code></pre></div>
</div>
<p><br></p>
</div>
<div id="EPAsites" class="section level3">
<h3><span class="header-section-number">2.1.6</span> EPA Google Earth Site Maps</h3>
<p>The AirData Air Quality Monitors app is a mapping application available on the web and on mobile devices that displays monitor locations and monitor-specific information. It also allows the querying and downloading of data daily and annual summary data. Static KMZ files are also available to download.</p>
<p><a href="https://www.epa.gov/outdoor-air-quality-data/interactive-map-air-quality-monitors" class="uri">https://www.epa.gov/outdoor-air-quality-data/interactive-map-air-quality-monitors</a></p>
</div>
<div id="lims" class="section level3">
<h3><span class="header-section-number">2.1.7</span> Retrieving data from LIMS via Tableau</h3>
<p>The LIMS database is the primary data warehouse for AQ monitoring activities. The LIMS system is being retired and replaced. To ease data accessibilty during this transition LIMS data are available for download via an internal Tableau workbook at <a href="http://tableau.pca.state.mn.us/#/workbooks/3342" class="uri">http://tableau.pca.state.mn.us/#/workbooks/3342</a></p>
<p><br> <strong>Sample <code>R</code> script</strong></p>
<p>The following function reads LIMS data from Tableau. All inputs must be provided. The inputs are:</p>
<p>Sites: Integer vector representing site numbers (no state code, county code, or POC)
Parameter_list: Integer vector representing parameters to extract.
Start_date: Character string of date in YYYY-MM-DD format (or other format recognized by ymd())
End_date: Character string of date in YYYY-MM-DD format (or other format recognized by ymd())
Pollutant_Groups: Character vector of pollutant groups to extract. Air toxics include “metals (TSP)”, “VOCs”, “carbonyls”.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="get-data.html#cb5-1"></a>read_AT_data_tableau =<span class="st"> </span><span class="cf">function</span>(Sites, Parameter_list, <span class="dt">Start_date =</span> <span class="st">&quot;2016-01-01&quot;</span>, <span class="dt">End_date =</span> <span class="st">&quot;2016-03-31&quot;</span>, <span class="dt">Pollutant_Groups =</span> <span class="kw">c</span>(<span class="st">&quot;metals (TSP)&quot;</span>, <span class="st">&quot;VOCs&quot;</span>, <span class="st">&quot;carbonyls&quot;</span>)) {</span>
<span id="cb5-2"><a href="get-data.html#cb5-2"></a>  </span>
<span id="cb5-3"><a href="get-data.html#cb5-3"></a>  sample_calendar &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">start         =</span> <span class="st">&quot;2016-01-01&quot;</span>, </span>
<span id="cb5-4"><a href="get-data.html#cb5-4"></a>                              <span class="dt">end           =</span> <span class="st">&quot;2016-12-31&quot;</span>, </span>
<span id="cb5-5"><a href="get-data.html#cb5-5"></a>                              <span class="dt">day_interval  =</span> <span class="dv">6</span>,</span>
<span id="cb5-6"><a href="get-data.html#cb5-6"></a>                              <span class="dt">type          =</span> <span class="st">&quot;air_toxics&quot;</span>) {</span>
<span id="cb5-7"><a href="get-data.html#cb5-7"></a>    </span>
<span id="cb5-8"><a href="get-data.html#cb5-8"></a>    <span class="kw">library</span>(lubridate)</span>
<span id="cb5-9"><a href="get-data.html#cb5-9"></a>    </span>
<span id="cb5-10"><a href="get-data.html#cb5-10"></a>    <span class="co"># Convert &#39;start&#39; and &#39;end&#39; to class date</span></span>
<span id="cb5-11"><a href="get-data.html#cb5-11"></a>    start &lt;-<span class="st"> </span><span class="kw">ymd</span>(start)</span>
<span id="cb5-12"><a href="get-data.html#cb5-12"></a>    end   &lt;-<span class="st"> </span><span class="kw">ymd</span>(end)</span>
<span id="cb5-13"><a href="get-data.html#cb5-13"></a>    </span>
<span id="cb5-14"><a href="get-data.html#cb5-14"></a>    <span class="co"># Set official start date to selected EPA calendar</span></span>
<span id="cb5-15"><a href="get-data.html#cb5-15"></a>    <span class="cf">if</span>(type <span class="op">==</span><span class="st"> &quot;air_toxics&quot;</span>) {</span>
<span id="cb5-16"><a href="get-data.html#cb5-16"></a>      epa_start &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">&quot;1989-12-24&quot;</span>)</span>
<span id="cb5-17"><a href="get-data.html#cb5-17"></a>    } <span class="cf">else</span> {</span>
<span id="cb5-18"><a href="get-data.html#cb5-18"></a>      epa_start &lt;-<span class="st"> </span>start</span>
<span id="cb5-19"><a href="get-data.html#cb5-19"></a>    }</span>
<span id="cb5-20"><a href="get-data.html#cb5-20"></a>    </span>
<span id="cb5-21"><a href="get-data.html#cb5-21"></a>    <span class="co"># Create full table of sampling dates</span></span>
<span id="cb5-22"><a href="get-data.html#cb5-22"></a>    calendar &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> epa_start, </span>
<span id="cb5-23"><a href="get-data.html#cb5-23"></a>                    <span class="dt">to   =</span> end, </span>
<span id="cb5-24"><a href="get-data.html#cb5-24"></a>                    <span class="dt">by   =</span> <span class="kw">paste</span>(day_interval, <span class="st">&quot;days&quot;</span>))</span>
<span id="cb5-25"><a href="get-data.html#cb5-25"></a>    </span>
<span id="cb5-26"><a href="get-data.html#cb5-26"></a>    </span>
<span id="cb5-27"><a href="get-data.html#cb5-27"></a>    <span class="co"># Subset to user&#39;s date range</span></span>
<span id="cb5-28"><a href="get-data.html#cb5-28"></a>    calendar &lt;-<span class="st"> </span>calendar[calendar <span class="op">&gt;=</span><span class="st"> </span>start <span class="op">&amp;</span><span class="st"> </span>calendar <span class="op">&lt;=</span><span class="st"> </span>end]</span>
<span id="cb5-29"><a href="get-data.html#cb5-29"></a>    </span>
<span id="cb5-30"><a href="get-data.html#cb5-30"></a>    <span class="kw">return</span>(calendar)</span>
<span id="cb5-31"><a href="get-data.html#cb5-31"></a>    </span>
<span id="cb5-32"><a href="get-data.html#cb5-32"></a>  }</span>
<span id="cb5-33"><a href="get-data.html#cb5-33"></a>  </span>
<span id="cb5-34"><a href="get-data.html#cb5-34"></a>  <span class="co"># Generate air toxics sampling dates</span></span>
<span id="cb5-35"><a href="get-data.html#cb5-35"></a>  </span>
<span id="cb5-36"><a href="get-data.html#cb5-36"></a>  Dates =<span class="st"> </span><span class="kw">sample_calendar</span>(Start_date, End_date)</span>
<span id="cb5-37"><a href="get-data.html#cb5-37"></a>  </span>
<span id="cb5-38"><a href="get-data.html#cb5-38"></a>  <span class="co"># Break dates into quarters</span></span>
<span id="cb5-39"><a href="get-data.html#cb5-39"></a>  </span>
<span id="cb5-40"><a href="get-data.html#cb5-40"></a>  Quarters =<span class="st"> </span><span class="kw">quarter</span>(Dates, <span class="dt">with_year =</span> T)</span>
<span id="cb5-41"><a href="get-data.html#cb5-41"></a>  </span>
<span id="cb5-42"><a href="get-data.html#cb5-42"></a>  <span class="kw">library</span>(tidyverse)</span>
<span id="cb5-43"><a href="get-data.html#cb5-43"></a>  </span>
<span id="cb5-44"><a href="get-data.html#cb5-44"></a>  <span class="co"># Convert fields to Tableau url format</span></span>
<span id="cb5-45"><a href="get-data.html#cb5-45"></a>  </span>
<span id="cb5-46"><a href="get-data.html#cb5-46"></a>  base_url =<span class="st"> &quot;http://tableau.pca.state.mn.us/views/exportDailyData/Datawithnullcodes.csv?&quot;</span></span>
<span id="cb5-47"><a href="get-data.html#cb5-47"></a>  Sites =<span class="st"> </span><span class="kw">paste</span>(<span class="kw">paste0</span>(Sites,<span class="st">&quot;-1&quot;</span>, <span class="dt">collapse =</span> <span class="st">&quot;,&quot;</span>), <span class="kw">paste0</span>(Sites,<span class="st">&quot;-2&quot;</span>, <span class="dt">collapse =</span> <span class="st">&quot;,&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb5-48"><a href="get-data.html#cb5-48"></a>  Testnames =<span class="st"> </span>Pollutant_Groups <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">url_encode</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">paste0</span>(<span class="dt">collapse =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb5-49"><a href="get-data.html#cb5-49"></a>  Analytes =<span class="st"> </span><span class="kw">url_encode</span>(Analytes) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;%2c&quot;</span>, <span class="st">&quot;%5C%2C&quot;</span>,.) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">paste0</span>(<span class="dt">collapse =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb5-50"><a href="get-data.html#cb5-50"></a>  Parameter_list =<span class="st"> </span><span class="kw">paste0</span>(Parameter_list, <span class="dt">collapse =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb5-51"><a href="get-data.html#cb5-51"></a>  AT_data =<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb5-52"><a href="get-data.html#cb5-52"></a>  </span>
<span id="cb5-53"><a href="get-data.html#cb5-53"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">unique</span>(Quarters) ) {</span>
<span id="cb5-54"><a href="get-data.html#cb5-54"></a>  </span>
<span id="cb5-55"><a href="get-data.html#cb5-55"></a>  Dates2 =<span class="st"> </span><span class="kw">paste0</span>(Dates[Quarters <span class="op">==</span><span class="st"> </span>i], <span class="dt">collapse =</span> <span class="st">&quot;,&quot;</span>)</span>
<span id="cb5-56"><a href="get-data.html#cb5-56"></a>  </span>
<span id="cb5-57"><a href="get-data.html#cb5-57"></a>  <span class="co">#Construct url for Tableau</span></span>
<span id="cb5-58"><a href="get-data.html#cb5-58"></a>  </span>
<span id="cb5-59"><a href="get-data.html#cb5-59"></a>  url =<span class="st"> </span><span class="kw">paste0</span>(base_url,</span>
<span id="cb5-60"><a href="get-data.html#cb5-60"></a>                <span class="st">&quot;site%20and%20poc=&quot;</span>, Sites,</span>
<span id="cb5-61"><a href="get-data.html#cb5-61"></a>                <span class="st">&quot;&amp;TESTNAME=&quot;</span>, Testnames,</span>
<span id="cb5-62"><a href="get-data.html#cb5-62"></a>                <span class="st">&quot;&amp;ANALYTES_ANALYTE=&quot;</span>, Analytes,</span>
<span id="cb5-63"><a href="get-data.html#cb5-63"></a>                <span class="st">&quot;&amp;PARAMCODE=&quot;</span>, Parameter_list,</span>
<span id="cb5-64"><a href="get-data.html#cb5-64"></a>                <span class="st">&quot;&amp;RUNDATE=&quot;</span>, Dates2</span>
<span id="cb5-65"><a href="get-data.html#cb5-65"></a>  )</span>
<span id="cb5-66"><a href="get-data.html#cb5-66"></a>  </span>
<span id="cb5-67"><a href="get-data.html#cb5-67"></a>  <span class="co"># Read data from Tableau server</span></span>
<span id="cb5-68"><a href="get-data.html#cb5-68"></a>  </span>
<span id="cb5-69"><a href="get-data.html#cb5-69"></a>  AT_data =<span class="st"> </span><span class="kw">bind_rows</span>(AT_data, <span class="kw">read_csv</span>(url, <span class="dt">col_types =</span> <span class="st">&quot;ccccicccd&quot;</span>) )</span>
<span id="cb5-70"><a href="get-data.html#cb5-70"></a>  </span>
<span id="cb5-71"><a href="get-data.html#cb5-71"></a>  }</span>
<span id="cb5-72"><a href="get-data.html#cb5-72"></a>  </span>
<span id="cb5-73"><a href="get-data.html#cb5-73"></a>  <span class="kw">return</span>(AT_data)</span>
<span id="cb5-74"><a href="get-data.html#cb5-74"></a>}</span></code></pre></div>
</div>
</div>
<div id="AirVision" class="section level3">
<h3><span class="header-section-number">2.1.8</span> Retrieving continuous data from AirVision</h3>
<p>AirVision is the data acquistion and temporary storage database for continuous air monitoring data. Data collected in AirVision is transfered to LIMs and AQS for final data storage. If you need the most recent monitoring observations and would like to access continuous data before it has been transfered to the final data repository you can run reports from AirVision.</p>
<p>To run reports, the AirVision client must be installed on your computer and you need a user account. Contact the Air Monitoring Supervisor to request credentials. Alternatively, an AirVision administator can create a report task that will generate a data report and send it to a specified location (FTP site or e-mail).</p>
</div>
<div id="wair" class="section level3">
<h3><span class="header-section-number">2.1.9</span> Retrieving data from MPCA WAIR database</h3>
<p>The WAIR database provides a queryable local copy of select air quality data extracted from multiple data sources. This database is managed by Margaret McCourtney.Contact Margaret to request login credentials.</p>
<p>See <a href="http://rainier.pca.state.mn.us/documentation/DataDictionary/wair/index.html">WAIR Data Dictionary</a> for available data tables.</p>
<p>Use the following code to query WAIR using the R package <code>dplyr</code>.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="get-data.html#cb6-1"></a><span class="co">################################################################################################</span></span>
<span id="cb6-2"><a href="get-data.html#cb6-2"></a><span class="co">## This script loads the library and driver and connects to WAIR.  A dplyr query extracts </span></span>
<span id="cb6-3"><a href="get-data.html#cb6-3"></a><span class="co">## data from the database into a format specified by Cassie McMahon for calculating           </span></span>
<span id="cb6-4"><a href="get-data.html#cb6-4"></a><span class="co">## OZONE DESIGN VALUES                                                                        </span></span>
<span id="cb6-5"><a href="get-data.html#cb6-5"></a><span class="co">##                                                                                    </span></span>
<span id="cb6-6"><a href="get-data.html#cb6-6"></a><span class="co">## Note: WAIR does not contain values for SamplingFrequency and MonitorProtocolID </span></span>
<span id="cb6-7"><a href="get-data.html#cb6-7"></a><span class="co">##</span></span>
<span id="cb6-8"><a href="get-data.html#cb6-8"></a><span class="co">## Note:  dplyr does not have a command to disconnect from the database. Connection will</span></span>
<span id="cb6-9"><a href="get-data.html#cb6-9"></a><span class="co">## terminate upon quitting R.  Please do not keep (many) connections open for long periods of</span></span>
<span id="cb6-10"><a href="get-data.html#cb6-10"></a><span class="co">## time.</span></span>
<span id="cb6-11"><a href="get-data.html#cb6-11"></a><span class="co">################################################################################################</span></span>
<span id="cb6-12"><a href="get-data.html#cb6-12"></a></span>
<span id="cb6-13"><a href="get-data.html#cb6-13"></a><span class="co">## Load the package</span></span>
<span id="cb6-14"><a href="get-data.html#cb6-14"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb6-15"><a href="get-data.html#cb6-15"></a></span>
<span id="cb6-16"><a href="get-data.html#cb6-16"></a><span class="co">## Open a connection to the database WAIR, schema AQS ##</span></span>
<span id="cb6-17"><a href="get-data.html#cb6-17"></a>my_wair &lt;-<span class="st"> </span><span class="kw">src_postgres</span>(<span class="dt">dbname =</span> <span class="st">&#39;wair&#39;</span>, <span class="dt">host =</span> <span class="st">&quot;eiger&quot;</span>, <span class="dt">user =</span> <span class="st">&quot;username&quot;</span>, <span class="dt">password =</span> <span class="st">&quot;password&quot;</span>,</span>
<span id="cb6-18"><a href="get-data.html#cb6-18"></a><span class="dt">options =</span> <span class="st">&quot;-c search_path=aqs&quot;</span>)</span>
<span id="cb6-19"><a href="get-data.html#cb6-19"></a></span>
<span id="cb6-20"><a href="get-data.html#cb6-20"></a><span class="co">## Reference a table, or two if combining, in the database (e.g. aqs.monitor &amp; aqs.obs_value) ##</span></span>
<span id="cb6-21"><a href="get-data.html#cb6-21"></a><span class="co">## Select columns and filter by row ##</span></span>
<span id="cb6-22"><a href="get-data.html#cb6-22"></a></span>
<span id="cb6-23"><a href="get-data.html#cb6-23"></a><span class="co">#aqs.monitor table in WAIR ##</span></span>
<span id="cb6-24"><a href="get-data.html#cb6-24"></a>my_monitor &lt;-<span class="st"> </span><span class="kw">tbl</span>(my_wair, <span class="st">&quot;monitor&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-25"><a href="get-data.html#cb6-25"></a><span class="st">                </span><span class="kw">select</span>(id_mon<span class="op">:</span>poc_code) <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb6-26"><a href="get-data.html#cb6-26"></a><span class="st">                </span><span class="kw">filter</span>(stateid<span class="op">==</span><span class="dv">27</span> <span class="op">&amp;&amp;</span><span class="st"> </span>parm_code <span class="op">==</span><span class="st"> </span><span class="dv">44201</span>)</span>
<span id="cb6-27"><a href="get-data.html#cb6-27"></a></span>
<span id="cb6-28"><a href="get-data.html#cb6-28"></a><span class="co">#aqs.obs_value table in WAIR ##</span></span>
<span id="cb6-29"><a href="get-data.html#cb6-29"></a>my_obs &lt;-<span class="st"> </span><span class="kw">tbl</span>(my_wair, <span class="st">&quot;obs_value&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-30"><a href="get-data.html#cb6-30"></a><span class="st">            </span><span class="kw">filter</span>(parm_code <span class="op">==</span><span class="st"> </span><span class="dv">44201</span> <span class="op">&amp;&amp;</span><span class="st"> </span><span class="kw">between</span>(sampldate, <span class="st">&quot;2014-06-01&quot;</span>, <span class="st">&quot;2014-06-07&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb6-31"><a href="get-data.html#cb6-31"></a><span class="st">              </span><span class="kw">select</span>(id_mon, dur_code, unitid, method_code,</span>
<span id="cb6-32"><a href="get-data.html#cb6-32"></a>                     sampldate, startime, value, nulldata, qual_code)</span>
<span id="cb6-33"><a href="get-data.html#cb6-33"></a></span>
<span id="cb6-34"><a href="get-data.html#cb6-34"></a><span class="co">## Combine monitor data with observations </span></span>
<span id="cb6-35"><a href="get-data.html#cb6-35"></a>my_mn_o3 &lt;-<span class="st"> </span><span class="kw">inner_join</span>(my_monitor, my_obs, <span class="dt">type =</span> <span class="st">&quot;inner&quot;</span>, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;id_mon&quot;</span>)) </span>
<span id="cb6-36"><a href="get-data.html#cb6-36"></a></span>
<span id="cb6-37"><a href="get-data.html#cb6-37"></a></span>
<span id="cb6-38"><a href="get-data.html#cb6-38"></a><span class="co">## Collect data into a dataframe or table </span></span>
<span id="cb6-39"><a href="get-data.html#cb6-39"></a>my_mn_o3_df &lt;-<span class="st"> </span><span class="kw">collect</span>(my_mn_o3) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb6-40"><a href="get-data.html#cb6-40"></a><span class="st">                 </span><span class="kw">arrange</span>(stateid, cntyid, siteid, parm_code,  <span class="co"># Arrange combined data in specified order</span></span>
<span id="cb6-41"><a href="get-data.html#cb6-41"></a>                         poc_code, dur_code, unitid, method_code, </span>
<span id="cb6-42"><a href="get-data.html#cb6-42"></a>                         sampldate, startime, value, nulldata, qual_code)</span>
<span id="cb6-43"><a href="get-data.html#cb6-43"></a></span>
<span id="cb6-44"><a href="get-data.html#cb6-44"></a><span class="co">## </span></span>
<span id="cb6-45"><a href="get-data.html#cb6-45"></a><span class="kw">head</span>(my_mn_o3_df)</span></code></pre></div>
</div>
<p><br></p>
<p>Use the following code to query WAIR using the package <code>RPostgrSQL</code>.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="get-data.html#cb7-1"></a><span class="co">################################################################################################</span></span>
<span id="cb7-2"><a href="get-data.html#cb7-2"></a><span class="co">## This script loads the library and driver and connects to WAIR.  A PostgrSQL query extracts </span></span>
<span id="cb7-3"><a href="get-data.html#cb7-3"></a><span class="co">## data from the database into a format specified by Cassie McMahon for calculating           </span></span>
<span id="cb7-4"><a href="get-data.html#cb7-4"></a><span class="co">## OZONE DESIGN VALUES                                                                        </span></span>
<span id="cb7-5"><a href="get-data.html#cb7-5"></a><span class="co">##                                                                                    </span></span>
<span id="cb7-6"><a href="get-data.html#cb7-6"></a><span class="co">## Please disconnect from database and unload the driver before proceeding with analysis of </span></span>
<span id="cb7-7"><a href="get-data.html#cb7-7"></a><span class="co">## the data in your dataframe.</span></span>
<span id="cb7-8"><a href="get-data.html#cb7-8"></a><span class="co">##</span></span>
<span id="cb7-9"><a href="get-data.html#cb7-9"></a><span class="co">## Cassie&#39;s headings</span></span>
<span id="cb7-10"><a href="get-data.html#cb7-10"></a><span class="co">## &quot;State.Code&quot;, &quot;County.Code&quot;, &quot;Site.ID&quot;, &quot;Parameter&quot;, &quot;POC&quot;, &quot;Sample.Duration&quot;, &quot;Unit&quot;,</span></span>
<span id="cb7-11"><a href="get-data.html#cb7-11"></a><span class="co">## &quot;Method&quot;, &quot;Date&quot;, &quot;Start.Time&quot;, &quot;Sample.Value&quot;, &quot;NullDataCode&quot;, &quot;SamplingFrequency&quot;,</span></span>
<span id="cb7-12"><a href="get-data.html#cb7-12"></a><span class="co">## &quot;MonitorProtocolID&quot;, &quot;Qual1&quot;  </span></span>
<span id="cb7-13"><a href="get-data.html#cb7-13"></a><span class="co">##  Note: WAIR does not contain values for SamplingFrequency and MonitorProtocolID </span></span>
<span id="cb7-14"><a href="get-data.html#cb7-14"></a><span class="co">##</span></span>
<span id="cb7-15"><a href="get-data.html#cb7-15"></a><span class="co">################################################################################################</span></span>
<span id="cb7-16"><a href="get-data.html#cb7-16"></a></span>
<span id="cb7-17"><a href="get-data.html#cb7-17"></a><span class="co">## call the library</span></span>
<span id="cb7-18"><a href="get-data.html#cb7-18"></a><span class="kw">library</span>(RPostgreSQL)</span>
<span id="cb7-19"><a href="get-data.html#cb7-19"></a></span>
<span id="cb7-20"><a href="get-data.html#cb7-20"></a><span class="co">## load the PostgreSQL driver</span></span>
<span id="cb7-21"><a href="get-data.html#cb7-21"></a>drv &lt;-<span class="st"> </span><span class="kw">dbDriver</span>(<span class="st">&quot;PostgreSQL&quot;</span>)</span>
<span id="cb7-22"><a href="get-data.html#cb7-22"></a></span>
<span id="cb7-23"><a href="get-data.html#cb7-23"></a><span class="co">## Open a connection </span></span>
<span id="cb7-24"><a href="get-data.html#cb7-24"></a>con &lt;-<span class="st"> </span><span class="kw">dbConnect</span>(drv, <span class="dt">dbname =</span> <span class="st">&quot;wair&quot;</span>, <span class="dt">host =</span> <span class="st">&#39;eiger&#39;</span>, <span class="dt">user =</span> <span class="st">&#39;username&#39;</span>, <span class="dt">password =</span> <span class="st">&#39;password&#39;</span>)</span>
<span id="cb7-25"><a href="get-data.html#cb7-25"></a></span>
<span id="cb7-26"><a href="get-data.html#cb7-26"></a><span class="co">#***************************** all in 1 step ***************************************************</span></span>
<span id="cb7-27"><a href="get-data.html#cb7-27"></a></span>
<span id="cb7-28"><a href="get-data.html#cb7-28"></a></span>
<span id="cb7-29"><a href="get-data.html#cb7-29"></a>dframe &lt;-<span class="st"> </span><span class="kw">dbGetQuery</span>(con, </span>
<span id="cb7-30"><a href="get-data.html#cb7-30"></a>           <span class="dt">statement =</span> <span class="kw">paste</span>(</span>
<span id="cb7-31"><a href="get-data.html#cb7-31"></a>       <span class="co">################ insert SQL here ######################</span></span>
<span id="cb7-32"><a href="get-data.html#cb7-32"></a>        <span class="st">&quot;SELECT m.stateid AS state_code,\</span></span>
<span id="cb7-33"><a href="get-data.html#cb7-33"></a><span class="st">            m.cntyid AS county_code,\</span></span>
<span id="cb7-34"><a href="get-data.html#cb7-34"></a><span class="st">            m.siteid AS site_id,\</span></span>
<span id="cb7-35"><a href="get-data.html#cb7-35"></a><span class="st">            m.parm_code AS parameter,\</span></span>
<span id="cb7-36"><a href="get-data.html#cb7-36"></a><span class="st">            m.poc_code AS poc,\</span></span>
<span id="cb7-37"><a href="get-data.html#cb7-37"></a><span class="st">            o.dur_code AS sample_duration,\</span></span>
<span id="cb7-38"><a href="get-data.html#cb7-38"></a><span class="st">        o.unitid AS unit,\</span></span>
<span id="cb7-39"><a href="get-data.html#cb7-39"></a><span class="st">            o.method_code AS method,\</span></span>
<span id="cb7-40"><a href="get-data.html#cb7-40"></a><span class="st">            o.sampldate AS date,\</span></span>
<span id="cb7-41"><a href="get-data.html#cb7-41"></a><span class="st">            o.startime AS start_time,\</span></span>
<span id="cb7-42"><a href="get-data.html#cb7-42"></a><span class="st">            o.value AS sample_value,\</span></span>
<span id="cb7-43"><a href="get-data.html#cb7-43"></a><span class="st">            o.nulldata AS nulldatacode,\</span></span>
<span id="cb7-44"><a href="get-data.html#cb7-44"></a><span class="st">                NULL AS sampling_frequency,\</span></span>
<span id="cb7-45"><a href="get-data.html#cb7-45"></a><span class="st">        NULL AS monitor_protocol_id,\</span></span>
<span id="cb7-46"><a href="get-data.html#cb7-46"></a><span class="st">            o.qual_code\</span></span>
<span id="cb7-47"><a href="get-data.html#cb7-47"></a><span class="st">           FROM aqs.monitor m \</span></span>
<span id="cb7-48"><a href="get-data.html#cb7-48"></a><span class="st">           JOIN aqs.obs_value o \</span></span>
<span id="cb7-49"><a href="get-data.html#cb7-49"></a><span class="st">             ON m.id_mon = o.id_mon \ </span></span>
<span id="cb7-50"><a href="get-data.html#cb7-50"></a><span class="st">          WHERE m.stateid = &#39;27&#39; \</span></span>
<span id="cb7-51"><a href="get-data.html#cb7-51"></a><span class="st">            AND m.parm_code = &#39;44201&#39; \</span></span>
<span id="cb7-52"><a href="get-data.html#cb7-52"></a><span class="st">            AND o.sampldate BETWEEN &#39;2014-06-01&#39; AND &#39;2014-06-07&#39;\</span></span>
<span id="cb7-53"><a href="get-data.html#cb7-53"></a><span class="st">    &quot;</span></span>
<span id="cb7-54"><a href="get-data.html#cb7-54"></a>       <span class="co">########################################################</span></span>
<span id="cb7-55"><a href="get-data.html#cb7-55"></a>                     )); </span>
<span id="cb7-56"><a href="get-data.html#cb7-56"></a></span>
<span id="cb7-57"><a href="get-data.html#cb7-57"></a></span>
<span id="cb7-58"><a href="get-data.html#cb7-58"></a><span class="co">#***********************************************************************************************</span></span>
<span id="cb7-59"><a href="get-data.html#cb7-59"></a></span>
<span id="cb7-60"><a href="get-data.html#cb7-60"></a><span class="co">## Closes the connection</span></span>
<span id="cb7-61"><a href="get-data.html#cb7-61"></a><span class="kw">dbDisconnect</span>(con)</span>
<span id="cb7-62"><a href="get-data.html#cb7-62"></a></span>
<span id="cb7-63"><a href="get-data.html#cb7-63"></a><span class="co">## Frees all the resources on the driver</span></span>
<span id="cb7-64"><a href="get-data.html#cb7-64"></a><span class="kw">dbUnloadDriver</span>(drv)</span></code></pre></div>
</div>
</div>
<div id="toxics" class="section level3">
<h3><span class="header-section-number">2.1.10</span> Air toxics Data Explorer</h3>
<p>View and download summarized air toxics monitoring data results from the online <a href="https://www.pca.state.mn.us/air/air-toxics-data-explorer">Air Toxics Data Explorer</a>.</p>
</div>
<div id="criteria" class="section level3">
<h3><span class="header-section-number">2.1.11</span> Criteria Pollutant Data Explorer</h3>
<p>View and download MPCA calculated annual criteria pollutant design values from the online <a href="get-data.html#criteria">Criteria Pollutant Data Explorer</a> (<a href="https://www.pca.state.mn.us/air/criteria-pollutant-data-explorer" class="uri">https://www.pca.state.mn.us/air/criteria-pollutant-data-explorer</a>).</p>
</div>
<div id="AQI" class="section level3">
<h3><span class="header-section-number">2.1.12</span> Air Quality Index Summary Reports</h3>
<p>View and download annual AQI Summary Reports (based on final montiroing data) from the online <a href="https://www.pca.state.mn.us/air/annual-aqi-summary-reports">Air Quality Index Data Explorer</a>.</p>
</div>
<div id="PAHs" class="section level3">
<h3><span class="header-section-number">2.1.13</span> Air Monitoring for PAHs</h3>
<p>View and download PAH monitoring results from the community and facility based special projects online at <a href="https://www.pca.state.mn.us/air/pah-study-results">Air Monitoring for PAHs</a>.</p>
</div>
<div id="tableau" class="section level3">
<h3><span class="header-section-number">2.1.14</span> Internal Data Explorers</h3>
<p>Not all data analysis projects are ready or intended for external audiences. You can find a variety of analzyed monitoring results on the internal Tableau Server.</p>
<ul>
<li><a href="http://tableau.pca.state.mn.us/#/projects/113/workbooks">Air Data Analysis</a></li>
<li><a href="http://tableau.pca.state.mn.us/#/projects/72/workbooks">Air Modeling and Risk Evaluation</a></li>
</ul>
</div>
</div>
<div id="health-and-standards" class="section level2">
<h2><span class="header-section-number">2.2</span> Health and standards</h2>
<div id="IHBs" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Inhalation health benchmarks (IHBs)</h3>
<p>The inhalation health benchmarks used by MPCA are available on the web in these formats:</p>
<ul>
<li><strong>Web table:</strong> <a href="https://public.tableau.com/profile/mpca.data.services#!/vizhome/Airtoxicityvalues/Airtoxicityvalues" class="uri">https://public.tableau.com/profile/mpca.data.services#!/vizhome/Airtoxicityvalues/Airtoxicityvalues</a></li>
<li><strong>Excel:</strong> <a href="https://www.pca.state.mn.us/sites/default/files/aq9-22.xlsm" class="uri">https://www.pca.state.mn.us/sites/default/files/aq9-22.xlsm</a></li>
<li><strong>CSV:</strong> <a href="https://raw.githubusercontent.com/MPCA-air/health-values/master/Inhalation_Health_Benchmarks(IHBs).csv" class="uri">https://raw.githubusercontent.com/MPCA-air/health-values/master/Inhalation_Health_Benchmarks(IHBs).csv</a></li>
</ul>
<p><br></p>
<p>Use the following R code to fetch the most recent inhalation health benchmarks and references used by MPCA.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="get-data.html#cb8-1"></a><span class="kw">library</span>(readr)</span>
<span id="cb8-2"><a href="get-data.html#cb8-2"></a></span>
<span id="cb8-3"><a href="get-data.html#cb8-3"></a>url  &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/MPCA-air/health-values/master/Inhalation_Health_Benchmarks(IHBs).csv&quot;</span></span>
<span id="cb8-4"><a href="get-data.html#cb8-4"></a></span>
<span id="cb8-5"><a href="get-data.html#cb8-5"></a>ihbs &lt;-<span class="st"> </span><span class="kw">read_csv</span>(url) </span></code></pre></div>
</div>
<p><br></p>
</div>
<div id="NAAQS" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Air Quality Standards (NAAQS and MAAQS)</h3>
<p>Criteria air pollutants including: particulate (TSP, PM10, PM2.5), ozone, lead, sulfur dioxide, nitrogen dioxide, and carbon monoxide are regulated via ambient air quality standards. Ambient air quality standards are set at the national (NAAQS) and state (MAAQS) level.</p>
<p><strong>NAAQS</strong></p>
<p>The Clean Air Act, which was last amended in 1990, requires EPA to set National Ambient Air Quality Standards (40 CFR part 50) for pollutants considered harmful to public health and the environment. The Clean Air Act identifies two types of national ambient air quality standards. Primary standards provide public health protection, including protecting the health of “sensitive” populations such as asthmatics, children, and the elderly. Secondary standards provide public welfare protection, including protection against decreased visibility and damage to animals, crops, vegetation, and buildings.</p>
<ul>
<li>A summary of current NAAQS is available on EPA’s website:
<ul>
<li><a href="https://www.epa.gov/criteria-air-pollutants/naaqs-table" class="uri">https://www.epa.gov/criteria-air-pollutants/naaqs-table</a></li>
</ul></li>
<li>When calculating NAAQS design values, analysts must follow the procedures defined in the pollutant specific <a href="https://www.ecfr.gov/cgi-bin/text-idx?SID=c118ce8b63f65737a282c4281a59abf0&amp;mc=true&amp;node=pt40.2.50&amp;rgn=div5">appendices to 40 CFR 50</a>.</li>
<li>In August each year, EPA posts official design values here:
<ul>
<li><a href="https://www.epa.gov/air-trends/air-quality-design-values" class="uri">https://www.epa.gov/air-trends/air-quality-design-values</a></li>
</ul></li>
</ul>
<p><br></p>
<p><strong>MAAQS</strong></p>
<p>Minnesota Ambient Air Quality Standards (MAAQS) are established in <a href="https://www.revisor.mn.gov/rules?id=7009&amp;keyword_type=all&amp;keyword=7009&amp;keyword_sg=rule&amp;redirect=0">Minnesota Administrative Rules 7009</a>.</p>
<p>In most cases, the MAAQS are the same as the NAAQS. The MAAQS also include standards for two pollutants that are not covered by the NAAQS: TSP and hydrogen sulfide. The MAAQS were last updated in January 2017.</p>
<p>When calculating MAAQS design values:</p>
<ul>
<li>If MAAQS = NAAQS, use methods described in appendices to 40 CFR 50.</li>
<li>If MAAQS = revoked NAAQS, use methods described in archived appendices to 40 CFR 50.</li>
<li>For MAAQS without a NAAQS, such as H2S, use the “Form of the standard” language to guide your calculations.</li>
</ul>
</div>
</div>
<div id="air-modeling" class="section level2">
<h2><span class="header-section-number">2.3</span> Air modeling</h2>
<div id="nata" class="section level3">
<h3><span class="header-section-number">2.3.1</span> NATA modeling</h3>
<p>The National Air Toxics Assessment is a nationwide air modeling effort to provide air concentrations and risks for all U.S. census tracts. These results may be pulled from a map project or data tables at <a href="https://www.epa.gov/national-air-toxics-assessment">NATA</a>. After each inventory is completed the Minnesota statewide cumulative air pollution model is compared to these results.</p>
<p><br></p>
</div>
<div id="mnrisks" class="section level3">
<h3><span class="header-section-number">2.3.2</span> MNRISKS statewide risk modeling</h3>
<p>MNRISKS is the statewide cumulative air pollution model that is produced by MPCA every three years with the air toxics emissions inventory publication. The model itself produces point estimates for air concentrations and potential human health risks for hundreds of air pollutants across Minnesota. The model also incorporates a date and transport component that produces multi-pathway risk results. Census block group averaged results are available on MPCA’s <a href="https://www.pca.state.mn.us/air/air-modeling-and-human-health">Air modeling and human health</a> webpage.
<br></p>
</div>
<div id="downscale" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Downscaler modeling results for Ozone and PM2.5</h3>
<p>Downscaled data <em>(a blend of modeling and monitoring results)</em> are provided by the CDC in cooperation with the EPA for the pollutants ozone and PM-2.5. Daily predicitons are available for each Census tract throughout the country for the years 2001 to 2013.</p>
<ul>
<li>CDC information about this platform is available online at <a href="https://ephtracking.cdc.gov/showAirData.action">https://ephtracking.cdc.gov/showAirData.action</a>.</li>
<li>Data from this platform can be downloaded from the EPA at <a href="https://www.epa.gov/air-research/downscaler-model-predicting-daily-air-pollution">https://www.epa.gov/air-research/downscaler-model-predicting-daily-air-pollution</a>.</li>
<li>Downloaded data filtered to Minnesota results is available internally in the folder: <code>X:\Programs\Air_Quality_Programs\Air Monitoring Data and Risks\6 Air Data\EPA Downscaler Modeling</code>.</li>
</ul>
</div>
<div id="cmaq" class="section level3">
<h3><span class="header-section-number">2.3.4</span> CMAQ Ozone modeling</h3>
<p>The Community Multiscale Air Quality Modeling System (CMAQ) is defined by EPA as:</p>
<blockquote>
<p>an active open-source project of the EPA that consists of a suite of programs for conducting air quality model simulations. CMAQ combines current knowledge in atmospheric science and air quality modeling, and an open-source framework to deliver fast, technically sound estimates of ozone, particulates, air toxics and acids deposition.</p>
</blockquote>
<p>The information and data from this platform can be found at the following website <a href="https://www.epa.gov/cmaq">CMAQ</a>.</p>
</div>
</div>
<div id="context" class="section level2">
<h2><span class="header-section-number">2.4</span> Context</h2>
<div id="mn-ei" class="section level3">
<h3><span class="header-section-number">2.4.1</span> MN Emissions Inventory</h3>
<p>Every year all facilities (stationary point sources) report criteria pollutant emissions and every three years facilities report air toxics emissions. The EPA and the state of Minnesota emissions inventory team also calculate and report emissions for all other types of emissions sources such as mobile, non-road mobile, and area sources. These non-point emissions are reported every three years with the air toxics emissions. The Minnesota emission inventory is the foundation of MNRISKS. These emissions levels are reported in several data tools on the MPCA website. Their data and the visualization tools can be found on the following website <a href="https://www.pca.state.mn.us/air/emissions-data">https://www.pca.state.mn.us/air/emissions-data</a>.</p>
<p><br></p>
</div>
<div id="nei" class="section level3">
<h3><span class="header-section-number">2.4.2</span> EPA’s NEI</h3>
<p>The National Emissions Inventory (NEI) provides air toxics and criteria and air toxic pollutant emissions for the entire U.S. on the same schedule as described in the Minnesota Emissions Inventory section. This information can be found at the following website <a href="https://www.epa.gov/air-emissions-inventories/national-emissions-inventory-nei">https://www.epa.gov/air-emissions-inventories/national-emissions-inventory-nei</a>.</p>
</div>
<div id="fac-coords" class="section level3">
<h3><span class="header-section-number">2.4.3</span> Facility locations</h3>
<p>The most recent compilation of facility coordinates was performed for the 2017 emission inventory. This data is available in the <code>INV_SOURCES</code> table found in the <em>RAPIDS</em> schema of MPCA’s <em>DELTA</em> database.</p>
<p>Use the following code to load the current facility coordinates.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="get-data.html#cb9-1"></a><span class="co"># This script connects to the MPCA database DELTA. </span></span>
<span id="cb9-2"><a href="get-data.html#cb9-2"></a><span class="co"># A dplyr query collects source coordinates from the RAPIDS schema.</span></span>
<span id="cb9-3"><a href="get-data.html#cb9-3"></a>                                                                          </span>
<span id="cb9-4"><a href="get-data.html#cb9-4"></a><span class="co"># Load packages</span></span>
<span id="cb9-5"><a href="get-data.html#cb9-5"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb9-6"><a href="get-data.html#cb9-6"></a><span class="kw">library</span>(RODBC)</span>
<span id="cb9-7"><a href="get-data.html#cb9-7"></a><span class="kw">library</span>(readr)</span></code></pre></div>
<p>You can view available database connections in R using the function <code>odbcDataSources()</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="get-data.html#cb10-1"></a><span class="kw">odbcDataSources</span>()</span></code></pre></div>
<pre><code>##                                              dBASE Files 
##    &quot;Microsoft Access dBASE Driver (*.dbf, *.ndx, *.mdx)&quot; 
##                                              Excel Files 
## &quot;Microsoft Excel Driver (*.xls, *.xlsx, *.xlsm, *.xlsb)&quot; 
##                                       MS Access Database 
##               &quot;Microsoft Access Driver (*.mdb, *.accdb)&quot; 
##                                       LakesXMLDataSource 
##                                &quot;CR ODBC XML Driver 4.20&quot; 
##                                            PostgreSQL35W 
##                                &quot;PostgreSQL Unicode(x64)&quot; 
##                                                   deltaw 
##                           &quot;Oracle in OraClient11g_home2&quot; 
##                                 Amazon Redshift ODBC DSN 
##                                  &quot;Amazon Redshift (x64)&quot;</code></pre>
<p><br></p>
<p>To connect to <code>deltaw</code>, use the function <code>odbcConnect()</code>.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="get-data.html#cb12-1"></a><span class="co"># Load credentials</span></span>
<span id="cb12-2"><a href="get-data.html#cb12-2"></a>credentials &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;X:/Agency_Files/Outcomes/Risk_Eval_Air_Mod/_Air_Risk_Evaluation/R/R_Camp/Student Folder/credentials.csv&quot;</span>)</span>
<span id="cb12-3"><a href="get-data.html#cb12-3"></a></span>
<span id="cb12-4"><a href="get-data.html#cb12-4"></a>user      &lt;-<span class="st"> </span>credentials<span class="op">$</span>delta_user</span>
<span id="cb12-5"><a href="get-data.html#cb12-5"></a>password  &lt;-<span class="st"> </span>credentials<span class="op">$</span>delta_pwd</span>
<span id="cb12-6"><a href="get-data.html#cb12-6"></a></span>
<span id="cb12-7"><a href="get-data.html#cb12-7"></a><span class="co"># Alternatively, use your own</span></span>
<span id="cb12-8"><a href="get-data.html#cb12-8"></a><span class="co">#user      &lt;- &quot;ta*******&quot;</span></span>
<span id="cb12-9"><a href="get-data.html#cb12-9"></a><span class="co">#password  &lt;- &quot;da**_*******&quot;</span></span>
<span id="cb12-10"><a href="get-data.html#cb12-10"></a>  </span>
<span id="cb12-11"><a href="get-data.html#cb12-11"></a><span class="co"># Connect to DELTA</span></span>
<span id="cb12-12"><a href="get-data.html#cb12-12"></a>deltaw &lt;-<span class="st"> </span><span class="kw">odbcConnect</span>(<span class="st">&quot;deltaw&quot;</span>, </span>
<span id="cb12-13"><a href="get-data.html#cb12-13"></a>                      <span class="dt">uid =</span> user, </span>
<span id="cb12-14"><a href="get-data.html#cb12-14"></a>                      <span class="dt">pwd =</span> password,</span>
<span id="cb12-15"><a href="get-data.html#cb12-15"></a>                      <span class="dt">believeNRows =</span> <span class="ot">FALSE</span>)</span>
<span id="cb12-16"><a href="get-data.html#cb12-16"></a></span>
<span id="cb12-17"><a href="get-data.html#cb12-17"></a></span>
<span id="cb12-18"><a href="get-data.html#cb12-18"></a><span class="co"># Show all tables in RAPIDS schema</span></span>
<span id="cb12-19"><a href="get-data.html#cb12-19"></a>rapids_tbls &lt;-<span class="st"> </span><span class="kw">sqlTables</span>(deltaw, <span class="dt">tableType =</span> <span class="st">&quot;TABLE&quot;</span>, <span class="dt">schema =</span> <span class="st">&quot;RAPIDS&quot;</span>)  </span>
<span id="cb12-20"><a href="get-data.html#cb12-20"></a></span>
<span id="cb12-21"><a href="get-data.html#cb12-21"></a><span class="kw">head</span>(rapids_tbls)</span></code></pre></div>
<pre><code>##   TABLE_CAT TABLE_SCHEM         TABLE_NAME TABLE_TYPE REMARKS
## 1      &lt;NA&gt;      RAPIDS     GEO_ACTIVITIES      TABLE    &lt;NA&gt;
## 2      &lt;NA&gt;      RAPIDS       GEO_COUNTIES      TABLE    &lt;NA&gt;
## 3      &lt;NA&gt;      RAPIDS        GEO_NATIONS      TABLE    &lt;NA&gt;
## 4      &lt;NA&gt;      RAPIDS        GEO_REGIONS      TABLE    &lt;NA&gt;
## 5      &lt;NA&gt;      RAPIDS GEO_REGION_MEMBERS      TABLE    &lt;NA&gt;
## 6      &lt;NA&gt;      RAPIDS         GEO_STATES      TABLE    &lt;NA&gt;</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="get-data.html#cb14-1"></a><span class="co"># Get inventory year codes</span></span>
<span id="cb14-2"><a href="get-data.html#cb14-2"></a>inv_codes  &lt;-<span class="st"> </span><span class="kw">sqlQuery</span>(deltaw, <span class="st">&quot;SELECT * FROM RAPIDS.INV_INVENTORIES&quot;</span>, <span class="dt">max =</span> <span class="dv">100</span>, <span class="dt">stringsAsFactors =</span> F)</span>
<span id="cb14-3"><a href="get-data.html#cb14-3"></a></span>
<span id="cb14-4"><a href="get-data.html#cb14-4"></a><span class="co"># Get code for 2017</span></span>
<span id="cb14-5"><a href="get-data.html#cb14-5"></a>inv_id  &lt;-<span class="st"> </span><span class="kw">filter</span>(inv_codes, INVENTORY_YEAR <span class="op">==</span><span class="st"> </span><span class="dv">2017</span>)<span class="op">$</span>RID</span>
<span id="cb14-6"><a href="get-data.html#cb14-6"></a></span>
<span id="cb14-7"><a href="get-data.html#cb14-7"></a><span class="co"># Get sources for inventory year</span></span>
<span id="cb14-8"><a href="get-data.html#cb14-8"></a>sources   &lt;-<span class="st"> </span><span class="kw">sqlQuery</span>(deltaw, <span class="kw">paste0</span>(<span class="st">&quot;SELECT * FROM RAPIDS.INV_SOURCES WHERE INVENTORY_RID = &quot;</span>, inv_id),</span>
<span id="cb14-9"><a href="get-data.html#cb14-9"></a>                        <span class="dt">max              =</span> <span class="dv">10000</span>, </span>
<span id="cb14-10"><a href="get-data.html#cb14-10"></a>                        <span class="dt">stringsAsFactors =</span> F, </span>
<span id="cb14-11"><a href="get-data.html#cb14-11"></a>                        <span class="dt">as.is            =</span> T)</span>
<span id="cb14-12"><a href="get-data.html#cb14-12"></a></span>
<span id="cb14-13"><a href="get-data.html#cb14-13"></a></span>
<span id="cb14-14"><a href="get-data.html#cb14-14"></a><span class="co"># Get source coordinates</span></span>
<span id="cb14-15"><a href="get-data.html#cb14-15"></a>src_coords   &lt;-<span class="st"> </span><span class="kw">sqlQuery</span>(deltaw, <span class="st">&quot;SELECT * FROM RAPIDS.INV_COORDINATES&quot;</span>,</span>
<span id="cb14-16"><a href="get-data.html#cb14-16"></a>                        <span class="dt">max              =</span> <span class="dv">100000</span>, </span>
<span id="cb14-17"><a href="get-data.html#cb14-17"></a>                        <span class="dt">stringsAsFactors =</span> F, </span>
<span id="cb14-18"><a href="get-data.html#cb14-18"></a>                        <span class="dt">as.is            =</span> T)</span>
<span id="cb14-19"><a href="get-data.html#cb14-19"></a></span>
<span id="cb14-20"><a href="get-data.html#cb14-20"></a></span>
<span id="cb14-21"><a href="get-data.html#cb14-21"></a><span class="co"># Join coordinates to sources</span></span>
<span id="cb14-22"><a href="get-data.html#cb14-22"></a>sources &lt;-<span class="st"> </span><span class="kw">left_join</span>(sources, src_coords, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;RID&quot;</span> =<span class="st"> &quot;ENTITY_RID&quot;</span>))</span>
<span id="cb14-23"><a href="get-data.html#cb14-23"></a></span>
<span id="cb14-24"><a href="get-data.html#cb14-24"></a></span>
<span id="cb14-25"><a href="get-data.html#cb14-25"></a><span class="co"># View data </span></span>
<span id="cb14-26"><a href="get-data.html#cb14-26"></a>sources <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(SOURCE_ID, SOURCE_TYPE, SOURCE_NAME, LONGITUDE, LATITUDE) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 9,412
## Columns: 5
## $ SOURCE_ID   &lt;chr&gt; &quot;2799000257&quot;, &quot;2703700102&quot;, &quot;2706900014&quot;, &quot;2708900012&quot;,...
## $ SOURCE_TYPE &lt;chr&gt; &quot;POINT&quot;, &quot;POINT&quot;, &quot;POINT&quot;, &quot;POINT&quot;, &quot;POINT&quot;, &quot;POINT&quot;, &quot;...
## $ SOURCE_NAME &lt;chr&gt; &quot;Gravel Products Inc&quot;, &quot;Great Lakes Coca-Cola Distribut...
## $ LONGITUDE   &lt;chr&gt; NA, &quot;-93.153&quot;, &quot;-97.0603&quot;, &quot;-96.2385&quot;, &quot;-95.2051&quot;, &quot;-93...
## $ LATITUDE    &lt;chr&gt; NA, &quot;44.8567&quot;, &quot;48.9907&quot;, &quot;48.2558&quot;, &quot;47.5853&quot;, &quot;45.111...</code></pre>
</div>
</div>
<div id="wx-obs" class="section level3">
<h3><span class="header-section-number">2.4.4</span> Weather observations</h3>
<p>Historical meteorological observations are available from multiple sources.</p>
<p><strong>Raw data</strong></p>
<ol style="list-style-type: decimal">
<li>An internal Tableau workbook provides raw results for Minnesota meteorological stations: <a href="tableau.pca.state.mn.us/#/workbooks/5714">tableau.pca.state.mn.us/#/workbooks/5714</a>.</li>
</ol>
<p><strong>Quality assured data</strong></p>
<ol style="list-style-type: decimal">
<li>The AQI forecast uses a web API provided by <a href="https://darksky.net/dev"><em>DarkSky</em></a> for current forecast information and quality assured historical observations.</li>
</ol>
</div>
<div id="hysplit" class="section level3">
<h3><span class="header-section-number">2.4.5</span> HYSPLIT wind trajectories</h3>
<p>Wind trajectories are useful for determining the primary sources contributing to elevated air monitoring results. Trajectory results for the air monitoring netowork are available in WAIR for the years 2007 to 2017. The R package <a href="https://github.com/rich-iannone/SplitR">SplitR</a> was used to automate HYSPLIT modeling for each air monitoring location.</p>
<p>Use the following code to query WAIR for HYSPLIT results.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="get-data.html#cb16-1"></a><span class="co"># This script connects to the MPCA database WAIR.  </span></span>
<span id="cb16-2"><a href="get-data.html#cb16-2"></a><span class="co"># A dplyr query collects HYSPLIT modeling results for Anoka Airport.</span></span>
<span id="cb16-3"><a href="get-data.html#cb16-3"></a>                                                                                </span>
<span id="cb16-4"><a href="get-data.html#cb16-4"></a></span>
<span id="cb16-5"><a href="get-data.html#cb16-5"></a><span class="co"># Load packages</span></span>
<span id="cb16-6"><a href="get-data.html#cb16-6"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb16-7"><a href="get-data.html#cb16-7"></a></span>
<span id="cb16-8"><a href="get-data.html#cb16-8"></a><span class="co"># Open a connection to the database WAIR, schema hys ##</span></span>
<span id="cb16-9"><a href="get-data.html#cb16-9"></a>my_wair &lt;-<span class="st"> </span><span class="kw">src_postgres</span>(<span class="dt">dbname =</span> <span class="st">&#39;wair&#39;</span>, <span class="dt">host =</span> <span class="st">&quot;eiger&quot;</span>, <span class="dt">user =</span> <span class="st">&quot;username&quot;</span>, <span class="dt">password =</span> <span class="st">&quot;password&quot;</span>)</span>
<span id="cb16-10"><a href="get-data.html#cb16-10"></a></span>
<span id="cb16-11"><a href="get-data.html#cb16-11"></a><span class="co"># Show tables</span></span>
<span id="cb16-12"><a href="get-data.html#cb16-12"></a><span class="kw">src_tbls</span>(my_wair) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sort</span>()</span>
<span id="cb16-13"><a href="get-data.html#cb16-13"></a></span>
<span id="cb16-14"><a href="get-data.html#cb16-14"></a></span>
<span id="cb16-15"><a href="get-data.html#cb16-15"></a><span class="co"># Connect to hys.backtrajectory table ##</span></span>
<span id="cb16-16"><a href="get-data.html#cb16-16"></a>hys &lt;-<span class="st"> </span><span class="kw">tbl</span>(my_wair, <span class="st">&quot;hys.backtrajectory&quot;</span>)</span>
<span id="cb16-17"><a href="get-data.html#cb16-17"></a></span>
<span id="cb16-18"><a href="get-data.html#cb16-18"></a>hys &lt;-<span class="st"> </span><span class="kw">tbl</span>(my_wair, <span class="kw">sql</span>(<span class="st">&#39;hys.backtrajectory&#39;</span>))</span>
<span id="cb16-19"><a href="get-data.html#cb16-19"></a></span>
<span id="cb16-20"><a href="get-data.html#cb16-20"></a><span class="co"># Collect data for Anoka Airport after year 2010 ##</span></span>
<span id="cb16-21"><a href="get-data.html#cb16-21"></a>hys_mpls  &lt;-<span class="st"> </span>hys <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-22"><a href="get-data.html#cb16-22"></a><span class="st">               </span><span class="kw">select</span>(<span class="op">-</span>the_geom) <span class="op">%&gt;%</span></span>
<span id="cb16-23"><a href="get-data.html#cb16-23"></a><span class="st">               </span><span class="kw">filter</span>(site_catid <span class="op">==</span><span class="st"> &quot;27-003-1002&quot;</span>, yr <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb16-24"><a href="get-data.html#cb16-24"></a><span class="st">               </span><span class="kw">collect</span>(<span class="dt">n =</span> <span class="dv">2000</span>)</span>
<span id="cb16-25"><a href="get-data.html#cb16-25"></a></span>
<span id="cb16-26"><a href="get-data.html#cb16-26"></a><span class="co"># View data </span></span>
<span id="cb16-27"><a href="get-data.html#cb16-27"></a><span class="kw">head</span>(hys_mpls)</span></code></pre></div>
</div>
</div>
<div id="landuse" class="section level3">
<h3><span class="header-section-number">2.4.6</span> Land use maps</h3>
<p>Land use shapefiles are maintained by MPCA GIS technical staff and stored on the agency R-drive at <code>R:\landuse_landcover</code>.</p>
</div>
<div id="census" class="section level3">
<h3><span class="header-section-number">2.4.7</span> United States Census boundaries</h3>
<p>Census boundaries can be loaded into R for mapping air data to Census tracts and block groups.</p>
<p>Use the following code to download and map MN boundaries.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="get-data.html#cb17-1"></a><span class="co"># This script downloads shapefiles of Minnesota </span></span>
<span id="cb17-2"><a href="get-data.html#cb17-2"></a><span class="co">## Counties</span></span>
<span id="cb17-3"><a href="get-data.html#cb17-3"></a><span class="co">## Census tracts</span></span>
<span id="cb17-4"><a href="get-data.html#cb17-4"></a><span class="co">## Census Block groups  </span></span>
<span id="cb17-5"><a href="get-data.html#cb17-5"></a></span>
<span id="cb17-6"><a href="get-data.html#cb17-6"></a><span class="co"># Load packages</span></span>
<span id="cb17-7"><a href="get-data.html#cb17-7"></a><span class="kw">library</span>(tigris)</span>
<span id="cb17-8"><a href="get-data.html#cb17-8"></a></span>
<span id="cb17-9"><a href="get-data.html#cb17-9"></a><span class="co"># Load boundaries</span></span>
<span id="cb17-10"><a href="get-data.html#cb17-10"></a>county_bounds &lt;-<span class="st"> </span><span class="kw">counties</span>(<span class="dt">state =</span> <span class="st">&quot;MN&quot;</span>, <span class="dt">cb =</span> T)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="get-data.html#cb18-1"></a><span class="co"># Plot </span></span>
<span id="cb18-2"><a href="get-data.html#cb18-2"></a><span class="kw">plot</span>(county_bounds, <span class="dt">col =</span> <span class="st">&quot;steelblue&quot;</span>)</span></code></pre></div>
<p><img src="air-methods_files/figure-html/county-plot-1.png" width="672" /></p>
<p><strong>Tracts &amp; Block groups</strong></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="get-data.html#cb19-1"></a>tract_bounds  &lt;-<span class="st"> </span><span class="kw">tracts</span>(<span class="dt">state =</span> <span class="st">&quot;MN&quot;</span>, <span class="dt">cb =</span> T)</span>
<span id="cb19-2"><a href="get-data.html#cb19-2"></a></span>
<span id="cb19-3"><a href="get-data.html#cb19-3"></a>bg_bounds     &lt;-<span class="st"> </span><span class="kw">block_groups</span>(<span class="dt">state =</span> <span class="st">&quot;MN&quot;</span>, <span class="dt">cb =</span> T)</span></code></pre></div>
</div>
</div>
<div id="acs" class="section level3">
<h3><span class="header-section-number">2.4.8</span> American Community Survey (ACS)</h3>
<p>The ACS provides updated demographic statistics used for population estimates and Environmental Justice indicators.</p>
<p>Use the following code to download Minnesota ACS results.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="get-data.html#cb20-1"></a><span class="co"># This script downloads American Community Survey (ACS) results for MN</span></span>
<span id="cb20-2"><a href="get-data.html#cb20-2"></a></span>
<span id="cb20-3"><a href="get-data.html#cb20-3"></a><span class="co"># Load packages</span></span>
<span id="cb20-4"><a href="get-data.html#cb20-4"></a><span class="kw">library</span>(tidycensus)</span>
<span id="cb20-5"><a href="get-data.html#cb20-5"></a></span>
<span id="cb20-6"><a href="get-data.html#cb20-6"></a><span class="co"># ACS data requires a Census key</span></span>
<span id="cb20-7"><a href="get-data.html#cb20-7"></a><span class="co"># Visit: http://api.census.gov/data/key_signup.html</span></span>
<span id="cb20-8"><a href="get-data.html#cb20-8"></a><span class="kw">census_api_key</span>(<span class="st">&quot;Your_API_key&quot;</span>)</span>
<span id="cb20-9"><a href="get-data.html#cb20-9"></a></span>
<span id="cb20-10"><a href="get-data.html#cb20-10"></a><span class="co"># View all ACS variables</span></span>
<span id="cb20-11"><a href="get-data.html#cb20-11"></a>acs_variables &lt;-<span class="st"> </span><span class="kw">load_variables</span>(<span class="dv">2015</span>, <span class="st">&quot;acs5&quot;</span>, <span class="dt">cache =</span> <span class="ot">TRUE</span>)</span>
<span id="cb20-12"><a href="get-data.html#cb20-12"></a></span>
<span id="cb20-13"><a href="get-data.html#cb20-13"></a></span>
<span id="cb20-14"><a href="get-data.html#cb20-14"></a><span class="co"># Download 5-yr population estimates for 2015</span></span>
<span id="cb20-15"><a href="get-data.html#cb20-15"></a>pops_<span class="dv">2015</span> &lt;-<span class="st"> </span><span class="kw">get_acs</span>(<span class="dt">geography =</span> <span class="st">&quot;tract&quot;</span>, </span>
<span id="cb20-16"><a href="get-data.html#cb20-16"></a>                     <span class="dt">state     =</span> <span class="st">&quot;MN&quot;</span>, </span>
<span id="cb20-17"><a href="get-data.html#cb20-17"></a>                     <span class="dt">variables =</span> <span class="st">&quot;B01003_001&quot;</span>, </span>
<span id="cb20-18"><a href="get-data.html#cb20-18"></a>                     <span class="dt">survey    =</span> <span class="st">&quot;acs5&quot;</span>, </span>
<span id="cb20-19"><a href="get-data.html#cb20-19"></a>                     <span class="dt">year      =</span> <span class="dv">2015</span>)</span>
<span id="cb20-20"><a href="get-data.html#cb20-20"></a></span>
<span id="cb20-21"><a href="get-data.html#cb20-21"></a></span>
<span id="cb20-22"><a href="get-data.html#cb20-22"></a><span class="co"># Download decennial population estimates for 2010</span></span>
<span id="cb20-23"><a href="get-data.html#cb20-23"></a>pops_<span class="dv">2010</span> &lt;-<span class="st"> </span><span class="kw">get_decennial</span>(<span class="dt">geography =</span> <span class="st">&quot;tract&quot;</span>, </span>
<span id="cb20-24"><a href="get-data.html#cb20-24"></a>                           <span class="dt">state     =</span> <span class="st">&quot;MN&quot;</span>, </span>
<span id="cb20-25"><a href="get-data.html#cb20-25"></a>                           <span class="dt">variables =</span> <span class="st">&quot;P0080001&quot;</span>, </span>
<span id="cb20-26"><a href="get-data.html#cb20-26"></a>                           <span class="dt">year      =</span> <span class="dv">2010</span>)</span>
<span id="cb20-27"><a href="get-data.html#cb20-27"></a></span>
<span id="cb20-28"><a href="get-data.html#cb20-28"></a></span>
<span id="cb20-29"><a href="get-data.html#cb20-29"></a><span class="co"># Download household median income for 2015</span></span>
<span id="cb20-30"><a href="get-data.html#cb20-30"></a>med_inc_<span class="dv">2015</span> &lt;-<span class="st"> </span><span class="kw">get_acs</span>(<span class="dt">geography =</span> <span class="st">&quot;tract&quot;</span>, </span>
<span id="cb20-31"><a href="get-data.html#cb20-31"></a>                        <span class="dt">state     =</span> <span class="st">&quot;MN&quot;</span>, </span>
<span id="cb20-32"><a href="get-data.html#cb20-32"></a>                        <span class="dt">variables =</span> <span class="st">&quot;B19013_001&quot;</span>, </span>
<span id="cb20-33"><a href="get-data.html#cb20-33"></a>                        <span class="dt">survey    =</span> <span class="st">&quot;acs5&quot;</span>, </span>
<span id="cb20-34"><a href="get-data.html#cb20-34"></a>                        <span class="dt">year      =</span> <span class="dv">2015</span>)</span></code></pre></div>
</div>
<p><br> <a href="get-data.html#get-data">Back to top</a></p>

</div>
</div>
</div>
<script>
  $(".btn_code").click(function() {
    $(this.parentNode).toggleClass("open");
  });
</script>
            </section>

          </div>
        </div>
      </div>
<a href="best-practices.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="quality-assurance-methods.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/MPCA-air/air-methods/edit/master/01-get_data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["air-methods.pdf", "air-methods.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
