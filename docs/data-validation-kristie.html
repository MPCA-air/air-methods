<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title></title>
  <meta name="description" content="">
  <meta name="generator" content="bookdown 0.4.3 and GitBook 2.6.7">

  <meta property="og:title" content="" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/MPCA-air/air-methods" />
  <meta property="og:image" content="https://github.com/MPCA-air/air-methodsimages/cover.jpeg" />
  
  <meta name="github-repo" content="MPCA-air/air-methods" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="" />
  
  
  <meta name="twitter:image" content="https://github.com/MPCA-air/air-methodsimages/cover.jpeg" />




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="data-cleaning-dorian-cassie.html">
<link rel="next" href="collocated-monitors-derek.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-0.9/htmlwidgets.js"></script>
<script src="libs/datatables-binding-0.2/datatables.js"></script>
<link href="libs/dt-core-1.10.12/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.12/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.12/js/jquery.dataTables.min.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://mpca-air.github.io/air-methods">Methods for air data analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="data-cleaning-dorian-cassie.html"><a href="data-cleaning-dorian-cassie.html"><i class="fa fa-check"></i><b>1</b> Data cleaning (Dorian &amp; Cassie)</a></li>
<li class="chapter" data-level="2" data-path="data-validation-kristie.html"><a href="data-validation-kristie.html"><i class="fa fa-check"></i><b>2</b> Data validation (Kristie)</a><ul>
<li class="chapter" data-level="2.1" data-path="data-validation-kristie.html"><a href="data-validation-kristie.html#leaks"><i class="fa fa-check"></i><b>2.1</b> Identifying Instrument drift or leaks in a system.</a></li>
<li class="chapter" data-level="2.2" data-path="data-validation-kristie.html"><a href="data-validation-kristie.html#outs"><i class="fa fa-check"></i><b>2.2</b> Identify exceptional and extreme values aka outliers.</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="collocated-monitors-derek.html"><a href="collocated-monitors-derek.html"><i class="fa fa-check"></i><b>3</b> Collocated monitors (Derek)</a></li>
<li class="chapter" data-level="4" data-path="detection-limits-kristie-cassie.html"><a href="detection-limits-kristie-cassie.html"><i class="fa fa-check"></i><b>4</b> Detection limits (Kristie &amp; Cassie)</a></li>
<li class="chapter" data-level="5" data-path="completeness-checks-dorian-cassie.html"><a href="completeness-checks-dorian-cassie.html"><i class="fa fa-check"></i><b>5</b> Completeness checks (Dorian &amp; Cassie)</a></li>
<li class="chapter" data-level="6" data-path="summary-statistics.html"><a href="summary-statistics.html"><i class="fa fa-check"></i><b>6</b> Summary statistics</a></li>
<li class="chapter" data-level="7" data-path="site-comparisons-derek-cassie.html"><a href="site-comparisons-derek-cassie.html"><i class="fa fa-check"></i><b>7</b> Site comparisons (Derek &amp; Cassie)</a></li>
<li class="chapter" data-level="8" data-path="charts.html"><a href="charts.html"><i class="fa fa-check"></i><b>8</b> Charts</a></li>
<li class="chapter" data-level="9" data-path="generates-pollution-roses-for-all-air-toxics-for-a-site-and-saves-them-in-a-folder-defined-by-output-path.html"><a href="generates-pollution-roses-for-all-air-toxics-for-a-site-and-saves-them-in-a-folder-defined-by-output-path.html"><i class="fa fa-check"></i><b>9</b> Generates pollution roses for all air toxics for a site and saves them in a folder defined by output_path</a></li>
<li class="chapter" data-level="10" data-path="time-series.html"><a href="time-series.html"><i class="fa fa-check"></i><b>10</b> Time series</a></li>
<li class="chapter" data-level="11" data-path="maps-kristie.html"><a href="maps-kristie.html"><i class="fa fa-check"></i><b>11</b> Maps (Kristie)</a></li>
<li class="chapter" data-level="12" data-path="additional-resources-kristie.html"><a href="additional-resources-kristie.html"><i class="fa fa-check"></i><b>12</b> Additional resources (Kristie)</a></li>
<li class="chapter" data-level="" data-path="edit-this-book.html"><a href="edit-this-book.html"><i class="fa fa-check"></i>Edit this book</a></li>
<li class="divider"></li>
<li><a href="https://github.com/MPCA-air" target="blank">Created by MPCA-air</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-validation-kristie" class="section level1">
<h1><span class="header-section-number"></span> Data validation (Kristie)</h1>
<p><img src="https://imgs.xkcd.com/comics/error_code.png" width="65%" /></p>
<p>Environmental monitoring data can be subject to error. Three important errors to look for are:</p>
<ul>
<li><a href="data-validation-kristie.html#leaks">2.1</a> <strong>Leaks and sample contamination</strong></li>
<li><a href="data-validation-kristie.html#sticky"><strong>??</strong></a> <strong>Instrument errors such as drift or repeated results (sticking values)</strong></li>
<li><a href="data-validation-kristie.html#outs">2.2</a> <strong>Outliers or extreme values</strong></li>
</ul>
<p><br> <strong>Validation steps</strong></p>
<ol style="list-style-type: decimal">
<li>Identify exceptional values.</li>
<li>Identify sequential identical values (sticking).</li>
<li>Identify potential instrument drift.</li>
<li>Report findings to laboratory for further investigation.</li>
</ol>
<p><br> <strong>Why not average the exceptional data over the year and assume the problem will go away?</strong></p>
<p>Further investigation by laboratory staff is required if the laboratory equipment or system is in error. If the laboratory is not in error, these concentrations require additional investigation by data analysts and potentially by air pollution source specialists. For these reasons, these data validation steps are critical. A decreasing signal or repeated sequential measurement means that the data are not interpretable. An exceptionally high value could mean laboratory contamination or potentially could contribute to human health impacts if the high value is accurate.</p>
<p><br> <strong>Notes</strong></p>
<ul>
<li>Possible Contamination Issues-by site and pollutant</li>
<li>3*IQR: I used as a simple outlier identifier in EU guidelines. This includes a lot of data for UFPs.</li>
</ul>
<p>Cassie has tried:</p>
<ul>
<li>3*75th percentile(UFP) - quantiles from previous year of data</li>
<li>2.5 *75th percentile of the data (put in Derek’s explanation) this is for integrated air toxics data</li>
<li>3*SD (Poor performance)</li>
<li>Site mean more than twice the second highest site mean(NO)</li>
<li>Sites with maxima over 2X the next highest value(NO)</li>
<li>Only one detection at a site (special case)
<ul>
<li>And Detection was greater than 3X the MDL</li>
<li>And Detection was within 10% of state maximum that year</li>
</ul></li>
</ul>
<p>Possible Sample loss issues (leaks) by site and pollutant</p>
<ul>
<li>Check for several (2,3) below MDL values when values have been above MDLs previously (need discussion). MDL would be from the previous year.<br />
</li>
<li>I tried taking the mean of 5 sequential values, and then the next 5 sequential values. If the second set of means was 1.5 times less than the first mean I flagged the values.<br />
</li>
<li><strong>Recommendation:</strong> Use the <code>[75th percentile * 3]</code> for all pollutants.</li>
</ul>
<p><br> <strong>Sample <code>R</code> script</strong></p>
<p>Click the button below to view a step by step example of the methods above.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<p><strong>Goals:</strong></p>
<ol style="list-style-type: decimal">
<li>Find extreme values that may be in error or from contamination.</li>
<li>Find 3 repeating values that are exactly the same.</li>
<li>Find low values where this is not common.</li>
<li>Do this in a routine way (identify frequency of validation checks).</li>
</ol>
<p>The following sections on data validation will use the example monitoring data loaded below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(stringr)
<span class="kw">library</span>(RcppRoll)
<span class="kw">library</span>(lubridate)
<span class="kw">library</span>(car)

##need to confirm that this data set has sequential repeats, some high values and at least 10 dates with numbers
data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/MPCA-air/air-methods/master/airtoxics_data_2009_2013.csv&#39;</span>)

<span class="kw">colnames</span>(data) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;aqs_id&quot;</span>, <span class="st">&quot;poc&quot;</span>, <span class="st">&quot;param_code&quot;</span>, <span class="st">&quot;date&quot;</span>, <span class="st">&quot;conc&quot;</span>, <span class="st">&quot;null_code&quot;</span>, <span class="st">&quot;md_limit&quot;</span>, <span class="st">&quot;pollutant&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;cas&quot;</span>)

dt_options &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">scrollX =</span> T, <span class="dt">autoWidth =</span> T, <span class="dt">searching =</span> F, <span class="dt">ordering=</span>F, <span class="dt">lengthChange =</span> F, <span class="dt">paginate=</span>F, <span class="dt">info=</span>F)</code></pre></div>
<p><br> <em>Table: Sample monitoring data</em><br />
<div id="htmlwidget-fd55824eee4861111b8a" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-fd55824eee4861111b8a">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10"],[270535501,270535501,270535501,270535501,270535501,270535501,270535501,270535501,270535501,270535501],[1,1,1,1,1,1,1,1,1,1],[12102,12102,12102,12102,12102,12102,12102,12102,12102,12102],["2009-07-30","2009-08-05","2009-08-11","2009-09-16","2009-09-22","2009-08-17","2009-08-23","2009-08-29","2009-09-04","2009-09-10"],[0.00127,0.00223,0.0037,0.0018,0.0027,0.00173,0.00257,0.00101,0.00604,0.0029],[null,null,null,null,null,null,null,null,null,null],[0.0028236,0.0028236,0.0028236,0.0028236,0.0028236,0.0028236,0.0028236,0.0028236,0.0028236,0.0028236],["Antimony","Antimony","Antimony","Antimony","Antimony","Antimony","Antimony","Antimony","Antimony","Antimony"],[2009,2009,2009,2009,2009,2009,2009,2009,2009,2009],["7440-36-0","7440-36-0","7440-36-0","7440-36-0","7440-36-0","7440-36-0","7440-36-0","7440-36-0","7440-36-0","7440-36-0"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>aqs_id<\/th>\n      <th>poc<\/th>\n      <th>param_code<\/th>\n      <th>date<\/th>\n      <th>conc<\/th>\n      <th>null_code<\/th>\n      <th>md_limit<\/th>\n      <th>pollutant<\/th>\n      <th>year<\/th>\n      <th>cas<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"autoWidth":true,"searching":false,"ordering":false,"lengthChange":false,"paginate":false,"info":false,"columnDefs":[{"className":"dt-right","targets":[1,2,3,5,7,9]},{"orderable":false,"targets":0}],"order":[],"orderClasses":false}},"evals":[],"jsHooks":[]}</script></p>
</div>
<div id="leaks" class="section level2">
<h2><span class="header-section-number">2.1</span> Identifying Instrument drift or leaks in a system.</h2>
<p>The test looks for a difference in variance of carbon tetrachloride between a calendar quarter for two consecutive years. Carbon tetrachloride was chosen because it is a banned substance and no longer in use, it has very few below detection limit values, and no direct sources. It has seasonally variable concentrations, so calendar quarters were compared to eliminate the detection of seasonal differences. The statistical test used was a Levenes Test for homogeneity of variance.</p>
<p><br> <strong>Sample <code>R</code> script</strong></p>
<p>Click the button below to view a step by step example of the method above.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<p><br></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data$conc &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(data$conc)
data$aqs_id &lt;-<span class="st"> </span><span class="kw">as.character</span>(data$aqs_id)
sites &lt;-<span class="st"> </span><span class="kw">unique</span>(data$aqs_id)
years &lt;-<span class="st"> </span><span class="kw">unique</span>(data$year)
data$quarter =<span class="st"> </span><span class="kw">quarter</span>(data$date)
quarters &lt;-<span class="st"> </span><span class="kw">unique</span>(data$quarter)
pocs &lt;-<span class="st"> </span><span class="kw">unique</span>(data$poc)

clean_values =<span class="st"> </span>function(data) {
  data$conc =<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(data$conc))
  data$conc[<span class="kw">abs</span>(data$conc) &gt;=<span class="st"> </span><span class="dv">999</span>] =<span class="st"> </span><span class="ot">NA</span>
  <span class="kw">return</span>(data)
}

data =<span class="st"> </span><span class="kw">clean_values</span>(data)

levene_function =<span class="st"> </span>function(conc, quarter_year, row, col) {
  if(<span class="kw">length</span>(<span class="kw">unique</span>(quarter_year))&lt;<span class="dv">2</span>){
  <span class="kw">return</span>(<span class="ot">NA</span>)} 
  data =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">conc =</span> conc, <span class="dt">quarter_year =</span> quarter_year)
  <span class="kw">return</span>(<span class="kw">leveneTest</span>(conc~<span class="kw">as.factor</span>(quarter_year), <span class="dt">data =</span> data)[row,col])
}

leak_table_unfiltered &lt;-<span class="st"> </span><span class="kw">data.frame</span>()
for(i in <span class="kw">max</span>(years):<span class="kw">max</span>(years)-<span class="dv">1</span>:<span class="kw">length</span>(years)){
  for(j in i<span class="dv">+1</span>){
    data_carbontet=<span class="kw">data.frame</span>()
  data_carbontet &lt;-<span class="st"> </span><span class="kw">filter</span>(data, pollutant==<span class="st">&quot;Carbon Tetrachloride&quot;</span>, !<span class="kw">is.na</span>(conc), year %in%<span class="st"> </span><span class="kw">c</span>(i, j))
data_carbontet$quarter_year =<span class="st"> </span><span class="kw">paste</span>(data_carbontet$quarter, <span class="st">&quot;_&quot;</span>, data_carbontet$year)
data_carbontet &lt;-<span class="st"> </span>data_carbontet %&gt;%<span class="st"> </span><span class="kw">group_by</span>(aqs_id, poc, quarter) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">fvalue_levene =</span> <span class="kw">levene_function</span>(conc, quarter_year, <span class="dv">1</span>,<span class="dv">2</span>), 
            <span class="dt">pval_levene =</span> <span class="kw">levene_function</span>(conc, quarter_year, <span class="dv">1</span>,<span class="dv">3</span>), 
            <span class="dt">deg_free_levene =</span> <span class="kw">levene_function</span>(conc, quarter_year, <span class="dv">2</span>,<span class="dv">1</span>),
            <span class="dt">Year_1 =</span> <span class="kw">min</span>(year), 
            <span class="dt">Year_2 =</span> <span class="kw">max</span>(year),
            <span class="dt">Mean_Year_1 =</span> <span class="kw">mean</span>(conc[year==<span class="kw">min</span>(year)], <span class="dt">na.rm=</span>T),
            <span class="dt">Mean_Year_2 =</span> <span class="kw">mean</span>(conc[year==<span class="kw">max</span>(year)], <span class="dt">na.rm=</span>T)) %&gt;%<span class="st"> </span><span class="kw">ungroup</span>()
leak_table_unfiltered  &lt;-<span class="st"> </span><span class="kw">rbind</span>(leak_table_unfiltered,data_carbontet)
  }
}
leak_table &lt;-<span class="st"> </span><span class="kw">filter</span>(leak_table_unfiltered, pval_levene&lt;<span class="fl">0.01</span>, <span class="kw">abs</span>(Year_1-Year_2)==<span class="dv">1</span>)
leak_table$Warning_Type &lt;-<span class="st"> &quot;Decrease_in_Measurements&quot;</span>

<span class="kw">datatable</span>(<span class="kw">head</span>(leak_table, <span class="dv">10</span>), <span class="dt">options =</span> dt_options) %&gt;%<span class="st"> </span><span class="kw">formatSignif</span>(<span class="kw">c</span>(<span class="st">&quot;fvalue_levene&quot;</span>, <span class="st">&quot;pval_levene&quot;</span>, <span class="st">&quot;Mean_Year_1&quot;</span>, <span class="st">&quot;Mean_Year_2&quot;</span>), <span class="dt">digits =</span> <span class="dv">2</span>)</code></pre></div>
<div id="htmlwidget-e6f5ab0366df44f19283" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-e6f5ab0366df44f19283">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10"],["270370423","270370020","270530963","270532006","271230871","271630436","271630438","271630438","270370423","270370442"],[1,1,1,1,1,1,1,1,1,1],[4,4,2,4,2,3,3,4,1,1],[12.8321167205998,8.30419781899445,10.1333525159204,7.83209847219975,31.8806166808157,10.0837964429286,7.84104281230434,7.95904130875383,8.69768548121834,15.5590610596442],[0.0018638364359345,0.00766282765700792,0.00355204671115566,0.00935632233004533,6.16044447634281e-006,0.00407513052426005,0.00992488779881281,0.00869911012386779,0.0066558304340496,0.000571273066957218],[20,27,28,27,26,24,24,28,26,25],[2012,2010,2010,2010,2010,2010,2010,2010,2009,2009],[2013,2011,2011,2011,2011,2011,2011,2011,2010,2010],[0.498802857142857,0.514200666666667,0.827502666666667,0.511833571428571,0.844817857142857,0.561594,0.573758,0.512104,0.494757857142857,0.468064666666667],[0.595147333333333,0.474537142857143,0.491134666666667,0.496167333333333,0.500149285714286,0.542759090909091,0.54276,0.489876,0.554974285714286,0.546286666666667],["Decrease_in_Measurements","Decrease_in_Measurements","Decrease_in_Measurements","Decrease_in_Measurements","Decrease_in_Measurements","Decrease_in_Measurements","Decrease_in_Measurements","Decrease_in_Measurements","Decrease_in_Measurements","Decrease_in_Measurements"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>aqs_id<\/th>\n      <th>poc<\/th>\n      <th>quarter<\/th>\n      <th>fvalue_levene<\/th>\n      <th>pval_levene<\/th>\n      <th>deg_free_levene<\/th>\n      <th>Year_1<\/th>\n      <th>Year_2<\/th>\n      <th>Mean_Year_1<\/th>\n      <th>Mean_Year_2<\/th>\n      <th>Warning_Type<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"autoWidth":true,"searching":false,"ordering":false,"lengthChange":false,"paginate":false,"info":false,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6,7,8,9,10]},{"orderable":false,"targets":0}],"order":[],"orderClasses":false,"rowCallback":"function(row, data) {\nDTWidget.formatSignif(this, row, data, 4, 2);\nDTWidget.formatSignif(this, row, data, 5, 2);\nDTWidget.formatSignif(this, row, data, 9, 2);\nDTWidget.formatSignif(this, row, data, 10, 2);\n}"}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
<div id="outs" class="section level2">
<h2><span class="header-section-number">2.2</span> Identify exceptional and extreme values aka outliers.</h2>
<p>These are detected by comparing each measured concentration to 3 X the 75th percentile of the data set by year, site, and pollutant. For now, pocs collocated measurements are not tested separately.</p>
<p><br> <strong>Sample <code>R</code> script</strong></p>
<p>Click the button below to view a step by step example of the method above.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<p><br></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Test for exceptionally high values [above 75th percentile X 3]</span>
high_data &lt;-<span class="st"> </span><span class="kw">group_by</span>(data, year, aqs_id, pollutant) %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="dt">AR_Mean =</span> <span class="kw">mean</span>(conc, <span class="dt">na.rm=</span>T), <span class="dt">Percentile_75 =</span> <span class="kw">quantile</span>(conc, <span class="fl">0.75</span>, <span class="dt">na.rm=</span>T), <span class="dt">Percentile_75_X3 =</span> Percentile_75*<span class="dv">3</span>) %&gt;%<span class="st"> </span><span class="kw">ungroup</span>()
high_data &lt;-<span class="st"> </span><span class="kw">filter</span>(high_data, conc&gt;Percentile_75_X3, !<span class="kw">is.na</span>(conc), AR_Mean&gt;md_limit, Percentile_75&gt;<span class="dv">0</span>)
high_data$Warning_Type &lt;-<span class="st"> &quot;Exceptionally_High_Value_Test&quot;</span>
high_data &lt;-<span class="st"> </span><span class="kw">unique</span>(high_data)
<span class="kw">datatable</span>(<span class="kw">head</span>(high_data, <span class="dv">10</span>), <span class="dt">options =</span> dt_options) </code></pre></div>
<div id="htmlwidget-f278c00638b3f9220b85" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f278c00638b3f9220b85">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10"],["270370465","270370465","270370465","270370465","270370465","270370465","270370465","270370465","270370465","270370465"],[1,2,1,1,1,2,1,2,1,2],[12102,12102,12102,12102,12102,12102,12102,12102,12102,12102],["2009-02-12","2009-02-12","2009-03-26","2009-12-21","2010-08-24","2010-08-24","2010-10-11","2010-10-11","2013-07-09","2013-07-09"],[0.02077,0.02092,0.01616,0.04905,0.04287,0.04097,0.01284,0.01235,0.01329,0.01338],[null,null,null,null,null,null,null,null,null,null],[0.0028236,0.0028236,0.0028236,0.0028236,0.0023556,0.0023556,0.0023556,0.0023556,0.00218715,0.00218715],["Antimony","Antimony","Antimony","Antimony","Antimony","Antimony","Antimony","Antimony","Antimony","Antimony"],[2009,2009,2009,2009,2010,2010,2010,2010,2013,2013],["7440-36-0","7440-36-0","7440-36-0","7440-36-0","7440-36-0","7440-36-0","7440-36-0","7440-36-0","7440-36-0","7440-36-0"],[1,1,1,4,3,3,4,4,3,3],[0.00486700854700855,0.00486700854700855,0.00486700854700855,0.00486700854700855,0.00380803738317757,0.00380803738317757,0.00380803738317757,0.00380803738317757,0.00299623853211009,0.00299623853211009],[0.00521,0.00521,0.00521,0.00521,0.003975,0.003975,0.003975,0.003975,0.00372,0.00372],[0.01563,0.01563,0.01563,0.01563,0.011925,0.011925,0.011925,0.011925,0.01116,0.01116],["Exceptionally_High_Value_Test","Exceptionally_High_Value_Test","Exceptionally_High_Value_Test","Exceptionally_High_Value_Test","Exceptionally_High_Value_Test","Exceptionally_High_Value_Test","Exceptionally_High_Value_Test","Exceptionally_High_Value_Test","Exceptionally_High_Value_Test","Exceptionally_High_Value_Test"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>aqs_id<\/th>\n      <th>poc<\/th>\n      <th>param_code<\/th>\n      <th>date<\/th>\n      <th>conc<\/th>\n      <th>null_code<\/th>\n      <th>md_limit<\/th>\n      <th>pollutant<\/th>\n      <th>year<\/th>\n      <th>cas<\/th>\n      <th>quarter<\/th>\n      <th>AR_Mean<\/th>\n      <th>Percentile_75<\/th>\n      <th>Percentile_75_X3<\/th>\n      <th>Warning_Type<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"autoWidth":true,"searching":false,"ordering":false,"lengthChange":false,"paginate":false,"info":false,"columnDefs":[{"className":"dt-right","targets":[2,3,5,7,9,11,12,13,14]},{"orderable":false,"targets":0}],"order":[],"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">high_data &lt;-<span class="st"> </span>high_data[, <span class="kw">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;pollutant&quot;</span>, <span class="st">&quot;aqs_id&quot;</span>, <span class="st">&quot;Warning_Type&quot;</span>)]
##Toxics - Multiplying by 3 returns ~4000/1176818 values as extreme, multiplying by 1.5 returns &gt;20,000. Multiplying by 3 returns between 2 and 45% of analyte/site/year groups.
##UFP - Multiplying by 3 returns 28894 of 1335083 total values. Multiplying by 3 returns between 2 and 15% of analyte/site/year groups.
##PAHs - Multiplying by 3 returns 168 of 39298 total values. Multiplying by 3 returns between 3 and 10% of analyte/site/year groups.</code></pre></div>
<h2 id="sticky"><span class="header-section-number">2.2</span> Identify sequential repeats aka “sticky” numbers</h2>
<p>Three sequential replicate values may be a result of a machine error.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Test for exceptionally high values [above 75th percentile X 3]</span>
repeat_data &lt;-<span class="st"> </span><span class="kw">group_by</span>(data, poc, year, aqs_id, pollutant) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(year, aqs_id, poc, pollutant, date) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Previous_Day =</span> <span class="kw">lag</span>(conc, <span class="dv">1</span>), 
         <span class="dt">Two_Days_Prior =</span> <span class="kw">lag</span>(conc, <span class="dv">2</span>)) %&gt;%<span class="st"> </span><span class="kw">ungroup</span>()
repeat_data &lt;-<span class="st"> </span><span class="kw">mutate</span>(repeat_data, <span class="dt">Repeat_Test =</span> <span class="kw">ifelse</span>(<span class="kw">round</span>(conc, <span class="dt">digits=</span><span class="dv">4</span>)==<span class="kw">round</span>(Previous_Day, <span class="dt">digits=</span><span class="dv">4</span>) &amp;<span class="st"> </span><span class="kw">round</span>(Previous_Day, <span class="dt">digits=</span><span class="dv">4</span>)==<span class="kw">round</span>(Two_Days_Prior, <span class="dt">digits=</span><span class="dv">4</span>), <span class="st">&quot;TRUE&quot;</span>, <span class="st">&quot;FALSE&quot;</span>))
repeat_data$Warning_Type &lt;-<span class="st"> &quot;Repeat_Test&quot;</span>
repeat_data &lt;-<span class="st"> </span><span class="kw">filter</span>(repeat_data, conc&gt;<span class="dv">0</span> &amp;<span class="st">  </span>Repeat_Test==<span class="ot">TRUE</span>)

<span class="kw">datatable</span>(<span class="kw">head</span>(repeat_data, <span class="dv">10</span>), <span class="dt">options =</span> dt_options)</code></pre></div>
<div id="htmlwidget-37ee876ecb144c772ccc" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-37ee876ecb144c772ccc">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10"],["270370020","270370020","270370020","270370020","270370020","270370020","270370020","270370020","270370020","270370020"],[1,1,1,1,1,1,1,1,1,1],[43218,12105,12105,12105,12105,43806,12110,12110,12113,43815],["2009-04-13","2009-03-08","2009-08-11","2009-08-17","2009-12-09","2009-10-16","2009-05-19","2009-11-03","2009-10-28","2009-06-12"],[0.02212,0.00022,1e-005,4e-005,1e-005,0.01034,0.00011,5e-005,0.00012,0.06071],[null,null,null,null,null,null,null,null,null,null],[0.120844061030091,0.0017316,0.0017316,0.0017316,0.0017316,0.387415757930539,0.0022308,0.0022308,0.0015288,0.273432395381246],["1,3-Butadiene","Beryllium","Beryllium","Beryllium","Beryllium","Bromoform","Cadmium","Cadmium","Cobalt","Ethylene Dichloride"],[2009,2009,2009,2009,2009,2009,2009,2009,2009,2009],["106-99-0","7440-41-7","7440-41-7","7440-41-7","7440-41-7","75-25-2","7440-43-9","7440-43-9","7440-48-4","107-06-2"],[2,1,3,3,4,4,2,4,4,2],[0.02212,0.00021,0,1e-005,0,0.01034,0.0001,2e-005,9e-005,0.06071],[0.02212,0.00018,0,0,0,0.01034,0.00015,0,0.00015,0.06071],["TRUE","TRUE","TRUE","TRUE","TRUE","TRUE","TRUE","TRUE","TRUE","TRUE"],["Repeat_Test","Repeat_Test","Repeat_Test","Repeat_Test","Repeat_Test","Repeat_Test","Repeat_Test","Repeat_Test","Repeat_Test","Repeat_Test"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>aqs_id<\/th>\n      <th>poc<\/th>\n      <th>param_code<\/th>\n      <th>date<\/th>\n      <th>conc<\/th>\n      <th>null_code<\/th>\n      <th>md_limit<\/th>\n      <th>pollutant<\/th>\n      <th>year<\/th>\n      <th>cas<\/th>\n      <th>quarter<\/th>\n      <th>Previous_Day<\/th>\n      <th>Two_Days_Prior<\/th>\n      <th>Repeat_Test<\/th>\n      <th>Warning_Type<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"autoWidth":true,"searching":false,"ordering":false,"lengthChange":false,"paginate":false,"info":false,"columnDefs":[{"className":"dt-right","targets":[2,3,5,7,9,11,12,13]},{"orderable":false,"targets":0}],"order":[],"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">repeat_data &lt;-<span class="st"> </span>repeat_data[, <span class="kw">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;pollutant&quot;</span>, <span class="st">&quot;aqs_id&quot;</span>, <span class="st">&quot;Warning_Type&quot;</span>)]
###There are many repeating values in the Toxics data. None in PAHs. Approximately 3200 for UFPs, but this is 15 minute data. We may need a more stringent test for UFPs.</code></pre></div>
<p><br> <em>Table: Dates and pollutants to check including the potential issue</em><br />
<div id="htmlwidget-4f64f75b860b005399d8" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4f64f75b860b005399d8">{"x":{"filter":"none","data":[["2009-04-13","2009-03-08","2009-08-11","2009-08-17","2009-12-09","2009-10-16","2009-05-19","2009-11-03","2009-10-28","2009-06-12"],["1,3-Butadiene","Beryllium","Beryllium","Beryllium","Beryllium","Bromoform","Cadmium","Cadmium","Cobalt","Ethylene Dichloride"],["270370020","270370020","270370020","270370020","270370020","270370020","270370020","270370020","270370020","270370020"],["Repeat_Test","Repeat_Test","Repeat_Test","Repeat_Test","Repeat_Test","Repeat_Test","Repeat_Test","Repeat_Test","Repeat_Test","Repeat_Test"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>date<\/th>\n      <th>pollutant<\/th>\n      <th>aqs_id<\/th>\n      <th>Warning_Type<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"autoWidth":true,"searching":false,"ordering":false,"lengthChange":false,"paginate":false,"info":false,"order":[],"orderClasses":false}},"evals":[],"jsHooks":[]}</script></p>
</div>
<p><br> <strong>Contributors</strong></p>
<blockquote>
<p>Kristie Ellickson, Cassie McMahon, Dorian Kvale, Derek Nagel</p>
</blockquote>
<p><br> <strong>References</strong><br />
<a href="https://www3.epa.gov/ttnamti1/files/ambient/airtox/NATTS%20TAD%20Revision%203_FINAL%20October%202016.pdf">USEPA Technical Support Document for the Nation Air Toxics Trends Sites</a></p>
<p><a href="https://webgate.ec.europa.eu/fpfis/mwikis/essvalidserv/images/a/ad/PRACTICAL_GUIDE_TO_DATA_VALIDATION.pdf">European Union Guide toe Data Validation</a></p>
<p>[US EPA Guidance on Data Verification and Data Validation] (<a href="https://www.epa.gov/sites/production/files/2015-06/documents/g8-final.pdf" class="uri">https://www.epa.gov/sites/production/files/2015-06/documents/g8-final.pdf</a>)</p>
<p>[US EPA Data Validation Workbook Presentation and Training Materials] (<a href="https://www3.epa.gov/ttnamti1/files/ambient/airtox/workbook/T-Workbook_Secs1-8.pdf" class="uri">https://www3.epa.gov/ttnamti1/files/ambient/airtox/workbook/T-Workbook_Secs1-8.pdf</a>)</p>
<p>[US EPA Data Validation Workbook] (<a href="https://nepis.epa.gov/Exe/ZyNET.exe/P1006PAB.TXT?ZyActionD=ZyDocument&amp;Client=EPA&amp;Index=2006+Thru+2010&amp;Docs" class="uri">https://nepis.epa.gov/Exe/ZyNET.exe/P1006PAB.TXT?ZyActionD=ZyDocument&amp;Client=EPA&amp;Index=2006+Thru+2010&amp;Docs</a>=&amp;Query=&amp;Time=&amp;EndTime=&amp;SearchMethod=1&amp;TocRestrict=n&amp;Toc=&amp;TocEntry=&amp;QField=&amp;QFieldYear=&amp;QFieldMonth=&amp;QFieldDay=&amp;IntQFieldOp=0&amp;ExtQFieldOp=0&amp;XmlQuery=&amp;File=D%3A%5Czyfiles%5CIndex%20Data%5C06thru10%5CTxt%5C00000016%5CP1006PAB.txt&amp;User=ANONYMOUS&amp;Password=anonymous&amp;SortMethod=h%7C-&amp;MaximumDocuments=1&amp;FuzzyDegree=0&amp;ImageQuality=r75g8/r75g8/x150y150g16/i425&amp;Display=hpfr&amp;DefSeekPage=x&amp;SearchBack=ZyActionL&amp;Back=ZyActionS&amp;BackDesc=Results%20page&amp;MaximumPages=1&amp;ZyEntry=1&amp;SeekPage=x&amp;ZyPURL)</p>
<p>[Review article by Helsel, D about non-detects and substitution methods.] (<a href="https://academic.oup.com/annweh/article/54/3/257/223531/Much-Ado-About-Next-to-Nothing-Incorporating" class="uri">https://academic.oup.com/annweh/article/54/3/257/223531/Much-Ado-About-Next-to-Nothing-Incorporating</a>)</p>
<p>[A Chemosphere review article describing why BDL substitution should not be done.] (<a href="https://pdfs.semanticscholar.org/182e/9278fc36dd73d48a414b8fbc30a44ea314d3.pdf" class="uri">https://pdfs.semanticscholar.org/182e/9278fc36dd73d48a414b8fbc30a44ea314d3.pdf</a>)</p>
<p>[Temporal variability of selected air toxics in the United States] (<a href="http://www.sciencedirect.com/science/article/pii/S1352231007004840" class="uri">http://www.sciencedirect.com/science/article/pii/S1352231007004840</a>)</p>
<p>[Spatial and temporal analysis of national air toxics data] (<a href="http://www.tandfonline.com/doi/pdf/10.1080/10473289.2006.10464576" class="uri">http://www.tandfonline.com/doi/pdf/10.1080/10473289.2006.10464576</a>)</p>

</div>
</div>
<script>
  $(".toggle").click(function() {
    $(this).toggleClass("open");
  });
</script>
            </section>

          </div>
        </div>
      </div>
<a href="data-cleaning-dorian-cassie.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="collocated-monitors-derek.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/MPCA-air/air-methods/edit/master/02-data_validation.Rmd",
"text": "Edit"
},
"download": ["air-methods.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
