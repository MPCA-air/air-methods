<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title></title>
  <meta name="description" content="">
  <meta name="generator" content="bookdown 0.7.4 and GitBook 2.6.7">

  <meta property="og:title" content="" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/MPCA-air/air-methods" />
  <meta property="og:image" content="https://github.com/MPCA-air/air-methodsimages/cover.jpeg" />
  
  <meta name="github-repo" content="MPCA-air/air-methods" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="" />
  
  
  <meta name="twitter:image" content="https://github.com/MPCA-air/air-methodsimages/cover.jpeg" />




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="site-comparisons.html">
<link rel="next" href="visuals.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.3/datatables.js"></script>
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://mpca-air.github.io/air-methods">Methods for air data analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="best-practices.html"><a href="best-practices.html"><i class="fa fa-check"></i><b>1</b> Best practices</a><ul>
<li class="chapter" data-level="1.1" data-path="best-practices.html"><a href="best-practices.html#welcome-to-the-tidyverse"><i class="fa fa-check"></i><b>1.1</b> Welcome to the Tidyverse</a></li>
<li class="chapter" data-level="1.2" data-path="best-practices.html"><a href="best-practices.html#keep-r-updated"><i class="fa fa-check"></i><b>1.2</b> Keep R updated</a></li>
<li class="chapter" data-level="1.3" data-path="best-practices.html"><a href="best-practices.html#script-organization"><i class="fa fa-check"></i><b>1.3</b> Script organization</a></li>
<li class="chapter" data-level="1.4" data-path="best-practices.html"><a href="best-practices.html#divide-and-conquer"><i class="fa fa-check"></i><b>1.4</b> Divide and conquer</a></li>
<li class="chapter" data-level="1.5" data-path="best-practices.html"><a href="best-practices.html#codebooks-metadata-and-data-dictionaries"><i class="fa fa-check"></i><b>1.5</b> Codebooks, metadata, and data dictionaries</a></li>
<li class="chapter" data-level="1.6" data-path="best-practices.html"><a href="best-practices.html#data-formatting"><i class="fa fa-check"></i><b>1.6</b> Data formatting</a></li>
<li class="chapter" data-level="1.7" data-path="best-practices.html"><a href="best-practices.html#pollutant-names"><i class="fa fa-check"></i><b>1.7</b> Pollutant names</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="get-data.html"><a href="get-data.html"><i class="fa fa-check"></i><b>2</b> Get data</a><ul>
<li class="chapter" data-level="2.1" data-path="get-data.html"><a href="get-data.html#air-monitoring"><i class="fa fa-check"></i><b>2.1</b> Air monitoring</a><ul>
<li class="chapter" data-level="2.1.1" data-path="get-data.html"><a href="get-data.html#AQS"><i class="fa fa-check"></i><b>2.1.1</b> Retrieving data from AQS</a></li>
<li class="chapter" data-level="2.1.2" data-path="get-data.html"><a href="get-data.html#rqamd"><i class="fa fa-check"></i><b>2.1.2</b> Retrieving data from AQS DataMart</a></li>
<li class="chapter" data-level="2.1.3" data-path="get-data.html"><a href="get-data.html#aqi-now"><i class="fa fa-check"></i><b>2.1.3</b> Current AQI observations</a></li>
<li class="chapter" data-level="2.1.4" data-path="get-data.html"><a href="get-data.html#wairsites"><i class="fa fa-check"></i><b>2.1.4</b> WAIR Site information table</a></li>
<li class="chapter" data-level="2.1.5" data-path="get-data.html"><a href="get-data.html#monitors"><i class="fa fa-check"></i><b>2.1.5</b> AirNow:Active AQI monitors</a></li>
<li class="chapter" data-level="2.1.6" data-path="get-data.html"><a href="get-data.html#EPAsites"><i class="fa fa-check"></i><b>2.1.6</b> EPA Google Earth Site Maps</a></li>
<li class="chapter" data-level="2.1.7" data-path="get-data.html"><a href="get-data.html#lims"><i class="fa fa-check"></i><b>2.1.7</b> Retrieving data from LIMS via Tableau</a></li>
<li class="chapter" data-level="2.1.8" data-path="get-data.html"><a href="get-data.html#AirVision"><i class="fa fa-check"></i><b>2.1.8</b> Retrieving continuous data from AirVision</a></li>
<li class="chapter" data-level="2.1.9" data-path="get-data.html"><a href="get-data.html#wair"><i class="fa fa-check"></i><b>2.1.9</b> Retrieving data from MPCA WAIR database</a></li>
<li class="chapter" data-level="2.1.10" data-path="get-data.html"><a href="get-data.html#toxics"><i class="fa fa-check"></i><b>2.1.10</b> Air toxics Data Explorer</a></li>
<li class="chapter" data-level="2.1.11" data-path="get-data.html"><a href="get-data.html#criteria"><i class="fa fa-check"></i><b>2.1.11</b> Criteria Pollutant Data Explorer</a></li>
<li class="chapter" data-level="2.1.12" data-path="get-data.html"><a href="get-data.html#AQI"><i class="fa fa-check"></i><b>2.1.12</b> Air Quality Index Summary Reports</a></li>
<li class="chapter" data-level="2.1.13" data-path="get-data.html"><a href="get-data.html#PAHs"><i class="fa fa-check"></i><b>2.1.13</b> Air Monitoring for PAHs</a></li>
<li class="chapter" data-level="2.1.14" data-path="get-data.html"><a href="get-data.html#tableau"><i class="fa fa-check"></i><b>2.1.14</b> Internal Data Explorers</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="get-data.html"><a href="get-data.html#health-and-standards"><i class="fa fa-check"></i><b>2.2</b> Health and standards</a><ul>
<li class="chapter" data-level="2.2.1" data-path="get-data.html"><a href="get-data.html#IHBs"><i class="fa fa-check"></i><b>2.2.1</b> Inhalation health benchmarks (IHBs)</a></li>
<li class="chapter" data-level="2.2.2" data-path="get-data.html"><a href="get-data.html#NAAQS"><i class="fa fa-check"></i><b>2.2.2</b> Air Quality Standards (NAAQS and MAAQS)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="get-data.html"><a href="get-data.html#air-modeling"><i class="fa fa-check"></i><b>2.3</b> Air modeling</a><ul>
<li class="chapter" data-level="2.3.1" data-path="get-data.html"><a href="get-data.html#nata"><i class="fa fa-check"></i><b>2.3.1</b> NATA modeling</a></li>
<li class="chapter" data-level="2.3.2" data-path="get-data.html"><a href="get-data.html#mnrisks"><i class="fa fa-check"></i><b>2.3.2</b> MNRISKS statewide risk modeling</a></li>
<li class="chapter" data-level="2.3.3" data-path="get-data.html"><a href="get-data.html#downscale"><i class="fa fa-check"></i><b>2.3.3</b> Downscaler modeling results for Ozone and PM2.5</a></li>
<li class="chapter" data-level="2.3.4" data-path="get-data.html"><a href="get-data.html#cmaq"><i class="fa fa-check"></i><b>2.3.4</b> CMAQ Ozone modeling</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="get-data.html"><a href="get-data.html#context"><i class="fa fa-check"></i><b>2.4</b> Context</a><ul>
<li class="chapter" data-level="2.4.1" data-path="get-data.html"><a href="get-data.html#mn-ei"><i class="fa fa-check"></i><b>2.4.1</b> MN Emissions Inventory</a></li>
<li class="chapter" data-level="2.4.2" data-path="get-data.html"><a href="get-data.html#nei"><i class="fa fa-check"></i><b>2.4.2</b> EPA’s NEI</a></li>
<li class="chapter" data-level="2.4.3" data-path="get-data.html"><a href="get-data.html#fac-coords"><i class="fa fa-check"></i><b>2.4.3</b> Facility locations</a></li>
<li class="chapter" data-level="2.4.4" data-path="get-data.html"><a href="get-data.html#wx-obs"><i class="fa fa-check"></i><b>2.4.4</b> Weather observations</a></li>
<li class="chapter" data-level="2.4.5" data-path="get-data.html"><a href="get-data.html#hysplit"><i class="fa fa-check"></i><b>2.4.5</b> HYSPLIT wind trajectories</a></li>
<li class="chapter" data-level="2.4.6" data-path="get-data.html"><a href="get-data.html#landuse"><i class="fa fa-check"></i><b>2.4.6</b> Land use maps</a></li>
<li class="chapter" data-level="2.4.7" data-path="get-data.html"><a href="get-data.html#census"><i class="fa fa-check"></i><b>2.4.7</b> United States Census boundaries</a></li>
<li class="chapter" data-level="2.4.8" data-path="get-data.html"><a href="get-data.html#acs"><i class="fa fa-check"></i><b>2.4.8</b> American Community Survey (ACS)</a></li>
</ul></li>
</ul></li>
<li><a href="quality-assurance-methods.html#quality-assurance-methods"><strong>Quality assurance methods</strong></a></li>
<li class="chapter" data-level="3" data-path="data-cleaning.html"><a href="data-cleaning.html"><i class="fa fa-check"></i><b>3</b> Data cleaning</a><ul>
<li class="chapter" data-level="3.1" data-path="data-cleaning.html"><a href="data-cleaning.html#missing"><i class="fa fa-check"></i><b>3.1</b> Blank, NULL, and missing values</a></li>
<li class="chapter" data-level="3.2" data-path="data-cleaning.html"><a href="data-cleaning.html#quals"><i class="fa fa-check"></i><b>3.2</b> Qualified data</a></li>
<li class="chapter" data-level="3.3" data-path="data-cleaning.html"><a href="data-cleaning.html#dups"><i class="fa fa-check"></i><b>3.3</b> Duplicate observations</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-validation.html"><a href="data-validation.html"><i class="fa fa-check"></i><b>4</b> Data validation</a><ul>
<li class="chapter" data-level="4.1" data-path="data-validation.html"><a href="data-validation.html#leaks"><i class="fa fa-check"></i><b>4.1</b> Instrument drift or leaks in a system.</a></li>
<li class="chapter" data-level="4.2" data-path="data-validation.html"><a href="data-validation.html#outs"><i class="fa fa-check"></i><b>4.2</b> Extreme values and outliers</a></li>
<li class="chapter" data-level="4.3" data-path="data-validation.html"><a href="data-validation.html#sticky2"><i class="fa fa-check"></i><b>4.3</b> Sequential repeats and “sticky” numbers</a></li>
<li class="chapter" data-level="4.4" data-path="data-validation.html"><a href="data-validation.html#unique"><i class="fa fa-check"></i><b>4.4</b> Unique detected values</a></li>
<li class="chapter" data-level="4.5" data-path="data-validation.html"><a href="data-validation.html#valid_ref"><i class="fa fa-check"></i><b>4.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="collocated-monitors.html"><a href="collocated-monitors.html"><i class="fa fa-check"></i><b>5</b> Collocated monitors</a><ul>
<li class="chapter" data-level="5.1" data-path="collocated-monitors.html"><a href="collocated-monitors.html#evalpocs"><i class="fa fa-check"></i><b>5.1</b> Evaluate collocated air monitors</a></li>
<li class="chapter" data-level="5.2" data-path="collocated-monitors.html"><a href="collocated-monitors.html#pripocs"><i class="fa fa-check"></i><b>5.2</b> Prioritize multiple air monitors (POCs)</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="detection-limits.html"><a href="detection-limits.html"><i class="fa fa-check"></i><b>6</b> Detection limits</a><ul>
<li class="chapter" data-level="6.1" data-path="detection-limits.html"><a href="detection-limits.html#method-detection-limit"><i class="fa fa-check"></i><b>6.1</b> Method Detection Limit</a></li>
<li class="chapter" data-level="6.2" data-path="detection-limits.html"><a href="detection-limits.html#calculating-mdls"><i class="fa fa-check"></i><b>6.2</b> Calculating MDLs</a></li>
<li class="chapter" data-level="6.3" data-path="detection-limits.html"><a href="detection-limits.html#finding-mpca-detection-limits"><i class="fa fa-check"></i><b>6.3</b> Finding MPCA detection limits</a></li>
<li class="chapter" data-level="6.4" data-path="detection-limits.html"><a href="detection-limits.html#qualifier-codes-for-detection-limits"><i class="fa fa-check"></i><b>6.4</b> Qualifier Codes for Detection Limits</a></li>
<li class="chapter" data-level="6.5" data-path="detection-limits.html"><a href="detection-limits.html#estimating-below-detection-values-what-not-to-do"><i class="fa fa-check"></i><b>6.5</b> Estimating below detection values <em>(what not to do)</em></a></li>
<li class="chapter" data-level="6.6" data-path="detection-limits.html"><a href="detection-limits.html#below-detection-values"><i class="fa fa-check"></i><b>6.6</b> Below detection values</a></li>
<li class="chapter" data-level="6.7" data-path="detection-limits.html"><a href="detection-limits.html#multiple-detection-limits"><i class="fa fa-check"></i><b>6.7</b> Multiple detection limits</a></li>
<li class="chapter" data-level="6.8" data-path="detection-limits.html"><a href="detection-limits.html#references"><i class="fa fa-check"></i><b>6.8</b> References</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="completeness-checks.html"><a href="completeness-checks.html"><i class="fa fa-check"></i><b>7</b> Completeness checks</a><ul>
<li class="chapter" data-level="7.1" data-path="completeness-checks.html"><a href="completeness-checks.html#complete"><i class="fa fa-check"></i><b>7.1</b> Completeness checks</a></li>
</ul></li>
<li><a href="summary-methods.html#summary-methods"><strong>Summary methods</strong></a></li>
<li class="chapter" data-level="8" data-path="summary-statistics.html"><a href="summary-statistics.html"><i class="fa fa-check"></i><b>8</b> Summary statistics</a><ul>
<li class="chapter" data-level="8.1" data-path="summary-statistics.html"><a href="summary-statistics.html#normal"><i class="fa fa-check"></i><b>8.1</b> Test for normality</a></li>
<li class="chapter" data-level="8.2" data-path="summary-statistics.html"><a href="summary-statistics.html#boots"><i class="fa fa-check"></i><b>8.2</b> Bootstrapping</a></li>
<li class="chapter" data-level="8.3" data-path="summary-statistics.html"><a href="summary-statistics.html#below"><i class="fa fa-check"></i><b>8.3</b> Below the detection limit</a></li>
<li class="chapter" data-level="8.4" data-path="summary-statistics.html"><a href="summary-statistics.html#confidence"><i class="fa fa-check"></i><b>8.4</b> Upper confidence limits (UCLs)</a></li>
<li class="chapter" data-level="8.5" data-path="summary-statistics.html"><a href="summary-statistics.html#incomplete"><i class="fa fa-check"></i><b>8.5</b> Annual summaries for incomplete data</a></li>
<li class="chapter" data-level="8.6" data-path="summary-statistics.html"><a href="summary-statistics.html#health"><i class="fa fa-check"></i><b>8.6</b> Comparison of data to inhalation health benchmarks</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="site-comparisons.html"><a href="site-comparisons.html"><i class="fa fa-check"></i><b>9</b> Site comparisons</a><ul>
<li class="chapter" data-level="9.1" data-path="site-comparisons.html"><a href="site-comparisons.html#confidence-intervals"><i class="fa fa-check"></i><b>9.1</b> Confidence intervals</a></li>
<li class="chapter" data-level="9.2" data-path="site-comparisons.html"><a href="site-comparisons.html#tools-to-visualize-data"><i class="fa fa-check"></i><b>9.2</b> Tools to visualize data</a><ul>
<li class="chapter" data-level="9.2.1" data-path="site-comparisons.html"><a href="site-comparisons.html#beeswarm-plots"><i class="fa fa-check"></i><b>9.2.1</b> Beeswarm Plots</a></li>
<li class="chapter" data-level="9.2.2" data-path="site-comparisons.html"><a href="site-comparisons.html#correlation-matrices"><i class="fa fa-check"></i><b>9.2.2</b> Correlation matrices</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="start-finish.html"><a href="start-finish.html"><i class="fa fa-check"></i><b>10</b> Start to finish</a><ul>
<li class="chapter" data-level="10.1" data-path="start-finish.html"><a href="start-finish.html#functions"><i class="fa fa-check"></i><b>10.1</b> Functions</a></li>
<li class="chapter" data-level="10.2" data-path="start-finish.html"><a href="start-finish.html#analysis-steps"><i class="fa fa-check"></i><b>10.2</b> Analysis steps</a></li>
</ul></li>
<li><a href="visuals.html#visuals"><strong>Visuals</strong></a></li>
<li class="chapter" data-level="11" data-path="charts.html"><a href="charts.html"><i class="fa fa-check"></i><b>11</b> Charts</a><ul>
<li class="chapter" data-level="11.1" data-path="charts.html"><a href="charts.html#calendar-plots"><i class="fa fa-check"></i><b>11.1</b> Calendar plots</a></li>
<li class="chapter" data-level="11.2" data-path="charts.html"><a href="charts.html#colors-and-themes"><i class="fa fa-check"></i><b>11.2</b> Colors and themes</a></li>
<li class="chapter" data-level="11.3" data-path="charts.html"><a href="charts.html#pollution-roses"><i class="fa fa-check"></i><b>11.3</b> Pollution roses</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="time-series.html"><a href="time-series.html"><i class="fa fa-check"></i><b>12</b> Time series</a><ul>
<li class="chapter" data-level="12.1" data-path="time-series.html"><a href="time-series.html#seasonality"><i class="fa fa-check"></i><b>12.1</b> Seasonality</a></li>
<li class="chapter" data-level="12.2" data-path="time-series.html"><a href="time-series.html#day-of-the-week"><i class="fa fa-check"></i><b>12.2</b> Day of the week</a></li>
<li class="chapter" data-level="12.3" data-path="time-series.html"><a href="time-series.html#hour-of-the-day"><i class="fa fa-check"></i><b>12.3</b> Hour of the day</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="maps.html"><a href="maps.html"><i class="fa fa-check"></i><b>13</b> Maps</a><ul>
<li class="chapter" data-level="13.1" data-path="maps.html"><a href="maps.html#creating-shapefiles-in-r"><i class="fa fa-check"></i><b>13.1</b> Creating shapefiles in R</a></li>
</ul></li>
<li><a href="mpca-data-tools.html#mpca-data-tools"><strong>MPCA data tools</strong></a></li>
<li class="chapter" data-level="14" data-path="aqi-explorer.html"><a href="aqi-explorer.html"><i class="fa fa-check"></i><b>14</b> AQI explorer</a></li>
<li class="chapter" data-level="15" data-path="criteria-pollutant-explorer.html"><a href="criteria-pollutant-explorer.html"><i class="fa fa-check"></i><b>15</b> Criteria pollutant explorer</a></li>
<li class="chapter" data-level="16" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html"><i class="fa fa-check"></i><b>16</b> Air toxics explorer</a><ul>
<li class="chapter" data-level="16.1" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#mpca-air-toxics-methods"><i class="fa fa-check"></i><b>16.1</b> MPCA Air Toxics Methods</a><ul>
<li class="chapter" data-level="16.1.1" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#data-cleaning-1"><i class="fa fa-check"></i><b>16.1.1</b> Data Cleaning</a></li>
<li class="chapter" data-level="16.1.2" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#data-validation-1"><i class="fa fa-check"></i><b>16.1.2</b> Data Validation</a></li>
<li class="chapter" data-level="16.1.3" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#parameter-occurrence-codes-pocs"><i class="fa fa-check"></i><b>16.1.3</b> Parameter Occurrence Codes (POCs)</a></li>
<li class="chapter" data-level="16.1.4" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#producing-annual-summaries"><i class="fa fa-check"></i><b>16.1.4</b> Producing Annual Summaries</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="edit-this-book.html"><a href="edit-this-book.html"><i class="fa fa-check"></i>Edit this book</a><ul>
<li class="chapter" data-level="16.2" data-path="edit-this-book.html"><a href="edit-this-book.html#references-1"><i class="fa fa-check"></i><b>16.2</b> References</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/MPCA-air" target="blank">Created by MPCA-air</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="start-finish" class="section level1">
<h1><span class="header-section-number"></span> Start to finish</h1>
<p>To pull it all together we created some functions to streamline the cleaning and analysis steps.</p>
<p><br></p>
<p>The script below shows an example workflow that starts with 24-hour air toxics data from MPCA’s Air Toxics Results database, walks through each of the analysis steps outlined in the previous sections, and produces data validation tools, POC analysis tools, completeness checks, annual summaries, site comparisons, and pollution roses.</p>
<div id="functions" class="section level2">
<h2><span class="header-section-number">10.1</span> Functions</h2>
<p>Click the button below to view example R script.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<p><br></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Functions</span>

install.MPCAair.packages =<span class="st"> </span><span class="cf">function</span>() {

<span class="kw">install.packages</span>(<span class="kw">c</span>(
  <span class="st">&quot;easypackages&quot;</span>,
  <span class="st">&quot;tidyverse&quot;</span>,
  <span class="st">&quot;lubridate&quot;</span>,
  <span class="st">&quot;knitr&quot;</span>,
  <span class="st">&quot;nortest&quot;</span>,
  <span class="st">&quot;car&quot;</span>,
  <span class="st">&quot;DT&quot;</span>,
  <span class="st">&quot;RcppRoll&quot;</span>,
  <span class="st">&quot;shiny&quot;</span>,
  <span class="st">&quot;rsconnect&quot;</span>,
  <span class="st">&quot;EnvStats&quot;</span>,
  <span class="st">&quot;openair&quot;</span>,
  <span class="st">&quot;ggbeeswarm&quot;</span>,
  <span class="st">&quot;reshape&quot;</span>,
  <span class="st">&quot;corrplot&quot;</span>,
  <span class="st">&quot;RODBC&quot;</span>
))

}

MPCA_air_libraries =<span class="st"> </span><span class="cf">function</span>() {
  
<span class="kw">library</span>(easypackages)
<span class="kw">libraries</span>(<span class="kw">c</span>(
  <span class="st">&quot;tidyverse&quot;</span>,
  <span class="st">&quot;lubridate&quot;</span>,
  <span class="st">&quot;knitr&quot;</span>,
  <span class="st">&quot;stats&quot;</span>,
  <span class="st">&quot;nortest&quot;</span>,
  <span class="st">&quot;car&quot;</span>,
  <span class="st">&quot;DT&quot;</span>,
  <span class="st">&quot;RcppRoll&quot;</span>,
  <span class="st">&quot;shiny&quot;</span>,
  <span class="st">&quot;rsconnect&quot;</span>,
  <span class="st">&quot;EnvStats&quot;</span>,
  <span class="st">&quot;openair&quot;</span>,
  <span class="st">&quot;ggbeeswarm&quot;</span>,
  <span class="st">&quot;reshape&quot;</span>,
  <span class="st">&quot;corrplot&quot;</span>,
  <span class="st">&quot;RODBC&quot;</span>
))

}

flag =<span class="st"> </span><span class="cf">function</span>(data) {
  <span class="kw">library</span>(tidyverse)
  <span class="kw">library</span>(lubridate)
  data =<span class="st"> </span><span class="kw">mutate</span>(data,
                <span class="dt">AQSID_flag =</span> <span class="kw">is.na</span>(AQSID),
                <span class="dt">POC_flag =</span> <span class="kw">is.na</span>(<span class="kw">as.numeric</span>(POC) ) <span class="op">|</span><span class="st"> </span><span class="kw">as.numeric</span>(POC) <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span><span class="kw">as.numeric</span>(POC) <span class="op">&gt;</span><span class="st"> </span><span class="dv">4</span>,
                <span class="dt">Parameter_flag =</span> <span class="kw">is.na</span>(<span class="kw">as.numeric</span>(Parameter)) <span class="op">|</span><span class="st"> </span><span class="kw">nchar</span>(<span class="kw">as.character</span>(Parameter)) <span class="op">!=</span><span class="st"> </span><span class="dv">5</span>,
                <span class="dt">Date_flag =</span> <span class="kw">is.na</span>(<span class="kw">ymd</span>(Date)),
                <span class="dt">Result_flag =</span> <span class="op">!</span><span class="kw">is.na</span>(Result) <span class="op">&amp;</span><span class="st"> </span>(<span class="kw">abs</span>(<span class="kw">as.numeric</span>(Result) ) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">900</span> <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(<span class="kw">as.numeric</span>(Result) ) ),
                <span class="dt">Null_flag =</span> (<span class="kw">is.na</span>(Result) <span class="op">&amp;</span><span class="st"> </span><span class="kw">is.na</span>(Null_Data_Code) ) <span class="op">|</span><span class="st"> </span>(<span class="op">!</span><span class="kw">is.na</span>(Result) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(Null_Data_Code) ),
                <span class="dt">MDL_flag =</span> <span class="kw">is.character</span>(MDL) <span class="op">|</span><span class="st"> </span>MDL <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>,
                <span class="dt">Pollutant_flag =</span> <span class="kw">is.na</span>(Pollutant),
                <span class="dt">any_flag =</span> (AQSID_flag <span class="op">+</span><span class="st"> </span>POC_flag <span class="op">+</span><span class="st"> </span>Parameter_flag <span class="op">+</span><span class="st"> </span>Date_flag <span class="op">+</span><span class="st"> </span>Result_flag <span class="op">+</span><span class="st"> </span>Null_flag <span class="op">+</span>
<span class="st">                              </span>MDL_flag <span class="op">+</span><span class="st"> </span>Pollutant_flag) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>
                )
}

remove_flagged =<span class="st"> </span><span class="cf">function</span>(data) {
  <span class="kw">library</span>(tidyverse)
  <span class="kw">return</span>(<span class="kw">filter</span>(data, <span class="op">!</span>any_flag) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">contains</span>(<span class="st">&quot;flag&quot;</span>) ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Result =</span> <span class="kw">as.numeric</span>(Result) ) )
}

flag_duplicates =<span class="st"> </span><span class="cf">function</span>(data) {
  <span class="kw">library</span>(tidyverse)
  <span class="kw">return</span>(data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(AQSID, POC, Parameter, Date) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Count =</span> <span class="kw">n</span>(), <span class="dt">duplicate_flag =</span> Count <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>))
}

average_duplicates =<span class="st"> </span><span class="cf">function</span>(data) {
  <span class="kw">library</span>(tidyverse)
  
  dupe_averaging =<span class="st"> </span><span class="cf">function</span>(Result, Censored) {
    
    Result =<span class="st"> </span>Result[<span class="op">!</span><span class="kw">is.na</span>(Result)]
    Censored =<span class="st"> </span>Censored[<span class="op">!</span><span class="kw">is.na</span>(Censored)]
    
    <span class="cf">if</span>(<span class="kw">all</span>(Censored, <span class="dt">na.rm =</span> T)) {
      <span class="kw">return</span> (<span class="kw">mean</span>(Result, <span class="dt">na.rm =</span> T))
    }
    <span class="cf">else</span> {
      <span class="kw">return</span> (<span class="kw">mean</span>(Result[<span class="op">!</span>Censored], <span class="dt">na.rm =</span> T ) )
    }
    
  }
  
  data =<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(AQSID, POC, Parameter, Pollutant, Date, MDL) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Result =</span> <span class="kw">dupe_averaging</span>(Result, Censored), <span class="dt">Censored =</span> <span class="kw">all</span>(Censored, <span class="dt">na.rm =</span> T) ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Result =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(Result), <span class="ot">NA</span>, Result), <span class="dt">Censored =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(Result), <span class="ot">NA</span>, Censored))
  <span class="kw">return</span> (data)
}



time_series_plots =<span class="st"> </span><span class="cf">function</span>(data) {
  
  <span class="kw">library</span>(shiny)
  <span class="kw">library</span>(readr)
  <span class="kw">library</span>(ggplot2)
  <span class="kw">library</span>(tidyverse)
  <span class="kw">library</span>(stringr)
  <span class="kw">library</span>(RcppRoll)
  <span class="kw">library</span>(lubridate)
  <span class="kw">library</span>(DT)
  <span class="kw">library</span>(rsconnect)


data &lt;-<span class="st"> </span><span class="kw">mutate</span>(data, <span class="dt">sitePOC =</span> <span class="kw">paste0</span>(AQSID,<span class="st">&quot;-&quot;</span>, POC) )
pollutant &lt;-<span class="st"> </span><span class="kw">unique</span>(data<span class="op">$</span>Pollutant)
site &lt;-<span class="st"> </span><span class="kw">unique</span>(data<span class="op">$</span>sitePOC)


<span class="kw">shinyApp</span>(
  <span class="dt">ui =</span> <span class="kw">fluidPage</span>(
                 <span class="kw">fluidRow</span>(
                   <span class="kw">column</span>(<span class="dv">3</span>,
                          <span class="dt">style =</span> <span class="st">&quot;padding-bottom: 20px;&quot;</span>,
                          <span class="kw">inputPanel</span>(
                            <span class="kw">selectInput</span>(<span class="st">&quot;pollutant&quot;</span>, <span class="dt">label=</span><span class="st">&quot;Choose a pollutant&quot;</span>, <span class="dt">choices =</span> pollutant, 
                                        <span class="dt">selected=</span><span class="st">&quot;Benzene&quot;</span>),
                            <span class="kw">selectInput</span>(<span class="st">&quot;site&quot;</span>, <span class="dt">label=</span><span class="st">&quot;Choose a site&quot;</span>, <span class="dt">choices =</span> site, <span class="dt">selected=</span><span class="dv">270535501</span>),
                            <span class="kw">dateRangeInput</span>(<span class="st">&quot;date&quot;</span>, <span class="dt">label =</span> <span class="st">&quot;Select date range&quot;</span>, <span class="dt">start =</span> <span class="st">&quot;2009-01-01&quot;</span>, <span class="dt">end =</span> 
                                             <span class="st">&quot;2013-12-31&quot;</span>, <span class="dt">min =</span> <span class="st">&quot;2009-01-01&quot;</span>, <span class="dt">max =</span> <span class="st">&quot;2013-12-31&quot;</span>) ) ),
                   <span class="kw">column</span>(<span class="dv">9</span>,
                          <span class="kw">plotOutput</span>(<span class="st">&#39;detlim&#39;</span>, <span class="dt">height =</span> <span class="st">&quot;400px&quot;</span>)))),
  
  
  <span class="dt">server =</span> <span class="cf">function</span>(input, output) {
    
    
    
    
    output<span class="op">$</span>detlim &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({
      data_sub =<span class="st"> </span><span class="kw">filter</span>(data, Pollutant<span class="op">==</span>input<span class="op">$</span>pollutant, sitePOC <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>site, Date <span class="op">&gt;=</span><span class="st"> </span>input<span class="op">$</span>date[<span class="dv">1</span>], Date <span class="op">&lt;=</span><span class="st"> </span>input<span class="op">$</span>date[<span class="dv">2</span>])
      <span class="kw">ggplot</span>(<span class="dt">data=</span>data_sub, <span class="kw">aes</span>(<span class="dt">x=</span> Date, <span class="dt">y=</span>Result)) <span class="op">+</span>
<span class="st">        </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color=</span>Censored), <span class="dt">size =</span><span class="dv">3</span>, <span class="dt">alpha=</span><span class="fl">0.55</span>) <span class="op">+</span>
<span class="st">        </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">        </span><span class="kw">scale_x_date</span>(<span class="dt">date_labels =</span> <span class="st">&quot;%D&quot;</span>) <span class="op">+</span>
<span class="st">        </span><span class="kw">xlab</span>(<span class="ot">NULL</span>) <span class="op">+</span>
<span class="st">        </span><span class="kw">ylab</span>(<span class="st">&quot;Result (ug/m3)&quot;</span>) <span class="op">+</span>
<span class="st">        </span><span class="kw">expand_limits</span>(<span class="dt">y=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">max</span>(data_sub<span class="op">$</span>Result))) <span class="op">+</span>
<span class="st">        </span><span class="kw">scale_colour_manual</span>(<span class="dt">values=</span> <span class="kw">c</span>(<span class="st">&quot;#197519&quot;</span>[<span class="ot">FALSE</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">unique</span>(data_sub<span class="op">$</span>Censored)], <span class="st">&quot;#0000FF&quot;</span>[<span class="ot">TRUE</span> <span class="op">%in%</span><span class="st"> </span><span class="kw">unique</span>(data_sub<span class="op">$</span>Censored)]), <span class="dt">breaks=</span><span class="kw">c</span>(<span class="ot">FALSE</span>, <span class="ot">TRUE</span>)) <span class="op">+</span>
<span class="st">        </span><span class="kw">theme</span>(<span class="dt">text =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">15</span>), <span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="op">-</span><span class="dv">90</span>, <span class="dt">vjust =</span> <span class="fl">0.3</span>,  <span class="dt">size=</span><span class="dv">14</span>)) <span class="op">+</span>
<span class="st">        </span><span class="kw">ggtitle</span>(<span class="kw">paste0</span>(<span class="st">&quot;Time series for &quot;</span>, input<span class="op">$</span>pollutant, <span class="st">&quot; at site &quot;</span>, input<span class="op">$</span>site))
    })
    
  })

}




POC_compare =<span class="st"> </span><span class="cf">function</span>(data) {

<span class="kw">library</span>(shiny)
<span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(rsconnect)  
  
data =<span class="st"> </span><span class="kw">distinct</span>(data, AQSID, POC, Parameter, Date, Pollutant, Year, <span class="dt">.keep_all =</span> T) <span class="co">#replace with better cleaning function</span>
data =<span class="st"> </span><span class="kw">spread</span>(data, POC, Result) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Status =</span> <span class="kw">ifelse</span>(<span class="st">`</span><span class="dt">1</span><span class="st">`</span> <span class="op">&lt;</span><span class="st"> </span>MDL  <span class="op">&amp;</span><span class="st"> `</span><span class="dt">2</span><span class="st">`</span> <span class="op">&lt;</span><span class="st"> </span>MDL, <span class="st">&quot;POCs 1 and 2 below MDL&quot;</span>, <span class="kw">ifelse</span>(<span class="st">`</span><span class="dt">1</span><span class="st">`</span> <span class="op">&lt;</span><span class="st"> </span>MDL, <span class="st">&quot;POC 1 below MDL&quot;</span>, <span class="kw">ifelse</span>(<span class="st">`</span><span class="dt">2</span><span class="st">`</span> <span class="op">&lt;</span><span class="st"> </span>MDL, <span class="st">&quot;POC 2 below MDL&quot;</span>, <span class="st">&quot;POCs 1 and 2 above MDL&quot;</span>) ) ) ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">drop_na</span>(Status)



Pollutant &lt;-<span class="st"> </span><span class="kw">unique</span>(data<span class="op">$</span>Pollutant)
Site &lt;-<span class="st"> </span><span class="kw">unique</span>(data<span class="op">$</span>AQSID)

<span class="kw">shinyApp</span>(
  <span class="dt">ui =</span> <span class="kw">fluidPage</span>(
                 <span class="kw">fluidRow</span>(
                   <span class="kw">column</span>(<span class="dv">3</span>,
                          <span class="dt">style =</span> <span class="st">&quot;padding-bottom: 20px;&quot;</span>,
                          <span class="kw">inputPanel</span>(
                            <span class="kw">selectInput</span>(<span class="st">&quot;Pollutant&quot;</span>, <span class="dt">label=</span><span class="st">&quot;Choose a pollutant&quot;</span>, <span class="dt">choices =</span> Pollutant),
                            <span class="kw">selectInput</span>(<span class="st">&quot;Site&quot;</span>, <span class="dt">label=</span><span class="st">&quot;Choose a site&quot;</span>, <span class="dt">choices =</span> Site),
                            <span class="kw">dateRangeInput</span>(<span class="st">&quot;date&quot;</span>, <span class="dt">label =</span> <span class="st">&quot;Select date range&quot;</span>, <span class="dt">start =</span> <span class="st">&quot;2009-01-01&quot;</span>, <span class="dt">end =</span> 
                                             <span class="st">&quot;2013-12-31&quot;</span>, <span class="dt">min =</span> <span class="st">&quot;2009-01-01&quot;</span>, <span class="dt">max =</span> <span class="st">&quot;2013-12-31&quot;</span>))),
                   <span class="kw">column</span>(<span class="dv">9</span>,
                          <span class="kw">plotOutput</span>(<span class="st">&#39;normviz&#39;</span>, <span class="dt">height =</span> <span class="st">&quot;500px&quot;</span>)))),
  
  
  <span class="dt">server =</span> <span class="cf">function</span>(input, output) {
    
    
    
    
    output<span class="op">$</span>normviz &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({
      data_sub =<span class="st"> </span><span class="kw">filter</span>(data, Pollutant<span class="op">==</span>input<span class="op">$</span>Pollutant, AQSID <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>Site, Date <span class="op">&gt;=</span><span class="st"> </span>input<span class="op">$</span>date[<span class="dv">1</span>], Date <span class="op">&lt;=</span><span class="st"> </span>input<span class="op">$</span>date[<span class="dv">2</span>])
      <span class="kw">ggplot</span>(data_sub, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">1</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">2</span><span class="st">`</span>, <span class="dt">color =</span> Status)) <span class="op">+</span>
<span class="st">        </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span>
<span class="st">        </span><span class="kw">geom_segment</span>(<span class="dt">x=</span><span class="op">-</span><span class="dv">1000</span>, <span class="dt">xend=</span><span class="dv">1000</span>, <span class="dt">y=</span><span class="op">-</span><span class="dv">1000</span>, <span class="dt">yend=</span><span class="dv">1000</span>, <span class="dt">color=</span><span class="st">&quot;red&quot;</span>, <span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span>
<span class="st">        </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;POC comparison chart&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;POC 1&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;POC 2&quot;</span>, <span class="dt">subtitle =</span> <span class="kw">paste</span>(<span class="st">&quot;Correlation =&quot;</span>, <span class="kw">round</span>(<span class="kw">cor</span>(data_sub<span class="op">$</span><span class="st">`</span><span class="dt">1</span><span class="st">`</span>,data_sub<span class="op">$</span><span class="st">`</span><span class="dt">2</span><span class="st">`</span>, <span class="dt">use =</span> <span class="st">&quot;complete&quot;</span>), <span class="dv">2</span>) ) )
    })
    
  })

}

POC_average =<span class="st"> </span><span class="cf">function</span>(data) {
  <span class="kw">library</span>(tidyverse)
  
  POC_averaging =<span class="st"> </span><span class="cf">function</span>(Result, Censored) {
    
    Result =<span class="st"> </span>Result[<span class="op">!</span><span class="kw">is.na</span>(Result)]
    Censored =<span class="st"> </span>Censored[<span class="op">!</span><span class="kw">is.na</span>(Censored)]
    
    <span class="cf">if</span>(<span class="kw">all</span>(Censored, <span class="dt">na.rm =</span> T)) {
      <span class="kw">return</span> (<span class="kw">mean</span>(Result, <span class="dt">na.rm =</span> T))
    }
    <span class="cf">else</span> {
      <span class="kw">return</span> (<span class="kw">mean</span>(Result[<span class="op">!</span>Censored], <span class="dt">na.rm =</span> T ) )
    }
    
  }
  
  data =<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(AQSID, Parameter, Pollutant, Date, MDL) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Result =</span> <span class="kw">POC_averaging</span>(Result, Censored), <span class="dt">Censored =</span> <span class="kw">all</span>(Censored, <span class="dt">na.rm =</span> T) ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">slice</span>(<span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>POC) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Result =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(Result), <span class="ot">NA</span>, Result), <span class="dt">Censored =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(Result), <span class="ot">NA</span>, Censored))
  <span class="kw">return</span> (data)
}


completeness_check =<span class="st"> </span><span class="cf">function</span>(data) {

<span class="co"># Create a sampling calendar based on EPA&#39;s air toxics monitoring schedule</span>
sample_calendar &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">start         =</span> <span class="st">&quot;2012-01-01&quot;</span>, 
                            <span class="dt">end           =</span> <span class="st">&quot;2016-12-31&quot;</span>, 
                            <span class="dt">day_interval  =</span> <span class="dv">6</span>,
                            <span class="dt">type          =</span> <span class="st">&quot;air_toxics&quot;</span>) {
  
  <span class="kw">library</span>(lubridate)
  
  <span class="co"># Convert &#39;start&#39; and &#39;end&#39; to class date</span>
  start &lt;-<span class="st"> </span><span class="kw">ymd</span>(start)
  end   &lt;-<span class="st"> </span><span class="kw">ymd</span>(end)
  
  <span class="co"># Set official start date to selected EPA calendar</span>
  <span class="cf">if</span>(type <span class="op">==</span><span class="st"> &quot;air_toxics&quot;</span>) {
      epa_start &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="st">&quot;1989-12-24&quot;</span>)
  } <span class="cf">else</span> {
      epa_start &lt;-<span class="st"> </span>start
  }
  
  <span class="co"># Create full table of sampling dates</span>
  calendar &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> epa_start, 
                  <span class="dt">to   =</span> end, 
                  <span class="dt">by   =</span> <span class="kw">paste</span>(day_interval, <span class="st">&quot;days&quot;</span>))
  
  
  <span class="co"># Subset to user&#39;s date range</span>
  calendar &lt;-<span class="st"> </span>calendar[calendar <span class="op">&gt;=</span><span class="st"> </span>start <span class="op">&amp;</span><span class="st"> </span>calendar <span class="op">&lt;=</span><span class="st"> </span>end]
  
  <span class="kw">return</span>(calendar)
  
}


<span class="co"># Find the year range of your data</span>
date_range &lt;-<span class="st"> </span><span class="kw">range</span>(data<span class="op">$</span>Date)

<span class="co"># Create expected sample calendar</span>
epa_schedule &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">Date =</span> <span class="kw">sample_calendar</span>(<span class="dt">start =</span> <span class="kw">format</span>(date_range[<span class="dv">1</span>], <span class="st">&quot;%Y-01-01&quot;</span>), <span class="co">#Extend range to first day of the year</span>
                                                  <span class="dt">end   =</span> <span class="kw">format</span>(date_range[<span class="dv">2</span>], <span class="st">&quot;%Y-12-31&quot;</span>), <span class="co">#Extend range to last day of the year</span>
                                                  <span class="dt">day_interval =</span> <span class="dv">6</span>))

<span class="co"># Add year and calendar quarter columns</span>
epa_schedule &lt;-<span class="st"> </span>epa_schedule <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Year        =</span> <span class="kw">year</span>(Date),
                                        <span class="dt">cal_quarter =</span> <span class="kw">quarter</span>(Date))


<span class="co"># Count the expected number of samples per quarter and year.</span>
epa_schedule &lt;-<span class="st"> </span>epa_schedule <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">                </span><span class="kw">group_by</span>(Year, cal_quarter) <span class="op">%&gt;%</span>
<span class="st">                </span><span class="kw">summarize</span>(<span class="dt">expected_quarter_samples =</span> <span class="kw">length</span>(<span class="kw">unique</span>(Date))) <span class="op">%&gt;%</span>
<span class="st">                </span><span class="kw">group_by</span>(Year) <span class="op">%&gt;%</span>
<span class="st">                </span><span class="kw">mutate</span>(<span class="dt">expected_annual_samples =</span> <span class="kw">sum</span>(expected_quarter_samples))


<span class="co"># Assign each date to a calendar quarter</span>
data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">cal_quarter =</span> <span class="kw">quarter</span>(Date))

<span class="co"># Count the number of sampling dates for each quarter and year.</span>
data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">        </span><span class="kw">group_by</span>(AQSID, Parameter, Pollutant, Year, cal_quarter) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">valid_quarter_samples =</span> <span class="kw">length</span>(<span class="kw">unique</span>(Date[<span class="op">!</span><span class="kw">is.na</span>(Result)]))) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">group_by</span>(AQSID, Parameter, Pollutant, Year) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">valid_annual_samples =</span> <span class="kw">length</span>(<span class="kw">unique</span>(Date[<span class="op">!</span><span class="kw">is.na</span>(Result)])))


<span class="co"># Join expected sample table to data by quarter and year columns</span>
data &lt;-<span class="st"> </span><span class="kw">left_join</span>(data, epa_schedule, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;cal_quarter&quot;</span>))


<span class="co"># Divide valid samples by expected samples</span>
data &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">        </span><span class="kw">group_by</span>(AQSID, Parameter, Pollutant, Year, cal_quarter) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">summarise</span>(<span class="dt">pct_quarter_samples =</span> <span class="kw">round</span>(valid_quarter_samples[<span class="dv">1</span>] <span class="op">/</span><span class="st"> </span>expected_quarter_samples[<span class="dv">1</span>], <span class="dv">2</span>)) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">mutate</span>(<span class="dt">Complete =</span> pct_quarter_samples <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.75</span>) <span class="op">%&gt;%</span>
<span class="st">        </span><span class="kw">group_by</span>(AQSID, Parameter, Pollutant, Year) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">        </span><span class="kw">summarise</span>(<span class="dt">Complete =</span> <span class="kw">sum</span>(Complete, <span class="dt">na.rm =</span> T) <span class="op">==</span><span class="st"> </span><span class="dv">4</span>,
                  <span class="dt">lowest_quarter =</span> <span class="kw">ifelse</span>(<span class="kw">n</span>() <span class="op">==</span><span class="st"> </span><span class="dv">4</span>, <span class="kw">min</span>(pct_quarter_samples, <span class="dt">na.rm =</span> T), <span class="dv">0</span>) )

<span class="kw">return</span>(data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(AQSID, Parameter, Pollutant, Year, Complete, lowest_quarter) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() )

}
        



UCL_<span class="dv">95</span> =<span class="st"> </span><span class="cf">function</span>(data, <span class="dt">Boot_Repeats =</span> <span class="dv">1000</span>) {
  <span class="kw">library</span>(EnvStats)
  <span class="kw">set.seed</span>(<span class="dv">2017</span>)
  
  annual_AT_means =<span class="st"> </span><span class="cf">function</span>(air_toxics) {
  
  air_toxics =<span class="st"> </span><span class="kw">mutate</span>(air_toxics, <span class="dt">Year =</span> <span class="kw">year</span>(<span class="kw">ymd</span>(Date)), <span class="dt">Quarter =</span> <span class="kw">quarter</span>(<span class="kw">ymd</span>(Date)) )
  sample_complete =<span class="st"> </span>air_toxics <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">completeness_check</span>()
  
  enough_detects =<span class="st"> </span>air_toxics <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(AQSID, Parameter, Pollutant, Year) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">Detected =</span> <span class="kw">mean</span>(Censored, <span class="dt">na.rm =</span> T) <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.8</span> )
  
  site_means =<span class="st"> </span>air_toxics <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(AQSID, Parameter, Pollutant, Year) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">Mean =</span> <span class="kw">ifelse</span>(<span class="kw">length</span>(<span class="kw">unique</span>(Result[<span class="op">!</span><span class="kw">is.na</span>(Result) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>Censored] ) ) <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>, <span class="ot">NA</span>,
     <span class="kw">ifelse</span> (<span class="kw">any</span>(Censored, <span class="dt">na.rm =</span> T), <span class="kw">elnormAltCensored</span>(Result, Censored, <span class="dt">method =</span> <span class="st">&quot;impute.w.mle&quot;</span>, <span class="dt">ci =</span> F)<span class="op">$</span>parameters[[<span class="dv">1</span>]], <span class="kw">mean</span>(Result, <span class="dt">na.rm =</span> T) ) ) )
  
  site_means =<span class="st"> </span><span class="kw">left_join</span>(site_means, sample_complete, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;AQSID&quot;</span>, <span class="st">&quot;Parameter&quot;</span>, <span class="st">&quot;Pollutant&quot;</span>, <span class="st">&quot;Year&quot;</span>) ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(enough_detects, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;AQSID&quot;</span>, <span class="st">&quot;Parameter&quot;</span>, <span class="st">&quot;Pollutant&quot;</span>, <span class="st">&quot;Year&quot;</span>) ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Mean =</span> <span class="kw">ifelse</span>(Complete <span class="op">&amp;</span><span class="st"> </span>Detected, Mean, <span class="ot">NA</span>), <span class="dt">ID =</span> <span class="kw">paste</span>(AQSID, Parameter, Pollutant, Year) )

  <span class="kw">return</span>(site_means)
}
  
  MLE_est &lt;-<span class="st"> </span><span class="cf">function</span>(data){
    
    results =<span class="st"> </span>data<span class="op">$</span>Result
    censored =<span class="st"> </span>data<span class="op">$</span>Censored
    n =<span class="st"> </span><span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(results))
    
    <span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">unique</span>(results[<span class="op">!</span><span class="kw">is.na</span>(results) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>censored] ) ) <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span> ) {
      MLE_means =<span class="st"> </span><span class="ot">NA</span>
    }
    
    <span class="cf">else</span> {
      random.rows =<span class="st"> </span><span class="ot">NULL</span>  
      random.rows =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">which</span>(<span class="op">!</span><span class="kw">is.na</span>(censored) <span class="op">&amp;</span><span class="st"> </span>(<span class="op">!</span>censored) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">duplicated</span>(results) ), <span class="dv">2</span>, <span class="dt">replace =</span> <span class="ot">FALSE</span>)
      random.rows =<span class="st"> </span><span class="kw">c</span>(random.rows, <span class="kw">sample</span>(<span class="kw">which</span>(<span class="op">!</span><span class="kw">is.na</span>(censored)), n<span class="op">-</span><span class="dv">2</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>))
      
      MLE_means =<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">sum</span>(censored[random.rows], <span class="dt">na.rm =</span> T) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="kw">mean</span>(results[random.rows]), <span class="kw">elnormAltCensored</span>(results[random.rows], censored[random.rows], <span class="dt">method =</span> <span class="st">&quot;impute.w.mle&quot;</span>, <span class="dt">ci =</span> F)<span class="op">$</span>parameters[[<span class="dv">1</span>]] )
    }
    
    <span class="kw">return</span>(MLE_means)
  }
  
  data =<span class="st"> </span><span class="kw">mutate</span>(data, <span class="dt">ID =</span> <span class="kw">paste</span>(AQSID, Parameter, Pollutant, Year), <span class="dt">Result =</span> <span class="kw">ifelse</span>(Censored, MDL, Result) )
  
  Bootstrap_means =<span class="st"> </span><span class="kw">replicate</span>(Boot_Repeats, (<span class="kw">by</span>(data, data<span class="op">$</span>ID, MLE_est) ) )
  
  CL =<span class="st"> </span><span class="kw">apply</span>(Bootstrap_means, <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="kw">sort</span>(x)[<span class="kw">ceiling</span>(<span class="fl">0.95</span> <span class="op">*</span><span class="st"> </span>Boot_Repeats)] )
  CL =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">ID =</span> <span class="kw">names</span>(CL), <span class="dt">UCL95 =</span> <span class="kw">unname</span>(CL))
  
  annual_summary =<span class="st"> </span><span class="kw">left_join</span>(<span class="kw">annual_AT_means</span>(data), CL, <span class="dt">by =</span> <span class="st">&quot;ID&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">UCL95 =</span> <span class="kw">ifelse</span>(Complete <span class="op">&amp;</span><span class="st"> </span>Detected, UCL95, <span class="ot">NA</span>) ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>ID)
  
  <span class="kw">return</span>(annual_summary)
  
}

site_compare =<span class="st"> </span><span class="cf">function</span>(data, site_number, <span class="dt">Boot_Repeats =</span> <span class="dv">1000</span>) {
  <span class="kw">library</span>(EnvStats)
  <span class="kw">set.seed</span>(<span class="dv">2017</span>)
  
  annual_AT_means =<span class="st"> </span><span class="cf">function</span>(air_toxics) {
  
  air_toxics =<span class="st"> </span><span class="kw">mutate</span>(air_toxics, <span class="dt">Year =</span> <span class="kw">year</span>(<span class="kw">ymd</span>(Date)), <span class="dt">Quarter =</span> <span class="kw">quarter</span>(<span class="kw">ymd</span>(Date)) )
  sample_complete =<span class="st"> </span>air_toxics <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">completeness_check</span>()
  
  enough_detects =<span class="st"> </span>air_toxics <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(AQSID, Parameter, Pollutant, Year) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">Detected =</span> <span class="kw">mean</span>(Censored, <span class="dt">na.rm =</span> T) <span class="op">&lt;=</span><span class="st"> </span><span class="fl">0.8</span> )
  
  site_means =<span class="st"> </span>air_toxics <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(AQSID, Parameter, Pollutant, Year) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">Mean =</span> <span class="kw">ifelse</span>(<span class="kw">length</span>(<span class="kw">unique</span>(Result[<span class="op">!</span><span class="kw">is.na</span>(Result) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>Censored] ) ) <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>, <span class="ot">NA</span>,
     <span class="kw">ifelse</span> (<span class="kw">any</span>(Censored, <span class="dt">na.rm =</span> T), <span class="kw">elnormAltCensored</span>(Result, Censored, <span class="dt">method =</span> <span class="st">&quot;impute.w.mle&quot;</span>, <span class="dt">ci =</span> F)<span class="op">$</span>parameters[[<span class="dv">1</span>]], <span class="kw">mean</span>(Result, <span class="dt">na.rm =</span> T) ) ) )
  
  site_means =<span class="st"> </span><span class="kw">left_join</span>(site_means, sample_complete, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;AQSID&quot;</span>, <span class="st">&quot;Parameter&quot;</span>, <span class="st">&quot;Pollutant&quot;</span>, <span class="st">&quot;Year&quot;</span>) ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">left_join</span>(enough_detects, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;AQSID&quot;</span>, <span class="st">&quot;Parameter&quot;</span>, <span class="st">&quot;Pollutant&quot;</span>, <span class="st">&quot;Year&quot;</span>) ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Mean =</span> <span class="kw">ifelse</span>(Complete <span class="op">&amp;</span><span class="st"> </span>Detected, Mean, <span class="ot">NA</span>), <span class="dt">ID =</span> <span class="kw">paste</span>(AQSID, Parameter, Pollutant, Year) )

  <span class="kw">return</span>(site_means)
}
  
  MLE_est &lt;-<span class="st"> </span><span class="cf">function</span>(data){
    
    results =<span class="st"> </span>data<span class="op">$</span>Result
    censored =<span class="st"> </span>data<span class="op">$</span>Censored
    n =<span class="st"> </span><span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(results))
    
    <span class="cf">if</span> (<span class="kw">length</span>(<span class="kw">unique</span>(results[<span class="op">!</span><span class="kw">is.na</span>(results) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>censored] ) ) <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span> ) {
      MLE_means =<span class="st"> </span><span class="ot">NA</span>
    }
    
    <span class="cf">else</span> {
      random.rows =<span class="st"> </span><span class="ot">NULL</span>  
      random.rows =<span class="st"> </span><span class="kw">sample</span>(<span class="kw">which</span>(<span class="op">!</span><span class="kw">is.na</span>(censored) <span class="op">&amp;</span><span class="st"> </span>(<span class="op">!</span>censored) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">duplicated</span>(results) ), <span class="dv">2</span>, <span class="dt">replace =</span> <span class="ot">FALSE</span>)
      random.rows =<span class="st"> </span><span class="kw">c</span>(random.rows, <span class="kw">sample</span>(<span class="kw">which</span>(<span class="op">!</span><span class="kw">is.na</span>(censored)), n<span class="op">-</span><span class="dv">2</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>))
      
      MLE_means =<span class="st"> </span><span class="kw">ifelse</span>(<span class="kw">sum</span>(censored[random.rows], <span class="dt">na.rm =</span> T) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="kw">mean</span>(results[random.rows]), <span class="kw">elnormAltCensored</span>(results[random.rows], censored[random.rows], <span class="dt">method =</span> <span class="st">&quot;impute.w.mle&quot;</span>, <span class="dt">ci =</span> F)<span class="op">$</span>parameters[[<span class="dv">1</span>]] )
    }
    
    <span class="kw">return</span>(MLE_means)
  }
  
  data =<span class="st"> </span><span class="kw">mutate</span>(data, <span class="dt">Result =</span> <span class="kw">ifelse</span>(Censored, MDL, Result), <span class="dt">ID =</span> <span class="kw">paste</span>(AQSID, Parameter, Pollutant, Year))
  
  Bootstrap_means =<span class="st"> </span><span class="kw">replicate</span>(Boot_Repeats, (<span class="kw">by</span>(data, data<span class="op">$</span>ID, MLE_est) ) )
  
  Bootstrap_means =<span class="st"> </span><span class="kw">rownames_to_column</span>(<span class="kw">as.data.frame</span>(Bootstrap_means), <span class="st">&quot;ID&quot;</span> )
  
  Bootstrap_means =<span class="st"> </span><span class="kw">right_join</span>(<span class="kw">annual_AT_means</span>(data), Bootstrap_means, <span class="dt">by =</span> <span class="st">&quot;ID&quot;</span>)
  
  Bootstrap_means =<span class="st"> </span>Bootstrap_means <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Parameter, Pollutant, Year) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(AQSID <span class="op">==</span><span class="st"> </span>site_number), <span class="dt">.by_group =</span> T ) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">group_by</span>(Parameter, Pollutant, Year) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">num_range</span>(<span class="st">&quot;V&quot;</span>, <span class="dv">1</span><span class="op">:</span>Boot_Repeats)), <span class="kw">funs</span>(<span class="kw">c</span>(<span class="kw">first</span>(.), (. <span class="op">-</span><span class="st"> </span><span class="kw">first</span>(.))[<span class="op">-</span><span class="dv">1</span>])) ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>()
  
  LB =<span class="st"> </span><span class="kw">select</span>(Bootstrap_means, <span class="kw">num_range</span>(<span class="st">&quot;V&quot;</span>, <span class="dv">1</span><span class="op">:</span>Boot_Repeats) ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">apply</span>(<span class="dv">1</span>, <span class="cf">function</span>(x) <span class="kw">sort</span>(<span class="op">-</span>x)[<span class="kw">floor</span>(<span class="fl">0.025</span> <span class="op">*</span><span class="st"> </span>Boot_Repeats)] )
  UB =<span class="st"> </span><span class="kw">select</span>(Bootstrap_means, <span class="kw">num_range</span>(<span class="st">&quot;V&quot;</span>, <span class="dv">1</span><span class="op">:</span>Boot_Repeats) ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">apply</span>(<span class="dv">1</span>, <span class="cf">function</span>(x) <span class="kw">sort</span>(<span class="op">-</span>x)[<span class="kw">ceiling</span>(<span class="fl">0.975</span> <span class="op">*</span><span class="st"> </span>Boot_Repeats)] )
  
  CI =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">Lower =</span> LB, <span class="dt">Upper =</span> UB)
  CI =<span class="st"> </span><span class="kw">bind_cols</span>(CI, Bootstrap_means) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Lower<span class="op">:</span>ID) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Pollutant, Year) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Lower =</span> <span class="kw">ifelse</span>(<span class="kw">any</span>(AQSID <span class="op">==</span><span class="st"> </span>site_number <span class="op">&amp;</span><span class="st"> </span>Complete <span class="op">&amp;</span><span class="st"> </span>Detected) <span class="op">&amp;</span><span class="st"> </span>AQSID <span class="op">!=</span><span class="st"> </span>site_number <span class="op">&amp;</span><span class="st"> </span>Complete <span class="op">&amp;</span><span class="st"> </span>
<span class="st">        </span>Detected, Lower, <span class="ot">NA</span>), <span class="dt">Upper =</span> <span class="kw">ifelse</span>(<span class="kw">any</span>(AQSID <span class="op">==</span><span class="st"> </span>site_number <span class="op">&amp;</span><span class="st"> </span>Complete <span class="op">&amp;</span><span class="st"> </span>Detected) <span class="op">&amp;</span><span class="st"> </span>AQSID <span class="op">!=</span><span class="st"> </span>
<span class="st">        </span>site_number <span class="op">&amp;</span><span class="st"> </span>Complete <span class="op">&amp;</span><span class="st"> </span>Detected, Upper, <span class="ot">NA</span>), <span class="dt">Comparison =</span> <span class="kw">ifelse</span>(Lower <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;Higher&quot;</span>, <span class="kw">ifelse</span>(Upper <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>, 
        <span class="st">&quot;Lower&quot;</span>, <span class="st">&quot;Same&quot;</span>) ) )
  
  <span class="kw">return</span>(CI <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() )
  
}

correlation_plots =<span class="st"> </span><span class="cf">function</span>(data, site) {
  <span class="kw">library</span>(tidyverse)
  <span class="kw">library</span>(corrplot)
  
  data_site &lt;-<span class="st"> </span><span class="kw">filter</span>(data, AQSID <span class="op">%in%</span><span class="st"> </span>site) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Date, Pollutant, Result)
  analytes &lt;-<span class="st"> </span><span class="kw">spread</span>(data_site, Pollutant, Result, <span class="dt">drop=</span>T)
  analytes<span class="op">$</span>Date &lt;-<span class="st"> </span><span class="ot">NULL</span>

  coranalytes &lt;-<span class="st"> </span><span class="kw">cor</span>(analytes, <span class="dt">method=</span><span class="st">&quot;kendall&quot;</span>, <span class="dt">use=</span><span class="st">&quot;pairwise.complete.obs&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.data.frame</span>()
  coranalytes &lt;-<span class="st"> </span><span class="kw">select_if</span>(coranalytes, <span class="cf">function</span>(x) <span class="op">!</span><span class="kw">all</span>(<span class="kw">is.na</span>(x))) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter_all</span>(<span class="kw">any_vars</span>(<span class="op">!</span><span class="kw">is.na</span>(.))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">as.matrix</span>()
  <span class="kw">rownames</span>(coranalytes) &lt;-<span class="st"> </span><span class="kw">colnames</span>(coranalytes)

  <span class="kw">return</span>(<span class="kw">corrplot</span>(coranalytes, <span class="dt">method =</span> <span class="st">&quot;circle&quot;</span>, <span class="dt">type=</span><span class="st">&quot;lower&quot;</span>, <span class="dt">tl.cex=</span><span class="fl">0.6</span>) )<span class="co">#plot matrix</span>
}




correlation_plots =<span class="st"> </span><span class="cf">function</span>(data) {
  <span class="kw">library</span>(tidyverse)
  <span class="kw">library</span>(corrplot)
  
  site &lt;-<span class="st"> </span><span class="kw">unique</span>(data<span class="op">$</span>AQSID)

  <span class="kw">shinyApp</span>(
  <span class="dt">ui =</span> <span class="kw">fluidPage</span>(
                 <span class="kw">fluidRow</span>(
                   <span class="kw">column</span>(<span class="dv">3</span>,
                          <span class="dt">style =</span> <span class="st">&quot;padding-bottom: 20px;&quot;</span>,
                          <span class="kw">inputPanel</span>(
                            <span class="kw">selectInput</span>(<span class="st">&quot;site&quot;</span>, <span class="dt">label=</span><span class="st">&quot;Choose a site&quot;</span>, <span class="dt">choices =</span> site),
                            <span class="kw">dateRangeInput</span>(<span class="st">&quot;date&quot;</span>, <span class="dt">label =</span> <span class="st">&quot;Select date range&quot;</span>, <span class="dt">start =</span> <span class="st">&quot;2009-01-01&quot;</span>, <span class="dt">end =</span> 
                                             <span class="st">&quot;2013-12-31&quot;</span>, <span class="dt">min =</span> <span class="st">&quot;2009-01-01&quot;</span>, <span class="dt">max =</span> <span class="st">&quot;2013-12-31&quot;</span>))),
                            <span class="kw">column</span>(<span class="dv">9</span>,
                            <span class="kw">plotOutput</span>(<span class="st">&#39;normviz&#39;</span>, <span class="dt">height =</span> <span class="st">&quot;500px&quot;</span>)))),
  
  
  <span class="dt">server =</span> <span class="cf">function</span>(input, output) {
    
    
    
    
    output<span class="op">$</span>normviz &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({
      data_sub =<span class="st"> </span><span class="kw">filter</span>(data, AQSID<span class="op">==</span>input<span class="op">$</span>site, Date <span class="op">&gt;=</span><span class="st"> </span>input<span class="op">$</span>date[<span class="dv">1</span>], Date <span class="op">&lt;=</span><span class="st"> </span>
<span class="st">                          </span>input<span class="op">$</span>date[<span class="dv">2</span>]) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Date, Pollutant, Result)
      analytes &lt;-<span class="st"> </span><span class="kw">spread</span>(data_sub, Pollutant, Result, <span class="dt">drop=</span>T)
      analytes<span class="op">$</span>Date &lt;-<span class="st"> </span><span class="ot">NULL</span>

      coranalytes &lt;-<span class="st"> </span><span class="kw">cor</span>(analytes, <span class="dt">method=</span><span class="st">&quot;kendall&quot;</span>, <span class="dt">use=</span><span class="st">&quot;pairwise.complete.obs&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.data.frame</span>()
      coranalytes &lt;-<span class="st"> </span><span class="kw">select_if</span>(coranalytes, <span class="cf">function</span>(x) <span class="op">!</span><span class="kw">all</span>(<span class="kw">is.na</span>(x))) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter_all</span>(<span class="kw">any_vars</span>(<span class="op">!</span><span class="kw">is.na</span>(.))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">as.matrix</span>()
      <span class="kw">rownames</span>(coranalytes) &lt;-<span class="st"> </span><span class="kw">colnames</span>(coranalytes)
      dummy_obj =<span class="st"> </span><span class="kw">corrplot</span>(coranalytes, <span class="dt">method =</span> <span class="st">&quot;circle&quot;</span>, <span class="dt">type=</span><span class="st">&quot;lower&quot;</span>, <span class="dt">tl.cex=</span><span class="fl">0.6</span>)
      
    })
    
  })
  
}



beeswarm_plot =<span class="st"> </span><span class="cf">function</span>(data) {
  <span class="kw">library</span>(dplyr)
  <span class="kw">library</span>(ggbeeswarm)
  <span class="kw">library</span>(ggplot2)
  
  data =<span class="st"> </span><span class="kw">mutate</span>(data, <span class="dt">AQSID =</span> <span class="kw">as.character</span>(AQSID) )
    
  Pollutant &lt;-<span class="st"> </span><span class="kw">unique</span>(data<span class="op">$</span>Pollutant)
  Year &lt;-<span class="st"> </span><span class="kw">unique</span>(data<span class="op">$</span>Year)

  <span class="kw">shinyApp</span>(
  <span class="dt">ui =</span> <span class="kw">fluidPage</span>(
                 <span class="kw">fluidRow</span>(
                   <span class="kw">column</span>(<span class="dv">3</span>,
                          <span class="dt">style =</span> <span class="st">&quot;padding-bottom: 20px;&quot;</span>,
                          <span class="kw">inputPanel</span>(
                            <span class="kw">selectInput</span>(<span class="st">&quot;Pollutant&quot;</span>, <span class="dt">label=</span><span class="st">&quot;Choose a pollutant&quot;</span>, <span class="dt">choices =</span> Pollutant),
                             <span class="kw">dateRangeInput</span>(<span class="st">&quot;date&quot;</span>, <span class="dt">label =</span> <span class="st">&quot;Select date range&quot;</span>, <span class="dt">start =</span> <span class="st">&quot;2009-01-01&quot;</span>, <span class="dt">end =</span> 
                                             <span class="st">&quot;2013-12-31&quot;</span>, <span class="dt">min =</span> <span class="st">&quot;2009-01-01&quot;</span>, <span class="dt">max =</span> <span class="st">&quot;2013-12-31&quot;</span>) ) ),
                            <span class="kw">column</span>(<span class="dv">9</span>,
                            <span class="kw">plotOutput</span>(<span class="st">&#39;normviz&#39;</span>, <span class="dt">height =</span> <span class="st">&quot;500px&quot;</span>)))),
  
  
  <span class="dt">server =</span> <span class="cf">function</span>(input, output) {
    
    
    
    
    output<span class="op">$</span>normviz &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({
      data_sub =<span class="st"> </span><span class="kw">filter</span>(data, Pollutant<span class="op">==</span>input<span class="op">$</span>Pollutant, Date <span class="op">&gt;=</span><span class="st"> </span>input<span class="op">$</span>date[<span class="dv">1</span>], Date <span class="op">&lt;=</span><span class="st"> </span>
<span class="st">                          </span>input<span class="op">$</span>date[<span class="dv">2</span>], <span class="op">!</span><span class="kw">is.na</span>(Result) )
      <span class="kw">ggplot</span>(data_sub, <span class="kw">aes</span>(<span class="dt">y =</span> AQSID, <span class="dt">x =</span> Result, <span class="dt">color =</span> Censored) ) <span class="op">+</span><span class="st"> </span>
<span class="st">      </span><span class="kw">geom_quasirandom</span>(<span class="dt">groupOnX=</span>F) <span class="op">+</span><span class="st">   </span>
<span class="st">      </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="kw">paste</span>(data_sub<span class="op">$</span>Pollutant[<span class="dv">1</span>]), <span class="dt">x =</span> <span class="st">&quot;Result (ug/m^3)&quot;</span> )
      
    })
    
  })
  
}




read_met_data_tableau =<span class="st"> </span><span class="cf">function</span>(<span class="dt">years =</span> <span class="dv">2009</span><span class="op">:</span><span class="dv">2017</span>, <span class="dt">stations =</span> <span class="st">&quot;MSP&quot;</span>) {
  <span class="kw">library</span>(tidyverse)
  years =<span class="st"> </span><span class="kw">paste0</span>(years, <span class="dt">collapse =</span> <span class="st">&quot;,&quot;</span>)
  stations =<span class="st"> </span><span class="kw">paste0</span>(stations, <span class="dt">collapse =</span> <span class="st">&quot;,&quot;</span>)
      url =<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;http://tableau.pca.state.mn.us/views/WeatherObservations2009-2017/HourTable.csv?Station=&quot;</span>,
                   stations, <span class="st">&quot;&amp;Year=&quot;</span>,years,<span class="st">&quot;&amp;Month=1,2,3,4,5,6,7,8,9,10,11,12&quot;</span>)
      met_data =<span class="st"> </span><span class="kw">read_csv</span>(url, <span class="dt">col_types =</span> <span class="st">&quot;??????????-&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Station, Year, Month, Day, Hour, 
                                                                     <span class="kw">everything</span>() ) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(Station, Year, 
                                                                                                Month, Day, Hour)
  <span class="kw">return</span>(met_data)
}

pollution_roses =<span class="st"> </span><span class="cf">function</span>(data, met_data, <span class="dt">num_breaks =</span> <span class="dv">5</span>) { <span class="co">#Met data must be in Tableau format</span>
  
  <span class="kw">library</span>(tidyverse)
  <span class="kw">library</span>(lubridate)
  <span class="kw">library</span>(openair)
  <span class="kw">library</span>(reshape)
  <span class="kw">library</span>(shiny)
  <span class="kw">library</span>(rsconnect)
  
  data<span class="op">$</span>Date =<span class="st"> </span><span class="kw">ymd</span>(data<span class="op">$</span>Date)
  
  met_data =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw">rename</span>(met_data, <span class="dt">wd =</span> <span class="st">`</span><span class="dt">Wind Dir</span><span class="st">`</span>, <span class="dt">ws =</span> <span class="st">`</span><span class="dt">Wind Spd MPH</span><span class="st">`</span>) <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">paste0</span>(Year,<span class="st">&quot;/&quot;</span>,Month,<span class="st">&quot;/&quot;</span>,Day,<span class="st">&quot; &quot;</span>,Hour,<span class="st">&quot;:00&quot;</span>), <span class="dt">date =</span> <span class="kw">ymd_hm</span>(date)) <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">select</span>(<span class="op">-</span>Day, <span class="op">-</span>Month, <span class="op">-</span>Hour, <span class="op">-</span>Year) <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">timeAverage</span>(<span class="dt">avg.time =</span> <span class="st">&quot;day&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">ymd</span>(date))
  
  data =<span class="st"> </span><span class="kw">left_join</span>(data, met_data, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;Date&quot;</span> =<span class="st"> &quot;date&quot;</span>))
  
  Pollutant &lt;-<span class="st"> </span><span class="kw">unique</span>(data<span class="op">$</span>Pollutant)
  Site &lt;-<span class="st"> </span><span class="kw">unique</span>(data<span class="op">$</span>AQSID)

  <span class="kw">shinyApp</span>(
  <span class="dt">ui =</span> <span class="kw">fluidPage</span>(
                 <span class="kw">fluidRow</span>(
                   <span class="kw">column</span>(<span class="dv">3</span>,
                          <span class="dt">style =</span> <span class="st">&quot;padding-bottom: 20px;&quot;</span>,
                          <span class="kw">inputPanel</span>(
                            <span class="kw">selectInput</span>(<span class="st">&quot;Pollutant&quot;</span>, <span class="dt">label=</span><span class="st">&quot;Choose a pollutant&quot;</span>, <span class="dt">choices =</span> Pollutant),
                            <span class="kw">selectInput</span>(<span class="st">&quot;Site&quot;</span>, <span class="dt">label=</span><span class="st">&quot;Choose a site&quot;</span>, <span class="dt">choices =</span> Site),
                            <span class="kw">dateRangeInput</span>(<span class="st">&quot;date&quot;</span>, <span class="dt">label =</span> <span class="st">&quot;Select date range&quot;</span>, <span class="dt">start =</span> <span class="st">&quot;2009-01-01&quot;</span>, <span class="dt">end =</span> 
                                             <span class="st">&quot;2013-12-31&quot;</span>, <span class="dt">min =</span> <span class="st">&quot;2009-01-01&quot;</span>, <span class="dt">max =</span> <span class="st">&quot;2013-12-31&quot;</span>))),
                   <span class="kw">column</span>(<span class="dv">9</span>,
                          <span class="kw">plotOutput</span>(<span class="st">&#39;normviz&#39;</span>, <span class="dt">height =</span> <span class="st">&quot;500px&quot;</span>)))),
  
  
  <span class="dt">server =</span> <span class="cf">function</span>(input, output) {
    
    
    
    
    output<span class="op">$</span>normviz &lt;-<span class="st"> </span><span class="kw">renderPlot</span>({
      data_sub =<span class="st"> </span><span class="kw">filter</span>(data, Pollutant<span class="op">==</span>input<span class="op">$</span>Pollutant, AQSID <span class="op">==</span><span class="st"> </span>input<span class="op">$</span>Site, Date <span class="op">&gt;=</span><span class="st"> </span>input<span class="op">$</span>date[<span class="dv">1</span>], Date <span class="op">&lt;=</span><span class="st"> </span>
<span class="st">                          </span>input<span class="op">$</span>date[<span class="dv">2</span>], <span class="op">!</span><span class="kw">is.na</span>(Result))
      data_sub =<span class="st"> </span>data_sub <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">MDL =</span> <span class="kw">max</span>(MDL), <span class="dt">minimum =</span> <span class="kw">min</span>(Result), <span class="dt">maximum =</span> <span class="kw">max</span>(Result), <span class="dt">Result =</span> 
                                       <span class="kw">ifelse</span>(Censored, <span class="fl">1e-16</span>, Result))
      breaks_site =<span class="st"> </span><span class="ot">NULL</span>
      <span class="cf">if</span>(<span class="op">!</span><span class="kw">all</span>(data_sub<span class="op">$</span>Censored)){
        
        breaks_site =<span class="st"> </span><span class="kw">c</span>(breaks_site, <span class="dv">0</span>,
                      <span class="kw">round_any</span>( <span class="kw">c</span>(data_sub<span class="op">$</span>MDL[<span class="dv">1</span>], data_sub<span class="op">$</span>MDL[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>(data_sub<span class="op">$</span>maximum[<span class="dv">1</span>] <span class="op">-</span><span class="st"> </span>data_sub<span class="op">$</span>MDL[<span class="dv">1</span>]) <span class="op">*</span><span class="st"> </span>
<span class="st">                                     </span>(<span class="dv">1</span><span class="op">:</span>(num_breaks<span class="op">-</span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>(num_breaks<span class="op">-</span><span class="dv">1</span>) ) ), <span class="fl">0.0001</span>, ceiling ) )
        <span class="kw">pollutionRose</span>(data_sub, <span class="dt">statistic =</span> <span class="st">&quot;abs.count&quot;</span>, <span class="dt">pollutant =</span> <span class="st">&quot;Result&quot;</span>, <span class="dt">breaks =</span> breaks_site, 
                  <span class="dt">key.footer=</span><span class="st">&quot;ug/m3&quot;</span>, <span class="dt">main=</span><span class="kw">paste</span>(<span class="st">&quot;Daily Average Pollution Rose for&quot;</span>,
                  data_sub<span class="op">$</span>Pollutant[<span class="dv">1</span>],<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, data_sub<span class="op">$</span>AQSID[<span class="dv">1</span>]) )
      }
      <span class="cf">else</span> {
        breaks_site =<span class="st"> </span><span class="kw">c</span>(breaks_site, <span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">round_any</span>( <span class="kw">c</span>(data_sub<span class="op">$</span>MDL[<span class="dv">1</span>], <span class="dv">2</span><span class="op">*</span>data_sub<span class="op">$</span>MDL[<span class="dv">1</span>] ), <span class="fl">0.0001</span>, ceiling ) ) )
        
        <span class="kw">pollutionRose</span>(data_sub, <span class="dt">statistic =</span> <span class="st">&quot;abs.count&quot;</span>, <span class="dt">pollutant =</span> <span class="st">&quot;Result&quot;</span>, <span class="dt">breaks =</span> breaks_site, 
                  <span class="dt">key.footer=</span><span class="st">&quot;ug/m3&quot;</span>, <span class="dt">main=</span><span class="kw">paste</span>(<span class="st">&quot;Daily Average Pollution Rose for&quot;</span>,
                  data_sub<span class="op">$</span>Pollutant[<span class="dv">1</span>],<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, data_sub<span class="op">$</span>AQSID[<span class="dv">1</span>]) )
        
      }
      
    })
    
  })

}</code></pre></div>
</div>
<p><br></p>
</div>
<div id="analysis-steps" class="section level2">
<h2><span class="header-section-number">10.2</span> Analysis steps</h2>
<p>Click the button below to view example R script.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#Import data</span>
<span class="kw">MPCA_air_libraries</span>()
<span class="kw">library</span>(tidyverse)
data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/MPCA-air/air-methods/master/airtoxics_data_2009_2013.csv&#39;</span>)
<span class="kw">names</span>(data)[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>] &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;AQSID&quot;</span>, <span class="st">&quot;POC&quot;</span>, <span class="st">&quot;Parameter&quot;</span>, <span class="st">&quot;Date&quot;</span>,<span class="st">&quot;Result&quot;</span>,
                       <span class="st">&quot;Null_Data_Code&quot;</span>, <span class="st">&quot;MDL&quot;</span>, <span class="st">&quot;Pollutant&quot;</span>, <span class="st">&quot;Year&quot;</span>, <span class="st">&quot;CAS&quot;</span>)

<span class="co"># Data cleaning</span>

flagged =<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">flag</span>() <span class="co">#Check with QA about flagged values if necessary.</span>

duplicates_flagged =<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">flag_duplicates</span>()

data =<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">Censored =</span> Result <span class="op">&lt;</span><span class="st"> </span>MDL) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">average_duplicates</span>() <span class="co">#We decide to average the duplicates here</span>

<span class="co"># Data Validation</span>

time_series =<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">time_series_plots</span>()

<span class="co"># Collocated monitors</span>

poc_comparisons =<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">POC_compare</span>()

data =<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">POC_average</span>()


<span class="co"># Completeness checks</span>

complete =<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">completeness_check</span>()

<span class="co"># Summary statistics</span>

annual_summary =<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(AQSID <span class="op">==</span><span class="st"> </span><span class="dv">270370020</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">UCL_95</span>(<span class="dv">100</span>)

<span class="co"># Site Comparisons</span>

site_number =<span class="st"> </span><span class="dv">270370020</span> <span class="co">#Our favorite site</span>

comparisons_to_FH =<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(AQSID <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">270370020</span>, <span class="dv">270370470</span>, <span class="dv">271230871</span>) ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">site_compare</span>(site_number, <span class="dv">50</span>)

pollutant_correlations =<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">correlation_plots</span>()

beeswarms =<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">beeswarm_plot</span>()


<span class="co"># Pollution Roses</span>

poll_rose_data =<span class="st"> </span>data

met_data =<span class="st"> </span><span class="kw">read_met_data_tableau</span>(<span class="dv">2009</span><span class="op">:</span><span class="dv">2013</span>, <span class="st">&quot;MSP&quot;</span>)

num_breaks =<span class="st"> </span><span class="dv">5</span>

pol_roses =<span class="st"> </span>poll_rose_data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pollution_roses</span>(met_data, num_breaks)</code></pre></div>
</div>
<p><br><br></p>
<p><a href="start-finish.html#start-finish">Back to top</a></p>

</div>
</div>
<script>
  $(".btn_code").click(function() {
    $(this.parentNode).toggleClass("open");
  });
</script>
            </section>

          </div>
        </div>
      </div>
<a href="site-comparisons.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="visuals.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/MPCA-air/air-methods/edit/master/09-start_to_finish.Rmd",
"text": "Edit"
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
