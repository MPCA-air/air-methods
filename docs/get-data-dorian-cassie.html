<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title></title>
  <meta name="description" content="">
  <meta name="generator" content="bookdown 0.5.2 and GitBook 2.6.7">

  <meta property="og:title" content="" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/MPCA-air/air-methods" />
  <meta property="og:image" content="https://github.com/MPCA-air/air-methodsimages/cover.jpeg" />
  
  <meta name="github-repo" content="MPCA-air/air-methods" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="" />
  
  
  <meta name="twitter:image" content="https://github.com/MPCA-air/air-methodsimages/cover.jpeg" />




  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="data-cleaning-dorian-cassie.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-0.9/htmlwidgets.js"></script>
<script src="libs/datatables-binding-0.2/datatables.js"></script>
<link href="libs/dt-core-1.10.12/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.12/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.12/js/jquery.dataTables.min.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="https://mpca-air.github.io/air-methods">Methods for air data analysis</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="get-data-dorian-cassie.html"><a href="get-data-dorian-cassie.html"><i class="fa fa-check"></i><b>1</b> Get data (Dorian &amp; Cassie)</a><ul>
<li class="chapter" data-level="1.1" data-path="get-data-dorian-cassie.html"><a href="get-data-dorian-cassie.html#aqi-now"><i class="fa fa-check"></i><b>1.1</b> Current AQI obs</a></li>
<li class="chapter" data-level="1.2" data-path="get-data-dorian-cassie.html"><a href="get-data-dorian-cassie.html#monitors"><i class="fa fa-check"></i><b>1.2</b> Current AQI observations</a></li>
<li class="chapter" data-level="1.3" data-path="get-data-dorian-cassie.html"><a href="get-data-dorian-cassie.html#tableau"><i class="fa fa-check"></i><b>1.3</b> Retrieving data from Tableau</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-cleaning-dorian-cassie.html"><a href="data-cleaning-dorian-cassie.html"><i class="fa fa-check"></i><b>2</b> Data cleaning (Dorian &amp; Cassie)</a><ul>
<li class="chapter" data-level="2.1" data-path="data-cleaning-dorian-cassie.html"><a href="data-cleaning-dorian-cassie.html#missing"><i class="fa fa-check"></i><b>2.1</b> Remove blank, NULL, and missing values</a></li>
<li class="chapter" data-level="2.2" data-path="data-cleaning-dorian-cassie.html"><a href="data-cleaning-dorian-cassie.html#quals"><i class="fa fa-check"></i><b>2.2</b> Remove <em>Qualified</em> data</a></li>
<li class="chapter" data-level="2.3" data-path="data-cleaning-dorian-cassie.html"><a href="data-cleaning-dorian-cassie.html#dups"><i class="fa fa-check"></i><b>2.3</b> Duplicate observations</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-validation-kristie.html"><a href="data-validation-kristie.html"><i class="fa fa-check"></i><b>3</b> Data validation (Kristie)</a><ul>
<li class="chapter" data-level="3.1" data-path="data-validation-kristie.html"><a href="data-validation-kristie.html#leaks"><i class="fa fa-check"></i><b>3.1</b> Identifying Instrument drift or leaks in a system.</a></li>
<li class="chapter" data-level="3.2" data-path="data-validation-kristie.html"><a href="data-validation-kristie.html#outs"><i class="fa fa-check"></i><b>3.2</b> Identify exceptional and extreme values aka outliers.</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="collocated-monitors-derek.html"><a href="collocated-monitors-derek.html"><i class="fa fa-check"></i><b>4</b> Collocated monitors (Derek)</a><ul>
<li class="chapter" data-level="4.1" data-path="collocated-monitors-derek.html"><a href="collocated-monitors-derek.html#evalpocs"><i class="fa fa-check"></i><b>4.1</b> Evaluate collocated air monitors (POCs)</a></li>
<li class="chapter" data-level="4.2" data-path="collocated-monitors-derek.html"><a href="collocated-monitors-derek.html#pripocs"><i class="fa fa-check"></i><b>4.2</b> Prioritize multiple air monitors (POCs)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="detection-limits-kristie-cassie.html"><a href="detection-limits-kristie-cassie.html"><i class="fa fa-check"></i><b>5</b> Detection limits (Kristie &amp; Cassie)</a><ul>
<li class="chapter" data-level="5.1" data-path="detection-limits-kristie-cassie.html"><a href="detection-limits-kristie-cassie.html#method-detection-limit---definition"><i class="fa fa-check"></i><b>5.1</b> Method Detection Limit - Definition</a></li>
<li class="chapter" data-level="5.2" data-path="detection-limits-kristie-cassie.html"><a href="detection-limits-kristie-cassie.html#procedure-for-calculating-method-detection-limits"><i class="fa fa-check"></i><b>5.2</b> Procedure for calculating method detection limits</a></li>
<li class="chapter" data-level="5.3" data-path="detection-limits-kristie-cassie.html"><a href="detection-limits-kristie-cassie.html#finding-detection-limits-cassie"><i class="fa fa-check"></i><b>5.3</b> Finding detection limits (Cassie)</a></li>
<li class="chapter" data-level="5.4" data-path="detection-limits-kristie-cassie.html"><a href="detection-limits-kristie-cassie.html#qualifier-codes-for-detection-limits"><i class="fa fa-check"></i><b>5.4</b> Qualifier Codes for Detection Limits</a></li>
<li class="chapter" data-level="5.5" data-path="detection-limits-kristie-cassie.html"><a href="detection-limits-kristie-cassie.html#below-detection-values-kristie"><i class="fa fa-check"></i><b>5.5</b> Below detection values (Kristie)</a><ul>
<li class="chapter" data-level="" data-path="detection-limits-kristie-cassie.html"><a href="detection-limits-kristie-cassie.html#example-charts-for-visualizing-data-below-detection-limits"><i class="fa fa-check"></i>Example charts for visualizing data below detection limits</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="detection-limits-kristie-cassie.html"><a href="detection-limits-kristie-cassie.html#multiple-detection-limits"><i class="fa fa-check"></i><b>5.6</b> Multiple detection limits</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="completeness-checks-dorian-cassie.html"><a href="completeness-checks-dorian-cassie.html"><i class="fa fa-check"></i><b>6</b> Completeness checks (Dorian &amp; Cassie)</a><ul>
<li class="chapter" data-level="6.1" data-path="completeness-checks-dorian-cassie.html"><a href="completeness-checks-dorian-cassie.html#complete"><i class="fa fa-check"></i><b>6.1</b> Completeness checks</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="summary-statistics.html"><a href="summary-statistics.html"><i class="fa fa-check"></i><b>7</b> Summary statistics</a><ul>
<li class="chapter" data-level="7.1" data-path="summary-statistics.html"><a href="summary-statistics.html#boots"><i class="fa fa-check"></i><b>7.1</b> Bootstrapping (Dorian)</a></li>
<li class="chapter" data-level="7.2" data-path="summary-statistics.html"><a href="summary-statistics.html#below"><i class="fa fa-check"></i><b>7.2</b> Below the detection limit</a></li>
<li class="chapter" data-level="7.3" data-path="summary-statistics.html"><a href="summary-statistics.html#confidence"><i class="fa fa-check"></i><b>7.3</b> Confidence intervals (Derek)</a></li>
<li class="chapter" data-level="7.4" data-path="summary-statistics.html"><a href="summary-statistics.html#incomplete"><i class="fa fa-check"></i><b>7.4</b> Annual summaries for incomplete data</a></li>
<li class="chapter" data-level="7.5" data-path="summary-statistics.html"><a href="summary-statistics.html#health"><i class="fa fa-check"></i><b>7.5</b> Comparison of data to inhalation health benchmarks (Kristie)</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="site-comparisons-derek-cassie.html"><a href="site-comparisons-derek-cassie.html"><i class="fa fa-check"></i><b>8</b> Site comparisons (Derek &amp; Cassie)</a><ul>
<li class="chapter" data-level="8.1" data-path="site-comparisons-derek-cassie.html"><a href="site-comparisons-derek-cassie.html#confidence-intervals"><i class="fa fa-check"></i><b>8.1</b> Confidence intervals</a></li>
<li class="chapter" data-level="8.2" data-path="site-comparisons-derek-cassie.html"><a href="site-comparisons-derek-cassie.html#tools-to-visualize-data"><i class="fa fa-check"></i><b>8.2</b> Tools to visualize data</a></li>
<li class="chapter" data-level="8.3" data-path="site-comparisons-derek-cassie.html"><a href="site-comparisons-derek-cassie.html#correlation-matrices-cassie"><i class="fa fa-check"></i><b>8.3</b> Correlation matrices (Cassie)</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="start-finish.html"><a href="start-finish.html"><i class="fa fa-check"></i><b>9</b> Start to finish (all hands on deck)</a></li>
<li class="chapter" data-level="10" data-path="charts.html"><a href="charts.html"><i class="fa fa-check"></i><b>10</b> Charts</a><ul>
<li class="chapter" data-level="10.1" data-path="charts.html"><a href="charts.html#boxplots-dorian"><i class="fa fa-check"></i><b>10.1</b> Boxplots (Dorian)</a><ul>
<li class="chapter" data-level="10.1.1" data-path="charts.html"><a href="charts.html#log-boxplot"><i class="fa fa-check"></i><b>10.1.1</b> Log boxplot</a></li>
<li class="chapter" data-level="10.1.2" data-path="charts.html"><a href="charts.html#outliers"><i class="fa fa-check"></i><b>10.1.2</b> Outliers</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="charts.html"><a href="charts.html#calendar-plots-cassie"><i class="fa fa-check"></i><b>10.2</b> Calendar plots (Cassie)</a></li>
<li class="chapter" data-level="10.3" data-path="charts.html"><a href="charts.html#colors-dorian"><i class="fa fa-check"></i><b>10.3</b> Colors (Dorian)</a></li>
<li class="chapter" data-level="10.4" data-path="charts.html"><a href="charts.html#openair-package-derek-cassie"><i class="fa fa-check"></i><b>10.4</b> <em>openair</em> package (Derek &amp; Cassie)</a></li>
<li class="chapter" data-level="10.5" data-path="charts.html"><a href="charts.html#pollution-roses-and-love-poems-derek"><i class="fa fa-check"></i><b>10.5</b> Pollution roses and love poems (Derek)</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="time-series.html"><a href="time-series.html"><i class="fa fa-check"></i><b>11</b> Time series</a><ul>
<li class="chapter" data-level="11.1" data-path="time-series.html"><a href="time-series.html#seasonality"><i class="fa fa-check"></i><b>11.1</b> Seasonality</a></li>
<li class="chapter" data-level="11.2" data-path="time-series.html"><a href="time-series.html#changepoints-before-after-tests"><i class="fa fa-check"></i><b>11.2</b> Changepoints (before &amp; after tests)</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="maps-kristie.html"><a href="maps-kristie.html"><i class="fa fa-check"></i><b>12</b> Maps (Kristie)</a><ul>
<li class="chapter" data-level="12.1" data-path="maps-kristie.html"><a href="maps-kristie.html#kriging"><i class="fa fa-check"></i><b>12.1</b> Kriging</a></li>
<li class="chapter" data-level="12.2" data-path="maps-kristie.html"><a href="maps-kristie.html#spatial-averaging-and-aggregation"><i class="fa fa-check"></i><b>12.2</b> Spatial averaging and aggregation</a></li>
<li class="chapter" data-level="12.3" data-path="maps-kristie.html"><a href="maps-kristie.html#creating-shapefiles-in-r-adn-joining-to-ej-areas"><i class="fa fa-check"></i><b>12.3</b> Creating shapefiles in R adn joining to EJ areas</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="additional-resources-kristie.html"><a href="additional-resources-kristie.html"><i class="fa fa-check"></i><b>13</b> Additional resources (Kristie)</a></li>
<li><a href="mpca-data-tools.html#mpca-data-tools"><strong>MPCA data tools</strong></a></li>
<li class="chapter" data-level="14" data-path="aqi-explorer.html"><a href="aqi-explorer.html"><i class="fa fa-check"></i><b>14</b> AQI explorer</a></li>
<li class="chapter" data-level="15" data-path="criteria-pollutant-explorer.html"><a href="criteria-pollutant-explorer.html"><i class="fa fa-check"></i><b>15</b> Criteria pollutant explorer</a></li>
<li class="chapter" data-level="16" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html"><i class="fa fa-check"></i><b>16</b> Air toxics explorer</a><ul>
<li class="chapter" data-level="16.1" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#mpca-air-toxics-methods"><i class="fa fa-check"></i><b>16.1</b> MPCA Air Toxics Methods</a><ul>
<li class="chapter" data-level="16.1.1" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#data-cleaning"><i class="fa fa-check"></i><b>16.1.1</b> Data Cleaning</a></li>
<li class="chapter" data-level="16.1.2" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#data-validation"><i class="fa fa-check"></i><b>16.1.2</b> Data Validation</a></li>
<li class="chapter" data-level="16.1.3" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#parameter-occurrence-codes-pocs"><i class="fa fa-check"></i><b>16.1.3</b> Parameter Occurrence Codes (POCs)</a></li>
<li class="chapter" data-level="16.1.4" data-path="air-toxics-explorer.html"><a href="air-toxics-explorer.html#producing-annual-summaries"><i class="fa fa-check"></i><b>16.1.4</b> Producing Annual Summaries</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="edit-this-book.html"><a href="edit-this-book.html"><i class="fa fa-check"></i>Edit this book</a></li>
<li class="divider"></li>
<li><a href="https://github.com/MPCA-air" target="blank">Created by MPCA-air</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="get-data-dorian-cassie" class="section level1">
<h1><span class="header-section-number"></span> Get data (Dorian &amp; Cassie)</h1>
<p><img src="http://imgs.xkcd.com/comics/fuck_grapefruit.png" width="55%" /></p>
<p>This section describes the location of data sources relevant to air monitoring and how to access them using R.</p>
<p>These data sources include:</p>
<p><strong>Air monitoring</strong></p>
<ul>
<li>EPA’s <em>AQS DataMart</em></li>
<li>EPA’s <em>AirNow</em>
<ul>
<li><a href="get-data-dorian-cassie.html#aqi-now">1.1</a> Current AQI observations<br />
</li>
<li><a href="get-data-dorian-cassie.html#monitors">1.2</a> Active AQI monitors<br />
</li>
</ul></li>
<li>MPCA air monitoring network</li>
</ul>
<p><strong>Health and standards</strong></p>
<ul>
<li>Inhalation health benchmarks</li>
<li>NAAQs</li>
</ul>
<p><strong>Air modeling</strong></p>
<ul>
<li>NATA</li>
<li>Downscaler for Ozone and PM2.5</li>
<li>MNRisks</li>
<li>CMAQ</li>
</ul>
<p><strong>Air emissions</strong></p>
<ul>
<li>EPA’s NEI</li>
<li>Facility locations</li>
</ul>
<p><strong>Meteorology and Climate</strong></p>
<ul>
<li>Observations</li>
<li>HYSPLIT for wind trajectories</li>
<li>Forecasts</li>
</ul>
<p><strong><a href="get-data-dorian-cassie.html#tableau">1.3</a> Tableau workbooks</strong></p>
<p><strong>Geography and American Community Survey (ACS)</strong></p>
<ul>
<li>Census</li>
<li>ACS</li>
<li>Traffic</li>
<li>Land use</li>
</ul>
<div id="aqi-now" class="section level2">
<h2><span class="header-section-number">1.1</span> Current AQI obs</h2>
<p>Air data for the entire United States is at your finger tips. <em>EPA’s AirNow</em> maintains a publicly accessible folder of current air monitoring data at <a href="https://files.airnowtech.org/" class="uri">https://files.airnowtech.org/</a>.</p>
<p><br> <strong>Sample <code>R</code> script</strong></p>
<p>Use the following R code to grab the most recent AQI results for the entire country.e.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)</code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)

<span class="co"># Connect to AirNow data site</span>
<span class="co">#https://files.airnowtech.org/</span>

airnow_link &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;https://s3-us-west-1.amazonaws.com//files.airnowtech.org/airnow/today/&quot;</span>,
                      <span class="st">&quot;HourlyData_&quot;</span>,
                      <span class="kw">format</span>(<span class="kw">Sys.time</span>()<span class="op">-</span><span class="dv">60</span><span class="op">*</span><span class="dv">75</span>, <span class="st">&quot;%Y%m%d%H&quot;</span>, <span class="dt">tz=</span><span class="st">&quot;GMT&quot;</span>),
                      <span class="st">&quot;.dat&quot;</span>)
  
aqi_now   &lt;-<span class="st"> </span><span class="kw">read_delim</span>(airnow_link, <span class="st">&quot;|&quot;</span>, 
                        <span class="dt">col_names =</span> F)</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   X1 = col_character(),
##   X2 = col_time(format = &quot;&quot;),
##   X3 = col_character(),
##   X4 = col_character(),
##   X5 = col_integer(),
##   X6 = col_character(),
##   X7 = col_character(),
##   X8 = col_double(),
##   X9 = col_character()
## )</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">                        <span class="co">#col_types = c(&#39;cccciccdc&#39;))</span>
 
<span class="co"># Add column names</span>
<span class="kw">names</span>(aqi_now) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;date&quot;</span>, <span class="st">&quot;time&quot;</span>, <span class="st">&quot;aqsid&quot;</span>, <span class="st">&quot;city&quot;</span>, <span class="st">&quot;local_time&quot;</span>, <span class="st">&quot;parameter&quot;</span>, <span class="st">&quot;units&quot;</span>, <span class="st">&quot;concentration&quot;</span>, <span class="st">&quot;agency&quot;</span>)


<span class="co"># Filter to Ozone and PM2.5 results</span>
aqi_now &lt;-<span class="st"> </span><span class="kw">filter</span>(aqi_now, parameter <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;OZONE&quot;</span>, <span class="st">&quot;PM2.5&quot;</span>))</code></pre></div>
</div>
<p><br> <strong>Contributors</strong></p>
<blockquote>
<p>Dorian Kvale</p>
</blockquote>
</div>
<div id="monitors" class="section level2">
<h2><span class="header-section-number">1.2</span> Current AQI observations</h2>
<p>Current air monitoring locations can be accessed from <em>AirNow</em> by opening the <code>monitoring_site_locations.dat</code> file.</p>
<p><br> <strong>Sample <code>R</code> script</strong></p>
<p>Click the button below to view a step by step example.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">library</span>(readr)

<span class="co"># Connect to AirNow data site</span>
<span class="co">#https://files.airnowtech.org/</span>

airnow_link &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;https://s3-us-west-1.amazonaws.com//files.airnowtech.org/airnow/today/&quot;</span>,
                      <span class="st">&quot;monitoring_site_locations.dat&quot;</span>)
  
aqi_sites   &lt;-<span class="st"> </span><span class="kw">read_delim</span>(airnow_link, <span class="st">&quot;|&quot;</span>, <span class="dt">col_names =</span> F)</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   X9 = col_double(),
##   X10 = col_double(),
##   X11 = col_double(),
##   X12 = col_double(),
##   X16 = col_integer()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Drop empty columns</span>
aqi_sites &lt;-<span class="st"> </span>aqi_sites[ , <span class="op">-</span><span class="kw">c</span>(<span class="dv">14</span><span class="op">:</span><span class="dv">16</span>,<span class="dv">22</span><span class="op">:</span><span class="dv">23</span>)]

<span class="co"># Add column names</span>
<span class="kw">names</span>(aqi_sites) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;aqsid&quot;</span>, 
                      <span class="st">&quot;parameter&quot;</span>, 
                      <span class="st">&quot;local_id&quot;</span>, 
                      <span class="st">&quot;name&quot;</span>, 
                      <span class="st">&quot;status&quot;</span>, 
                      <span class="st">&quot;state_region&quot;</span>, 
                      <span class="st">&quot;agency&quot;</span>, 
                      <span class="st">&quot;epa_region&quot;</span>, 
                      <span class="st">&quot;lat&quot;</span>, 
                      <span class="st">&quot;long&quot;</span>, 
                      <span class="st">&quot;elevation&quot;</span>,
                      <span class="st">&quot;local_time&quot;</span>,
                      <span class="st">&quot;country&quot;</span>,
                      <span class="st">&quot;city&quot;</span>,
                      <span class="st">&quot;state_fips&quot;</span>,
                      <span class="st">&quot;state&quot;</span>,
                      <span class="st">&quot;county_fips&quot;</span>,
                      <span class="st">&quot;county&quot;</span>)
                    

<span class="co"># Filter to Minnesota sites</span>
aqi_sites  &lt;-<span class="st"> </span><span class="kw">filter</span>(aqi_sites, state_fips <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">27</span>))</code></pre></div>
</div>
<p><br> <strong>Contributors</strong></p>
<blockquote>
<p>Dorian Kvale</p>
</blockquote>
<p><br> <strong>References</strong></p>
</div>
<div id="tableau" class="section level2">
<h2><span class="header-section-number">1.3</span> Retrieving data from Tableau</h2>
<p>I’ll let you in on a secret. You can grab data directly from published Tableau workbooks without ever having to open them. This is handy when you don’t have access to an underlying database or if you’re dealing with a database that requires complicated table joins to extract the data you need.</p>
<p>Here’s the trick.</p>
<blockquote>
<p>To download data from a Tableau workbook add “.csv” to the end of a worksheet’s <em>URL</em>.</p>
</blockquote>
<p>That’s it!</p>
<p>Let’s the grab the data behind the internal <a href="http://tableau.pca.state.mn.us/#/views/VWVolkswagendieselregistrationsinMN/VWownership">Volkswagen vehicle</a> workbook.</p>
<p><br> <strong>Sample <code>R</code> script</strong></p>
<p>Click the button below to view a step by step example.</p>
<div class="toggle">
<button class="btn_code">
Show <strong>R</strong> code
</button>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)


<span class="co"># MPCA Tableau site</span>
pca_tableau &lt;-<span class="st"> &quot;http://tableau.pca.state.mn.us/views/&quot;</span>

<span class="co"># Tableau worksheet</span>
## Delete the link garbage
## Remove the &quot;/#/&quot; in the middle and the question mark at the end w/ anything that comes after
workbook    &lt;-<span class="st"> &quot;Volkswagenownership/VWownership&quot;</span>

<span class="co"># Complete URL</span>
tableau_url &lt;-<span class="st"> </span><span class="kw">paste0</span>(pca_tableau, workbook)


<span class="co"># Final URL will look like this</span>
tableau_url &lt;-<span class="st"> &quot;http://tableau.pca.state.mn.us/views/VWVolkswagendieselregistrationsinMN/VWownership&quot;</span>


<span class="co"># Paste &quot;.csv&quot; to end of Tableau URL</span>
tableau_url &lt;-<span class="st"> </span><span class="kw">paste0</span>(tableau_url, <span class="st">&quot;.csv&quot;</span>)

<span class="co"># Read data into a data frame</span>
vw_cars &lt;-<span class="st"> </span><span class="kw">read_csv</span>(tableau_url)</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   `County number` = col_character(),
##   County = col_character(),
##   `Latitude (generated)` = col_double(),
##   `Longitude (generated)` = col_double(),
##   `% of VW registrations` = col_character()
## )</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Take a look</span>
<span class="kw">head</span>(vw_cars)</code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   `County number`   County `Latitude (generated)` `Longitude (generated)`
##             &lt;chr&gt;    &lt;chr&gt;                  &lt;dbl&gt;                   &lt;dbl&gt;
## 1          Aitkin   AITKIN                 46.637                 -93.432
## 2           Anoka    ANOKA                 45.224                 -93.265
## 3          Becker   BECKER                 46.933                 -95.678
## 4        Beltrami BELTRAMI                 47.888                 -95.008
## 5          Benton   BENTON                 45.691                 -94.056
## 6       Big Stone BIGSTONE                 45.455                 -96.469
## # ... with 1 more variables: `% of VW registrations` &lt;chr&gt;</code></pre>
<p><br></p>
<p>Do you feel like a Master Jedi? Good. But there is 1 small caveat.</p>
<ul>
<li>This trick doesn’t work on the URL of a Tableau <em>Story</em>. You’ll need to get to the worksheet or dashboard behind the story.</li>
</ul>
<p>For an example, take a look at the <a href="http://tableau.pca.state.mn.us/#/views/wplmn_data_browser/WPLMNBrowser">Watershed Pollutant Load Monitoring</a> workbook. Since the workbook loads to a <em>Story</em> the nifty <code>.csv</code> trick won’t work on this page. We need to jump over to a worksheet or dashboard behind the story.</p>
<p>In this case the tabs are shown at the top, but this won’t always be true. Let’s try the tab <em>“Download Annual data”</em>.</p>
<p>Now that you know the name of the worksheet, the data is free for the taking. Let’s read it into R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)


<span class="co"># MPCA Tableau site</span>
pca_tableau &lt;-<span class="st"> &quot;http://tableau.pca.state.mn.us/views/&quot;</span>

<span class="co"># Tableau workbook </span>
workbook    &lt;-<span class="st"> &quot;wplmn_data_browser/DownloadAnnualData&quot;</span>

<span class="co"># Complete URL</span>
tableau_url &lt;-<span class="st"> </span><span class="kw">paste0</span>(pca_tableau, workbook)



<span class="co"># Paste &quot;.csv&quot; to end of Tableau URL</span>
tableau_url &lt;-<span class="st"> </span><span class="kw">paste0</span>(tableau_url, <span class="st">&quot;.csv&quot;</span>)

<span class="co"># Read data into a data frame</span>
water &lt;-<span class="st"> </span><span class="kw">read_csv</span>(tableau_url)</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   `CatchArea (acres)` = col_integer(),
##   `FWMC (mg/L)` = col_double(),
##   Latitude = col_double(),
##   Longitude = col_double(),
##   `Mass (kg)` = col_integer(),
##   `Number of samples` = col_integer(),
##   `Vol (acre ft)` = col_integer(),
##   Year = col_integer(),
##   `Yield (lbs/ac)` = col_double()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># How many rows are there?</span>
<span class="kw">nrow</span>(water)</code></pre></div>
<pre><code>## [1] 4116</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Take a look</span>
<span class="kw">head</span>(water)</code></pre></div>
<pre><code>## # A tibble: 6 x 21
##   Blank  `Bsn Name` `CatchArea (acres)` `End date` `Equis ID`
##   &lt;chr&gt;       &lt;chr&gt;               &lt;int&gt;      &lt;chr&gt;      &lt;chr&gt;
## 1  &lt;NA&gt; Cedar River               92160 10/31/2013   S004-432
## 2  &lt;NA&gt; Cedar River               92160 10/31/2013   S004-432
## 3  &lt;NA&gt; Cedar River               92160 10/31/2013   S004-432
## 4  &lt;NA&gt; Cedar River               92160 10/31/2013   S004-432
## 5  &lt;NA&gt; Cedar River               92160 10/31/2013   S004-432
## 6  &lt;NA&gt; Cedar River               92160 10/31/2014   S004-432
## # ... with 16 more variables: `FWMC (mg/L)` &lt;dbl&gt;, Huc12 &lt;chr&gt;, `Hydstra
## #   ID` &lt;chr&gt;, `Intentionally blank` &lt;chr&gt;, Latitude &lt;dbl&gt;,
## #   Longitude &lt;dbl&gt;, `Mass (kg)` &lt;int&gt;, Name &lt;chr&gt;, `Number of
## #   samples` &lt;int&gt;, `Org Name` &lt;chr&gt;, Parameter &lt;chr&gt;, `Site Type` &lt;chr&gt;,
## #   `Start date` &lt;chr&gt;, `Vol (acre ft)` &lt;int&gt;, Year &lt;int&gt;, `Yield
## #   (lbs/ac)` &lt;dbl&gt;</code></pre>
<p><br></p>
<p>Wow! Over 4,000 rows of data. It looks like we got <strong>ALL</strong> the data. That’s because everything is selected in the filters on the right. If you’d like to download data for only a single site or a single year, you can change the filter by adding a little magic to the end of the URL.</p>
<p><br></p>
<p><strong>Requesting a subset</strong></p>
<p>The filters on the worksheet are accessible by using the format<code>Year=2014</code>. To add a filter to your data request you first add a <code>?</code> to the end of the workseet URL and then the filter. The final URL with the 2014 year filter would look like this <code>http://tableau.pca.state.mn.us/views/wplmn_data_browser/DownloadAnnualData.csv?Year=2014</code>.</p>
<p>Let’s get all the data for year 2014.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)

<span class="co"># MPCA Tableau site</span>
pca_tableau &lt;-<span class="st"> &quot;http://tableau.pca.state.mn.us/views/&quot;</span>

<span class="co"># Tableau worksheet</span>
workbook    &lt;-<span class="st"> &quot;wplmn_data_browser/DownloadAnnualData&quot;</span>

<span class="co"># Complete URL</span>
tableau_url &lt;-<span class="st"> </span><span class="kw">paste0</span>(pca_tableau, workbook)

  
<span class="co"># Paste &quot;.csv&quot; to end of Tableau URL</span>
tableau_url &lt;-<span class="st"> </span><span class="kw">paste0</span>(tableau_url, <span class="st">&quot;.csv&quot;</span>)

<span class="co"># Add the Year=2014 filter</span>
tableau_url &lt;-<span class="st"> </span><span class="kw">paste0</span>(tableau_url, <span class="st">&quot;?Year=2014&quot;</span>)

<span class="co"># Read data into a data frame</span>
water_<span class="dv">2014</span> &lt;-<span class="st"> </span><span class="kw">read_csv</span>(tableau_url)</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   `CatchArea (acres)` = col_integer(),
##   `FWMC (mg/L)` = col_double(),
##   Latitude = col_double(),
##   Longitude = col_double(),
##   `Mass (kg)` = col_integer(),
##   `Number of samples` = col_integer(),
##   `Vol (acre ft)` = col_integer(),
##   Year = col_integer(),
##   `Yield (lbs/ac)` = col_double()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Take a look</span>
<span class="kw">head</span>(water_<span class="dv">2014</span>)</code></pre></div>
<pre><code>## # A tibble: 6 x 21
##   Blank  `Bsn Name` `CatchArea (acres)` `End date` `Equis ID`
##   &lt;chr&gt;       &lt;chr&gt;               &lt;int&gt;      &lt;chr&gt;      &lt;chr&gt;
## 1  &lt;NA&gt; Cedar River               92160 10/31/2014   S004-432
## 2  &lt;NA&gt; Cedar River               92160 10/31/2014   S004-432
## 3  &lt;NA&gt; Cedar River               92160 10/31/2014   S004-432
## 4  &lt;NA&gt; Cedar River               92160 10/31/2014   S004-432
## 5  &lt;NA&gt; Cedar River               92160 10/31/2014   S004-432
## 6  &lt;NA&gt; Cedar River               92160 10/31/2014   S004-432
## # ... with 16 more variables: `FWMC (mg/L)` &lt;dbl&gt;, Huc12 &lt;chr&gt;, `Hydstra
## #   ID` &lt;chr&gt;, `Intentionally blank` &lt;chr&gt;, Latitude &lt;dbl&gt;,
## #   Longitude &lt;dbl&gt;, `Mass (kg)` &lt;int&gt;, Name &lt;chr&gt;, `Number of
## #   samples` &lt;int&gt;, `Org Name` &lt;chr&gt;, Parameter &lt;chr&gt;, `Site Type` &lt;chr&gt;,
## #   `Start date` &lt;chr&gt;, `Vol (acre ft)` &lt;int&gt;, Year &lt;int&gt;, `Yield
## #   (lbs/ac)` &lt;dbl&gt;</code></pre>
<p><br></p>
<p>Perfect! Were down to only 926 rows of data.</p>
<p><strong>Filtering with special characters</strong></p>
<p>Want to try one of the other filters? Things can get a little trickier when you filter on values that contain special characters, such as text with spaces — <em>“Total phosphorous”</em> — or slashes — <em>“FWMC (mg/L)”</em> —. To filter with special characters in a URL you’ll need to let the browser know that you really mean a text slash “/”, and that you don’t mean “move up a folder” as in <code>Desktop/Documents/Reports</code>. To do this, URL’s have codes for the characters that usually mean something else to computers. For example, the forward slash <em>“/”</em> has the special code <code>%2</code>. A space has the code <code>%20</code>.</p>
<p>Here is a table of codes for the most common symbols. A more complete reference and a tool to convert your text to a URL friendly format is online <a href="https://www.w3schools.com/tags/ref_urlencode.asp">here</a>.</p>
<div id="htmlwidget-f15b2d705ab550605bf9" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f15b2d705ab550605bf9">{"x":{"filter":"none","data":[["%20"],["%23"],["%25"],["%2D"],["%2E"],["%3C"],["%3E"],["%5C"],["%2F"],["%5E"],["%5F"],["%60"],["%7B"],["%7C"],["%7D"],["%7E"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th>space<\/th>\n      <th>\"<\/th>\n      <th>%<\/th>\n      <th>-<\/th>\n      <th>.<\/th>\n      <th>&lt;<\/th>\n      <th>&gt;<\/th>\n      <th>\\<\/th>\n      <th>/<\/th>\n      <th>^<\/th>\n      <th>_<\/th>\n      <th>`<\/th>\n      <th>{<\/th>\n      <th>|<\/th>\n      <th>}<\/th>\n      <th>~<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollX":true,"autoWidth":true,"searching":false,"ordering":false,"lengthChange":false,"paginate":false,"info":false,"order":[],"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><br></p>
<p>Let’s try filtering the data to one the values listed for <code>Parameter</code>. If the filter doesn’t work, Tableau will be nice and send you all of the data. However, it isn’t helpful enough to give you clues about what’s wrong with your filter. Like if I happen to misspell <em>phosphourus</em> 3 times.</p>
<p>The code below filters the data to the <code>Parameter</code> <em>Total phosphorus</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)

<span class="co"># MPCA Tableau site</span>
pca_tableau &lt;-<span class="st"> &quot;http://tableau.pca.state.mn.us/views/&quot;</span>

<span class="co"># Tableau worksheet</span>
workbook    &lt;-<span class="st"> &quot;wplmn_data_browser/DownloadAnnualData&quot;</span>

<span class="co"># Complete URL</span>
tableau_url &lt;-<span class="st"> </span><span class="kw">paste0</span>(pca_tableau, workbook)


<span class="co"># Paste &quot;.csv&quot; to end of Tableau URL</span>
tableau_url &lt;-<span class="st"> </span><span class="kw">paste0</span>(tableau_url, <span class="st">&quot;.csv&quot;</span>)

<span class="co"># Add the Measures=&quot;Mass+(kg)&quot; filter</span>
tableau_url &lt;-<span class="st"> </span><span class="kw">paste0</span>(tableau_url, <span class="st">&quot;?Parameter=Total%20phosphorus&quot;</span>)

<span class="co"># Read data into a data frame</span>
water_phos &lt;-<span class="st"> </span><span class="kw">read_csv</span>(tableau_url)</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   `CatchArea (acres)` = col_integer(),
##   `FWMC (mg/L)` = col_double(),
##   Latitude = col_double(),
##   Longitude = col_double(),
##   `Mass (kg)` = col_integer(),
##   `Number of samples` = col_integer(),
##   Year = col_integer(),
##   `Yield (lbs/ac)` = col_double()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Take a look</span>
<span class="kw">head</span>(water_phos, <span class="dv">5</span>)</code></pre></div>
<pre><code>## # A tibble: 5 x 21
##   Blank  `Bsn Name` `CatchArea (acres)` `End date` `Equis ID`
##   &lt;chr&gt;       &lt;chr&gt;               &lt;int&gt;      &lt;chr&gt;      &lt;chr&gt;
## 1  &lt;NA&gt; Cedar River               92160 10/31/2014   S004-432
## 2  &lt;NA&gt; Cedar River              122240 12/31/2009   S000-084
## 3  &lt;NA&gt; Cedar River              122240 12/31/2010   S000-084
## 4  &lt;NA&gt; Cedar River              122240 12/31/2011   S000-084
## 5  &lt;NA&gt; Cedar River              122240 12/31/2014   S000-084
## # ... with 16 more variables: `FWMC (mg/L)` &lt;dbl&gt;, Huc12 &lt;chr&gt;, `Hydstra
## #   ID` &lt;chr&gt;, `Intentionally blank` &lt;chr&gt;, Latitude &lt;dbl&gt;,
## #   Longitude &lt;dbl&gt;, `Mass (kg)` &lt;int&gt;, Name &lt;chr&gt;, `Number of
## #   samples` &lt;int&gt;, `Org Name` &lt;chr&gt;, Parameter &lt;chr&gt;, `Site Type` &lt;chr&gt;,
## #   `Start date` &lt;chr&gt;, `Vol (acre ft)` &lt;chr&gt;, Year &lt;int&gt;, `Yield
## #   (lbs/ac)` &lt;dbl&gt;</code></pre>
<p><br></p>
<p>Try filtering the sites to only the <code>Hydstra ID</code> <em>W38014001</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)

<span class="co">#Tableau worksheet URL</span>
tableau_url &lt;-<span class="st"> &quot;http://tableau.pca.state.mn.us/views/wplmn_data_browser/DownloadAnnualData&quot;</span>

<span class="co"># Paste &quot;.csv&quot; to end of Tableau URL</span>
tableau_url &lt;-<span class="st"> </span><span class="kw">paste0</span>(tableau_url, <span class="st">&quot;.csv&quot;</span>)

<span class="co"># Add the Measures=&quot;Mass+(kg)&quot; filter</span>
tableau_url &lt;-<span class="st"> </span><span class="kw">paste0</span>(tableau_url, <span class="st">&quot;?Hydstra%20ID=W38014001&quot;</span>)

<span class="co"># Read data into a data frame</span>
water_missip &lt;-<span class="st"> </span><span class="kw">read_csv</span>(tableau_url)</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_character(),
##   `CatchArea (acres)` = col_integer(),
##   `FWMC (mg/L)` = col_double(),
##   Latitude = col_double(),
##   Longitude = col_double(),
##   `Mass (kg)` = col_integer(),
##   `Number of samples` = col_integer(),
##   `Vol (acre ft)` = col_integer(),
##   Year = col_integer(),
##   `Yield (lbs/ac)` = col_double()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Take a look</span>
<span class="kw">head</span>(water_missip, <span class="dv">5</span>)</code></pre></div>
<pre><code>## # A tibble: 5 x 21
##   Blank              `Bsn Name` `CatchArea (acres)` `End date` `Equis ID`
##   &lt;chr&gt;                   &lt;chr&gt;               &lt;int&gt;      &lt;chr&gt;      &lt;chr&gt;
## 1  &lt;NA&gt; Lower Mississippi River            29824000 12/31/2007   S000-132
## 2  &lt;NA&gt; Lower Mississippi River            29824000 12/31/2007   S000-132
## 3  &lt;NA&gt; Lower Mississippi River            29824000 12/31/2007   S000-132
## 4  &lt;NA&gt; Lower Mississippi River            29824000 12/31/2007   S000-132
## 5  &lt;NA&gt; Lower Mississippi River            29824000 12/31/2007   S000-132
## # ... with 16 more variables: `FWMC (mg/L)` &lt;dbl&gt;, Huc12 &lt;chr&gt;, `Hydstra
## #   ID` &lt;chr&gt;, `Intentionally blank` &lt;chr&gt;, Latitude &lt;dbl&gt;,
## #   Longitude &lt;dbl&gt;, `Mass (kg)` &lt;int&gt;, Name &lt;chr&gt;, `Number of
## #   samples` &lt;int&gt;, `Org Name` &lt;chr&gt;, Parameter &lt;chr&gt;, `Site Type` &lt;chr&gt;,
## #   `Start date` &lt;chr&gt;, `Vol (acre ft)` &lt;int&gt;, Year &lt;int&gt;, `Yield
## #   (lbs/ac)` &lt;dbl&gt;</code></pre>
<p><br></p>
<p>Simple site IDs are your friend. Dashes, slashes, and surprising capital letters are your not.</p>
<h3 id="a-happy-note"><span class="header-section-number">1.3</span> A Happy note!</h3>
<p>To add multiple filters separate them with the <code>&amp;</code> character with no spaces. As in <code>?Year=2014&amp;Parameter=Flow</code>.</p>
<h3 id="sad-note-1"><span class="header-section-number">1.3</span> Sad note /#1</h3>
<blockquote>
<p>If the author of the worksheet hasn’t added the filter to the page, you won’t be able to use it in a magic URL.</p>
</blockquote>
<h3 id="sad-note-2"><span class="header-section-number">1.3</span> Sad note /#2</h3>
<blockquote>
<p>If the workbook author has all of its worksheets and dashboards hidden, you won’t be able to access its data using the “.csv” trick. Contact the workbook author and politley request that they unhide one of their data tabs so you can more easily steal the data.</p>
</blockquote>
<h4 id="facility-emissions"><span class="header-section-number">1.3</span> Facility emissions</h4>
<p>Sometimes tabs are hidden.</p>
<ol style="list-style-type: decimal">
<li>Download and open the workbook to find the name of the worksheet with the data you want.</li>
<li>In this case the tabs are shown (this won’t always be the case), click <code>Share</code> on the bottom of the page and copy the lower link. Paste this URL into your browser and then scroll all the way to the bottom of the page. You should see a section called <strong>Metadata:</strong> on the right. These are all the names of the hidden tabs! You can even open them. Let’s try downloading data from the tab <em>“Download Annual data”</em>.</li>
</ol>
<p>Now that you know the name of the worksheet, the data is yours. Let’s read it into R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)

<span class="co">#Tableau worksheet URL</span>
tableau_url &lt;-<span class="st"> &quot;https://public.tableau.com/profile/mpca.data.services#!/vizhome/Pointsourceairemissionsdata/EmissionsbyFacility&quot;</span>

<span class="co"># Add &quot;.csv?:embed=y&quot; to Tableau URL</span>
tableau_url &lt;-<span class="st"> </span><span class="kw">paste0</span>(tableau_url, <span class="st">&quot;.csv&quot;</span>)

fac_emits &lt;-<span class="st"> </span><span class="kw">read_csv</span>(tableau_url)</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   `&lt;!DOCTYPE html&gt;` = col_character()
## )</code></pre>
<pre><code>## Warning in rbind(names(probs), probs_f): number of columns of result is not
## a multiple of vector length (arg 1)</code></pre>
<pre><code>## Warning: 491 parsing failures.
## row # A tibble: 5 x 5 col     row   col           expected    actual expected   &lt;int&gt; &lt;chr&gt;              &lt;chr&gt;     &lt;chr&gt; actual 1    10  &lt;NA&gt;          1 columns 2 columns file 2    11  &lt;NA&gt; delimiter or quote         f row 3    11  &lt;NA&gt; delimiter or quote         = col 4    11  &lt;NA&gt; delimiter or quote         d expected 5    11  &lt;NA&gt; delimiter or quote         ) actual # ... with 1 more variables: file &lt;chr&gt;
## ... ................. ... .......................................... ........ .......................................... ...... .......................................... .... .......................................... ... .......................................... ... .......................................... ........ .......................................... ...... .......................................
## See problems(...) for more details.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(fac_emits)</code></pre></div>
<pre><code>## # A tibble: 6 x 1
##                                                             `&lt;!DOCTYPE html&gt;`
##                                                                         &lt;chr&gt;
## 1 &quot;&lt;!--[if IEMobile 7]&gt;&lt;html class=\&quot;no-js ie iem7\&quot; lang=\&quot;en\&quot; dir=\&quot;ltr\&quot;&gt;
## 2 &quot;&lt;!--[if lte IE 6]&gt;&lt;html class=\&quot;no-js ie lt-ie9 lt-ie8 lt-ie7\&quot; lang=\&quot;en\
## 3 &quot;&lt;!--[if (IE 7)&amp;(!IEMobile)]&gt;&lt;html class=\&quot;no-js ie lt-ie9 lt-ie8\&quot; lang=\&quot;
## 4 &quot;&lt;!--[if IE 8]&gt;&lt;html class=\&quot;no-js ie lt-ie9\&quot; id=\&quot;ng-app\&quot; ng-app=\&quot;vizhu
## 5 &quot;&lt;!--[if IE 9]&gt;&lt;html class=\&quot;no-js ie ie9 lte-ie9\&quot; id=\&quot;ng-app\&quot; ng-app=\&quot;
## 6 &quot;&lt;!--[if (gte IE 9)|(gt IEMobile 7)]&gt;&lt;html class=\&quot;no-js ie\&quot; id=\&quot;ng-app\&quot;</code></pre>
<p>The filters on the worksheet are accessible by using the format<code>Year=2014</code>. To add a filter to your data request you need to add a <code>?</code> to the end of the workseet URL. Your final URL will look like this <code>https://public.tableau.com/profile/mpca.data.services#!/vizhome/Pointsourceairemissionsdata/EmissionsbyFacility.csv?:embed=y&amp;Year=2014</code>.</p>
</div>
<p><br> <strong>Contributors</strong></p>
<blockquote>
<p>Dorian Kvale</p>
</blockquote>
<p><br> <strong>References</strong></p>
<p><br> <a href="data-cleaning-dorian-cassie.html#missing">Back to top</a></p>

</div>
</div>
<script>
  $(".btn_code").click(function() {
    $(this.parentNode).toggleClass("open");
  });
</script>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-cleaning-dorian-cassie.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/MPCA-air/air-methods/edit/master/01-get_data.Rmd",
"text": "Edit"
},
"download": ["air-methods.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
